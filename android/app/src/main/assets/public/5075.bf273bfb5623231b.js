"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5075],{4033:(al,er,X)=>{X.d(er,{$:()=>Yr,A:()=>It,C:()=>ri,G:()=>Rn,K:()=>Ct,L:()=>xt,N:()=>Tt,P:()=>tc,R:()=>Zu,U:()=>go,V:()=>Po,W:()=>Tl,X:()=>vu,Y:()=>El,Z:()=>fr,_:()=>Dt,a:()=>fs,a0:()=>zt,a1:()=>Zr,a2:()=>Tu,a3:()=>Eu,a4:()=>wu,a5:()=>ko,a6:()=>Ru,a7:()=>ns,a8:()=>Pu,a9:()=>Tr,aA:()=>ll,aB:()=>se,aC:()=>b,aD:()=>ra,aE:()=>vt,aF:()=>sr,aG:()=>na,aH:()=>ac,aI:()=>Wn,aJ:()=>Ne,aN:()=>wr,aQ:()=>pr,aa:()=>Su,ab:()=>bu,ac:()=>Er,ad:()=>Cu,ae:()=>ei,af:()=>ss,ag:()=>xu,ah:()=>ti,ak:()=>Ht,al:()=>ku,am:()=>Du,ap:()=>gr,aq:()=>Ou,as:()=>Uu,at:()=>qu,au:()=>Le,av:()=>jr,aw:()=>yo,ax:()=>Q,ay:()=>_n,az:()=>dc,b:()=>At,c:()=>rc,d:()=>ic,e:()=>pi,f:()=>mn,g:()=>zl,h:()=>cc,i:()=>oi,j:()=>Kl,k:()=>fa,l:()=>Kn,m:()=>eh,o:()=>Ms,p:()=>k,r:()=>ec,s:()=>Bl,u:()=>Zo});var E=X(467),oe=X(8742),K=X(1076),$e=X(8041),Ae=X(1635),wn=X(1362);const k={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},It={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const Rn=function ki(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},Di=function Fr(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Pn=new K.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Sn=new $e.Vy("@firebase/auth");function bn(l,...s){Sn.logLevel<=$e.$b.ERROR&&Sn.error(`Auth (${oe.SDK_VERSION}): ${l}`,...s)}function Q(l,...s){throw ao(l,...s)}function se(l,...s){return ao(l,...s)}function _e(l,s,a){const h=Object.assign(Object.assign({},Di()),{[s]:a});return new K.FA("auth","Firebase",h).create(s,{appName:l.name})}function ce(l){return _e(l,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function we(l,s,a){if(!(s instanceof a))throw a.name!==s.constructor.name&&Q(l,"argument-error"),_e(l,"argument-error",`Type of ${s.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ao(l,...s){if("string"!=typeof l){const a=s[0],h=[...s.slice(1)];return h[0]&&(h[0].appName=l.name),l._errorFactory.create(a,...h)}return Pn.create(l,...s)}function b(l,s,...a){if(!l)throw ao(s,...a)}function ye(l){const s="INTERNAL ASSERTION FAILED: "+l;throw bn(s),new Error(s)}function Le(l,s){l||ye(s)}function Cn(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.href)||""}function J(){return"http:"===Z()||"https:"===Z()}function Z(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.protocol)||null}class F{constructor(s,a){this.shortDelay=s,this.longDelay=a,Le(a>s,"Short delay should be less than long delay!"),this.isMobile=(0,K.jZ)()||(0,K.lV)()}get(){return function zd(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(J()||(0,K.sr)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function G(l,s){Le(l.emulator,"Emulator should always be set here");const{url:a}=l.emulator;return s?`${a}${s.startsWith("/")?s.slice(1):s}`:a}class qe{static initialize(s,a,h){this.fetchImpl=s,a&&(this.headersImpl=a),h&&(this.responseImpl=h)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void ye("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void ye("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void ye("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const $a={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ul=new F(3e4,6e4);function xe(l,s){return l.tenantId&&!s.tenantId?Object.assign(Object.assign({},s),{tenantId:l.tenantId}):s}function Ve(l,s,a,h){return uo.apply(this,arguments)}function uo(){return(uo=(0,E.A)(function*(l,s,a,h,g={}){return Ha(l,g,(0,E.A)(function*(){let I={},P={};h&&("GET"===s?P=h:I={body:JSON.stringify(h)});const M=(0,K.Am)(Object.assign({key:l.config.apiKey},P)).slice(1),q=yield l._getAdditionalHeaders();return q["Content-Type"]="application/json",l.languageCode&&(q["X-Firebase-Locale"]=l.languageCode),qe.fetch()(Ja(l,l.config.apiHost,a,M),Object.assign({method:s,headers:q,referrerPolicy:"no-referrer"},I))}))})).apply(this,arguments)}function Ha(l,s,a){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,E.A)(function*(l,s,a){l._canInitEmulator=!1;const h=Object.assign(Object.assign({},$a),s);try{const g=new ae(l),I=yield Promise.race([a(),g.promise]);g.clearNetworkTimeout();const P=yield I.json();if("needConfirmation"in P)throw Rt(l,"account-exists-with-different-credential",P);if(I.ok&&!("errorMessage"in P))return P;{const M=I.ok?P.errorMessage:P.error.message,[q,Y]=M.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===q)throw Rt(l,"credential-already-in-use",P);if("EMAIL_EXISTS"===q)throw Rt(l,"email-already-in-use",P);if("USER_DISABLED"===q)throw Rt(l,"user-disabled",P);const re=h[q]||q.toLowerCase().replace(/[_\s]+/g,"-");if(Y)throw _e(l,re,Y);Q(l,re)}}catch(g){if(g instanceof K.g)throw g;Q(l,"network-request-failed",{message:String(g)})}})).apply(this,arguments)}function Ft(l,s,a,h){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,E.A)(function*(l,s,a,h,g={}){const I=yield Ve(l,s,a,h,g);return"mfaPendingCredential"in I&&Q(l,"multi-factor-auth-required",{_serverResponse:I}),I})).apply(this,arguments)}function Ja(l,s,a,h){const g=`${s}${a}?${h}`;return l.config.emulator?G(l.config,g):`${l.config.apiScheme}://${g}`}function Ya(l){switch(l){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ae{constructor(s){this.auth=s,this.timer=null,this.promise=new Promise((a,h)=>{this.timer=setTimeout(()=>h(se(this.auth,"network-request-failed")),ul.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Rt(l,s,a){const h={appName:l.name};a.email&&(h.email=a.email),a.phoneNumber&&(h.phoneNumber=a.phoneNumber);const g=se(l,s,h);return g.customData._tokenResponse=a,g}function co(l){return void 0!==l&&void 0!==l.getResponse}function De(l){return void 0!==l&&void 0!==l.enterprise}class te{constructor(s){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===s.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=s.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=s.recaptchaEnforcementState}getProviderEnforcementState(s){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const a of this.recaptchaEnforcementState)if(a.provider&&a.provider===s)return Ya(a.enforcementState);return null}isProviderEnabled(s){return"ENFORCE"===this.getProviderEnforcementState(s)||"AUDIT"===this.getProviderEnforcementState(s)}}function he(){return(he=(0,E.A)(function*(l){return(yield Ve(l,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Xa(l,s){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,E.A)(function*(l,s){return Ve(l,"GET","/v2/recaptchaConfig",xe(l,s))})).apply(this,arguments)}function Yt(){return(Yt=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:delete",s)})).apply(this,arguments)}function Ut(){return(Ut=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function Za(l,s){return Bt.apply(this,arguments)}function Bt(){return(Bt=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:lookup",s)})).apply(this,arguments)}function Br(l){if(l)try{const s=new Date(Number(l));if(!isNaN(s.getTime()))return s.toUTCString()}catch{}}function Mi(){return(Mi=(0,E.A)(function*(l,s=!1){const a=(0,K.Ku)(l),h=yield a.getIdToken(s),g=tr(h);b(g&&g.exp&&g.auth_time&&g.iat,a.auth,"internal-error");const I="object"==typeof g.firebase?g.firebase:void 0,P=null==I?void 0:I.sign_in_provider;return{claims:g,token:h,authTime:Br(nt(g.auth_time)),issuedAtTime:Br(nt(g.iat)),expirationTime:Br(nt(g.exp)),signInProvider:P||null,signInSecondFactor:(null==I?void 0:I.sign_in_second_factor)||null}})).apply(this,arguments)}function nt(l){return 1e3*Number(l)}function tr(l){const[s,a,h]=l.split(".");if(void 0===s||void 0===a||void 0===h)return bn("JWT malformed, contained fewer than 3 sections"),null;try{const g=(0,K.u)(a);return g?JSON.parse(g):(bn("Failed to decode base64 JWT payload"),null)}catch(g){return bn("Caught error parsing JWT payload as JSON",null==g?void 0:g.toString()),null}}function ho(l){const s=tr(l);return b(s,"internal-error"),b(typeof s.exp<"u","internal-error"),b(typeof s.iat<"u","internal-error"),Number(s.exp)-Number(s.iat)}function Pt(l,s){return St.apply(this,arguments)}function St(){return(St=(0,E.A)(function*(l,s,a=!1){if(a)return s;try{return yield s}catch(h){throw h instanceof K.g&&function fo({code:l}){return"auth/user-disabled"===l||"auth/user-token-expired"===l}(h)&&l.auth.currentUser===l&&(yield l.auth.signOut()),h}})).apply(this,arguments)}class N{constructor(s){this.user=s,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(s){var a;if(s){const h=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),h}{this.errorBackoff=3e4;const g=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,g)}}schedule(s=!1){var a=this;if(!this.isRunning)return;const h=this.getInterval(s);this.timerId=setTimeout((0,E.A)(function*(){yield a.iteration()}),h)}iteration(){var s=this;return(0,E.A)(function*(){try{yield s.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===(null==a?void 0:a.code)&&s.schedule(!0))}s.schedule()})()}}class nr{constructor(s,a){this.createdAt=s,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Br(this.lastLoginAt),this.creationTime=Br(this.createdAt)}_copy(s){this.createdAt=s.createdAt,this.lastLoginAt=s.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function at(l){return Li.apply(this,arguments)}function Li(){return(Li=(0,E.A)(function*(l){var s;const a=l.auth,h=yield l.getIdToken(),g=yield Pt(l,Za(a,{idToken:h}));b(null==g?void 0:g.users.length,a,"internal-error");const I=g.users[0];l._notifyReloadListener(I);const P=null!==(s=I.providerUserInfo)&&void 0!==s&&s.length?tu(I.providerUserInfo):[],M=function Xt(l,s){return[...l.filter(h=>!s.some(g=>g.providerId===h.providerId)),...s]}(l.providerData,P),re=!!l.isAnonymous&&!(l.email&&I.passwordHash||null!=M&&M.length),fe={uid:I.localId,displayName:I.displayName||null,photoURL:I.photoUrl||null,email:I.email||null,emailVerified:I.emailVerified||!1,phoneNumber:I.phoneNumber||null,tenantId:I.tenantId||null,providerData:M,metadata:new nr(I.createdAt,I.lastLoginAt),isAnonymous:re};Object.assign(l,fe)})).apply(this,arguments)}function xn(){return(xn=(0,E.A)(function*(l){const s=(0,K.Ku)(l);yield at(s),yield s.auth._persistUserIfCurrent(s),s.auth._notifyListenersIfCurrent(s)})).apply(this,arguments)}function tu(l){return l.map(s=>{var{providerId:a}=s,h=(0,Ae.Tt)(s,["providerId"]);return{providerId:a,uid:h.rawId||"",displayName:h.displayName||null,email:h.email||null,phoneNumber:h.phoneNumber||null,photoURL:h.photoUrl||null}})}function Fi(){return(Fi=(0,E.A)(function*(l,s){const a=yield Ha(l,{},(0,E.A)(function*(){const h=(0,K.Am)({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:g,apiKey:I}=l.config,P=Ja(l,g,"/v1/token",`key=${I}`),M=yield l._getAdditionalHeaders();return M["Content-Type"]="application/x-www-form-urlencoded",qe.fetch()(P,{method:"POST",headers:M,body:h})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}function mo(){return(mo=(0,E.A)(function*(l,s){return Ve(l,"POST","/v2/accounts:revokeToken",xe(l,s))})).apply(this,arguments)}class rr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(s){b(s.idToken,"internal-error"),b(typeof s.idToken<"u","internal-error"),b(typeof s.refreshToken<"u","internal-error");const a="expiresIn"in s&&typeof s.expiresIn<"u"?Number(s.expiresIn):ho(s.idToken);this.updateTokensAndExpiration(s.idToken,s.refreshToken,a)}updateFromIdToken(s){b(0!==s.length,"internal-error");const a=ho(s);this.updateTokensAndExpiration(s,null,a)}getToken(s,a=!1){var h=this;return(0,E.A)(function*(){return a||!h.accessToken||h.isExpired?(b(h.refreshToken,s,"user-token-expired"),h.refreshToken?(yield h.refresh(s,h.refreshToken),h.accessToken):null):h.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(s,a){var h=this;return(0,E.A)(function*(){const{accessToken:g,refreshToken:I,expiresIn:P}=yield function Vn(l,s){return Fi.apply(this,arguments)}(s,a);h.updateTokensAndExpiration(g,I,Number(P))})()}updateTokensAndExpiration(s,a,h){this.refreshToken=a||null,this.accessToken=s||null,this.expirationTime=Date.now()+1e3*h}static fromJSON(s,a){const{refreshToken:h,accessToken:g,expirationTime:I}=a,P=new rr;return h&&(b("string"==typeof h,"internal-error",{appName:s}),P.refreshToken=h),g&&(b("string"==typeof g,"internal-error",{appName:s}),P.accessToken=g),I&&(b("number"==typeof I,"internal-error",{appName:s}),P.expirationTime=I),P}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(s){this.accessToken=s.accessToken,this.refreshToken=s.refreshToken,this.expirationTime=s.expirationTime}_clone(){return Object.assign(new rr,this.toJSON())}_performRefresh(){return ye("not implemented")}}function Ge(l,s){b("string"==typeof l||typeof l>"u","internal-error",{appName:s})}class ft{constructor(s){var{uid:a,auth:h,stsTokenManager:g}=s,I=(0,Ae.Tt)(s,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new N(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=h,this.stsTokenManager=g,this.accessToken=g.accessToken,this.displayName=I.displayName||null,this.email=I.email||null,this.emailVerified=I.emailVerified||!1,this.phoneNumber=I.phoneNumber||null,this.photoURL=I.photoURL||null,this.isAnonymous=I.isAnonymous||!1,this.tenantId=I.tenantId||null,this.providerData=I.providerData?[...I.providerData]:[],this.metadata=new nr(I.createdAt||void 0,I.lastLoginAt||void 0)}getIdToken(s){var a=this;return(0,E.A)(function*(){const h=yield Pt(a,a.stsTokenManager.getToken(a.auth,s));return b(h,a.auth,"internal-error"),a.accessToken!==h&&(a.accessToken=h,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),h})()}getIdTokenResult(s){return function eu(l){return Mi.apply(this,arguments)}(this,s)}reload(){return function cl(l){return xn.apply(this,arguments)}(this)}_assign(s){this!==s&&(b(this.uid===s.uid,this.auth,"internal-error"),this.displayName=s.displayName,this.photoURL=s.photoURL,this.email=s.email,this.emailVerified=s.emailVerified,this.phoneNumber=s.phoneNumber,this.isAnonymous=s.isAnonymous,this.tenantId=s.tenantId,this.providerData=s.providerData.map(a=>Object.assign({},a)),this.metadata._copy(s.metadata),this.stsTokenManager._assign(s.stsTokenManager))}_clone(s){const a=new ft(Object.assign(Object.assign({},this),{auth:s,stsTokenManager:this.stsTokenManager._clone()}));return a.metadata._copy(this.metadata),a}_onReload(s){b(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=s,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(s){this.reloadListener?this.reloadListener(s):this.reloadUserInfo=s}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(s,a=!1){var h=this;return(0,E.A)(function*(){let g=!1;s.idToken&&s.idToken!==h.stsTokenManager.accessToken&&(h.stsTokenManager.updateFromServerResponse(s),g=!0),a&&(yield at(h)),yield h.auth._persistUserIfCurrent(h),g&&h.auth._notifyListenersIfCurrent(h)})()}delete(){var s=this;return(0,E.A)(function*(){if((0,oe._isFirebaseServerApp)(s.auth.app))return Promise.reject(ce(s.auth));const a=yield s.getIdToken();return yield Pt(s,function H(l,s){return Yt.apply(this,arguments)}(s.auth,{idToken:a})),s.stsTokenManager.clearRefreshToken(),s.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(s=>Object.assign({},s)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(s,a){var h,g,I,P,M,q,Y,re;const fe=null!==(h=a.displayName)&&void 0!==h?h:void 0,ut=null!==(g=a.email)&&void 0!==g?g:void 0,yn=null!==(I=a.phoneNumber)&&void 0!==I?I:void 0,In=null!==(P=a.photoURL)&&void 0!==P?P:void 0,Ls=null!==(M=a.tenantId)&&void 0!==M?M:void 0,vn=null!==(q=a._redirectEventId)&&void 0!==q?q:void 0,Fs=null!==(Y=a.createdAt)&&void 0!==Y?Y:void 0,vi=null!==(re=a.lastLoginAt)&&void 0!==re?re:void 0,{uid:Tn,emailVerified:Us,isAnonymous:Ia,providerData:Ti,stsTokenManager:Bs}=a;b(Tn&&Bs,s,"internal-error");const En=rr.fromJSON(this.name,Bs);b("string"==typeof Tn,s,"internal-error"),Ge(fe,s.name),Ge(ut,s.name),b("boolean"==typeof Us,s,"internal-error"),b("boolean"==typeof Ia,s,"internal-error"),Ge(yn,s.name),Ge(In,s.name),Ge(Ls,s.name),Ge(vn,s.name),Ge(Fs,s.name),Ge(vi,s.name);const qs=new ft({uid:Tn,auth:s,email:ut,emailVerified:Us,displayName:fe,isAnonymous:Ia,photoURL:In,phoneNumber:yn,tenantId:Ls,stsTokenManager:En,createdAt:Fs,lastLoginAt:vi});return Ti&&Array.isArray(Ti)&&(qs.providerData=Ti.map(th=>Object.assign({},th))),vn&&(qs._redirectEventId=vn),qs}static _fromIdTokenResponse(s,a,h=!1){return(0,E.A)(function*(){const g=new rr;g.updateFromServerResponse(a);const I=new ft({uid:a.localId,auth:s,stsTokenManager:g,isAnonymous:h});return yield at(I),I})()}static _fromGetAccountInfoResponse(s,a,h){return(0,E.A)(function*(){const g=a.users[0];b(void 0!==g.localId,"internal-error");const I=void 0!==g.providerUserInfo?tu(g.providerUserInfo):[],P=!(g.email&&g.passwordHash||null!=I&&I.length),M=new rr;M.updateFromIdToken(h);const q=new ft({uid:g.localId,auth:s,stsTokenManager:M,isAnonymous:P}),Y={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:I,metadata:new nr(g.createdAt,g.lastLoginAt),isAnonymous:!(g.email&&g.passwordHash||null!=I&&I.length)};return Object.assign(q,Y),q})()}}const ir=new Map;function vt(l){Le(l instanceof Function,"Expected a class definition");let s=ir.get(l);return s?(Le(s instanceof l,"Instance stored in cache mismatched with class"),s):(s=new l,ir.set(l,s),s)}const go=(()=>{class l{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,E.A)(function*(){return!0})()}_set(a,h){var g=this;return(0,E.A)(function*(){g.storage[a]=h})()}_get(a){var h=this;return(0,E.A)(function*(){const g=h.storage[a];return void 0===g?null:g})()}_remove(a){var h=this;return(0,E.A)(function*(){delete h.storage[a]})()}_addListener(a,h){}_removeListener(a,h){}}return l.type="NONE",l})();function sr(l,s,a){return`firebase:${l}:${s}:${a}`}class it{constructor(s,a,h){this.persistence=s,this.auth=a,this.userKey=h;const{config:g,name:I}=this.auth;this.fullUserKey=sr(this.userKey,g.apiKey,I),this.fullPersistenceKey=sr("persistence",g.apiKey,I),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(s){return this.persistence._set(this.fullUserKey,s.toJSON())}getCurrentUser(){var s=this;return(0,E.A)(function*(){const a=yield s.persistence._get(s.fullUserKey);return a?ft._fromJSON(s.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(s){var a=this;return(0,E.A)(function*(){if(a.persistence===s)return;const h=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=s,h?a.setCurrentUser(h):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(s,a,h="authUser"){return(0,E.A)(function*(){if(!a.length)return new it(vt(go),s,h);const g=(yield Promise.all(a.map(function(){var Y=(0,E.A)(function*(re){if(yield re._isAvailable())return re});return function(re){return Y.apply(this,arguments)}}()))).filter(Y=>Y);let I=g[0]||vt(go);const P=sr(h,s.config.apiKey,s.name);let M=null;for(const Y of a)try{const re=yield Y._get(P);if(re){const fe=ft._fromJSON(s,re);Y!==I&&(M=fe),I=Y;break}}catch{}const q=g.filter(Y=>Y._shouldAllowMigration);return I._shouldAllowMigration&&q.length?(I=q[0],M&&(yield I._set(P,M.toJSON())),yield Promise.all(a.map(function(){var Y=(0,E.A)(function*(re){if(re!==I)try{yield re._remove(P)}catch{}});return function(re){return Y.apply(this,arguments)}}())),new it(I,s,h)):new it(I,s,h)})()}}function _o(l){const s=l.toLowerCase();if(s.includes("opera/")||s.includes("opr/")||s.includes("opios/"))return"Opera";if(ru(s))return"IEMobile";if(s.includes("msie")||s.includes("trident/"))return"IE";if(s.includes("edge/"))return"Edge";if(Gr(s))return"Firefox";if(s.includes("silk/"))return"Silk";if(iu(s))return"Blackberry";if(su(s))return"Webos";if(Ui(s))return"Safari";if((s.includes("chrome/")||nu(s))&&!s.includes("edge/"))return"Chrome";if(yo(s))return"Android";{const h=l.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==h?void 0:h.length))return h[1]}return"Other"}function Gr(l=(0,K.ZQ)()){return/firefox\//i.test(l)}function Ui(l=(0,K.ZQ)()){const s=l.toLowerCase();return s.includes("safari/")&&!s.includes("chrome/")&&!s.includes("crios/")&&!s.includes("android")}function nu(l=(0,K.ZQ)()){return/crios\//i.test(l)}function ru(l=(0,K.ZQ)()){return/iemobile/i.test(l)}function yo(l=(0,K.ZQ)()){return/android/i.test(l)}function iu(l=(0,K.ZQ)()){return/blackberry/i.test(l)}function su(l=(0,K.ZQ)()){return/webos/i.test(l)}function jr(l=(0,K.ZQ)()){return/iphone|ipad|ipod/i.test(l)||/macintosh/i.test(l)&&/mobile/i.test(l)}function ll(l=(0,K.ZQ)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(l)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(l)}function ou(l=(0,K.ZQ)()){return jr(l)||yo(l)||su(l)||iu(l)||/windows phone/i.test(l)||ru(l)}function au(l,s=[]){let a;switch(l){case"Browser":a=_o((0,K.ZQ)());break;case"Worker":a=`${_o((0,K.ZQ)())}-${l}`;break;default:a=l}const h=s.length?s.join(","):"FirebaseCore-web";return`${a}/JsCore/${oe.SDK_VERSION}/${h}`}class pl{constructor(s){this.auth=s,this.queue=[]}pushCallback(s,a){const h=I=>new Promise((P,M)=>{try{P(s(I))}catch(q){M(q)}});h.onAbort=a,this.queue.push(h);const g=this.queue.length-1;return()=>{this.queue[g]=()=>Promise.resolve()}}runMiddleware(s){var a=this;return(0,E.A)(function*(){if(a.auth.currentUser===s)return;const h=[];try{for(const g of a.queue)yield g(s),g.onAbort&&h.push(g.onAbort)}catch(g){h.reverse();for(const I of h)try{I()}catch{}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null==g?void 0:g.message})}})()}}function Io(){return(Io=(0,E.A)(function*(l,s={}){return Ve(l,"GET","/v2/passwordPolicy",xe(l,s))})).apply(this,arguments)}class gl{constructor(s){var a,h,g,I;const P=s.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(a=P.minPasswordLength)&&void 0!==a?a:6,P.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=P.maxPasswordLength),void 0!==P.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=P.containsLowercaseCharacter),void 0!==P.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=P.containsUppercaseCharacter),void 0!==P.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=P.containsNumericCharacter),void 0!==P.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=P.containsNonAlphanumericCharacter),this.enforcementState=s.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(g=null===(h=s.allowedNonAlphanumericCharacters)||void 0===h?void 0:h.join(""))&&void 0!==g?g:"",this.forceUpgradeOnSignin=null!==(I=s.forceUpgradeOnSignin)&&void 0!==I&&I,this.schemaVersion=s.schemaVersion}validatePassword(s){var a,h,g,I,P,M;const q={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(s,q),this.validatePasswordCharacterOptions(s,q),q.isValid&&(q.isValid=null===(a=q.meetsMinPasswordLength)||void 0===a||a),q.isValid&&(q.isValid=null===(h=q.meetsMaxPasswordLength)||void 0===h||h),q.isValid&&(q.isValid=null===(g=q.containsLowercaseLetter)||void 0===g||g),q.isValid&&(q.isValid=null===(I=q.containsUppercaseLetter)||void 0===I||I),q.isValid&&(q.isValid=null===(P=q.containsNumericCharacter)||void 0===P||P),q.isValid&&(q.isValid=null===(M=q.containsNonAlphanumericCharacter)||void 0===M||M),q}validatePasswordLengthOptions(s,a){const h=this.customStrengthOptions.minPasswordLength,g=this.customStrengthOptions.maxPasswordLength;h&&(a.meetsMinPasswordLength=s.length>=h),g&&(a.meetsMaxPasswordLength=s.length<=g)}validatePasswordCharacterOptions(s,a){let h;this.updatePasswordCharacterOptionsStatuses(a,!1,!1,!1,!1);for(let g=0;g<s.length;g++)h=s.charAt(g),this.updatePasswordCharacterOptionsStatuses(a,h>="a"&&h<="z",h>="A"&&h<="Z",h>="0"&&h<="9",this.allowedNonAlphanumericCharacters.includes(h))}updatePasswordCharacterOptionsStatuses(s,a,h,g,I){this.customStrengthOptions.containsLowercaseLetter&&(s.containsLowercaseLetter||(s.containsLowercaseLetter=a)),this.customStrengthOptions.containsUppercaseLetter&&(s.containsUppercaseLetter||(s.containsUppercaseLetter=h)),this.customStrengthOptions.containsNumericCharacter&&(s.containsNumericCharacter||(s.containsNumericCharacter=g)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(s.containsNonAlphanumericCharacter||(s.containsNonAlphanumericCharacter=I))}}class cu{constructor(s,a,h,g){this.app=s,this.heartbeatServiceProvider=a,this.appCheckServiceProvider=h,this.config=g,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new vo(this),this.idTokenSubscription=new vo(this),this.beforeStateQueue=new pl(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Pn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=s.name,this.clientVersion=g.sdkClientVersion}_initializeWithPersistence(s,a){var h=this;return a&&(this._popupRedirectResolver=vt(a)),this._initializationPromise=this.queue((0,E.A)(function*(){var g,I;if(!h._deleted&&(h.persistenceManager=yield it.create(h,s),!h._deleted)){if(null!==(g=h._popupRedirectResolver)&&void 0!==g&&g._shouldInitProactively)try{yield h._popupRedirectResolver._initialize(h)}catch{}yield h.initializeCurrentUser(a),h.lastNotifiedUid=(null===(I=h.currentUser)||void 0===I?void 0:I.uid)||null,!h._deleted&&(h._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var s=this;return(0,E.A)(function*(){if(s._deleted)return;const a=yield s.assertedPersistence.getCurrentUser();if(s.currentUser||a){if(s.currentUser&&a&&s.currentUser.uid===a.uid)return s._currentUser._assign(a),void(yield s.currentUser.getIdToken());yield s._updateCurrentUser(a,!0)}})()}initializeCurrentUserFromIdToken(s){var a=this;return(0,E.A)(function*(){try{const h=yield Za(a,{idToken:s}),g=yield ft._fromGetAccountInfoResponse(a,h,s);yield a.directlySetCurrentUser(g)}catch(h){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",h),yield a.directlySetCurrentUser(null)}})()}initializeCurrentUser(s){var a=this;return(0,E.A)(function*(){var h;if((0,oe._isFirebaseServerApp)(a.app)){const M=a.app.settings.authIdToken;return M?new Promise(q=>{setTimeout(()=>a.initializeCurrentUserFromIdToken(M).then(q,q))}):a.directlySetCurrentUser(null)}const g=yield a.assertedPersistence.getCurrentUser();let I=g,P=!1;if(s&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const M=null===(h=a.redirectUser)||void 0===h?void 0:h._redirectEventId,q=null==I?void 0:I._redirectEventId,Y=yield a.tryRedirectSignIn(s);(!M||M===q)&&null!=Y&&Y.user&&(I=Y.user,P=!0)}if(!I)return a.directlySetCurrentUser(null);if(!I._redirectEventId){if(P)try{yield a.beforeStateQueue.runMiddleware(I)}catch(M){I=g,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(M))}return I?a.reloadAndSetCurrentUserOrClear(I):a.directlySetCurrentUser(null)}return b(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===I._redirectEventId?a.directlySetCurrentUser(I):a.reloadAndSetCurrentUserOrClear(I)})()}tryRedirectSignIn(s){var a=this;return(0,E.A)(function*(){let h=null;try{h=yield a._popupRedirectResolver._completeRedirectFn(a,s,!0)}catch{yield a._setRedirectUser(null)}return h})()}reloadAndSetCurrentUserOrClear(s){var a=this;return(0,E.A)(function*(){try{yield at(s)}catch(h){if("auth/network-request-failed"!==(null==h?void 0:h.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(s)})()}useDeviceLanguage(){this.languageCode=function W(){if(typeof navigator>"u")return null;const l=navigator;return l.languages&&l.languages[0]||l.language||null}()}_delete(){var s=this;return(0,E.A)(function*(){s._deleted=!0})()}updateCurrentUser(s){var a=this;return(0,E.A)(function*(){if((0,oe._isFirebaseServerApp)(a.app))return Promise.reject(ce(a));const h=s?(0,K.Ku)(s):null;return h&&b(h.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(h&&h._clone(a))})()}_updateCurrentUser(s,a=!1){var h=this;return(0,E.A)(function*(){if(!h._deleted)return s&&b(h.tenantId===s.tenantId,h,"tenant-id-mismatch"),a||(yield h.beforeStateQueue.runMiddleware(s)),h.queue((0,E.A)(function*(){yield h.directlySetCurrentUser(s),h.notifyAuthListeners()}))})()}signOut(){var s=this;return(0,E.A)(function*(){return(0,oe._isFirebaseServerApp)(s.app)?Promise.reject(ce(s)):(yield s.beforeStateQueue.runMiddleware(null),(s.redirectPersistenceManager||s._popupRedirectResolver)&&(yield s._setRedirectUser(null)),s._updateCurrentUser(null,!0))})()}setPersistence(s){var a=this;return(0,oe._isFirebaseServerApp)(this.app)?Promise.reject(ce(this)):this.queue((0,E.A)(function*(){yield a.assertedPersistence.setPersistence(vt(s))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(s){var a=this;return(0,E.A)(function*(){a._getPasswordPolicyInternal()||(yield a._updatePasswordPolicy());const h=a._getPasswordPolicyInternal();return h.schemaVersion!==a.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(a._errorFactory.create("unsupported-password-policy-schema-version",{})):h.validatePassword(s)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var s=this;return(0,E.A)(function*(){const a=yield function ml(l){return Io.apply(this,arguments)}(s),h=new gl(a);null===s.tenantId?s._projectPasswordPolicy=h:s._tenantPasswordPolicies[s.tenantId]=h})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(s){this._errorFactory=new K.FA("auth","Firebase",s())}onAuthStateChanged(s,a,h){return this.registerStateListener(this.authStateSubscription,s,a,h)}beforeAuthStateChanged(s,a){return this.beforeStateQueue.pushCallback(s,a)}onIdTokenChanged(s,a,h){return this.registerStateListener(this.idTokenSubscription,s,a,h)}authStateReady(){return new Promise((s,a)=>{if(this.currentUser)s();else{const h=this.onAuthStateChanged(()=>{h(),s()},a)}})}revokeAccessToken(s){var a=this;return(0,E.A)(function*(){if(a.currentUser){const h=yield a.currentUser.getIdToken(),g={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:s,idToken:h};null!=a.tenantId&&(g.tenantId=a.tenantId),yield function po(l,s){return mo.apply(this,arguments)}(a,g)}})()}toJSON(){var s;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(s=this._currentUser)||void 0===s?void 0:s.toJSON()}}_setRedirectUser(s,a){var h=this;return(0,E.A)(function*(){const g=yield h.getOrInitRedirectPersistenceManager(a);return null===s?g.removeCurrentUser():g.setCurrentUser(s)})()}getOrInitRedirectPersistenceManager(s){var a=this;return(0,E.A)(function*(){if(!a.redirectPersistenceManager){const h=s&&vt(s)||a._popupRedirectResolver;b(h,a,"argument-error"),a.redirectPersistenceManager=yield it.create(a,[vt(h._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(s){var a=this;return(0,E.A)(function*(){var h,g;return a._isInitialized&&(yield a.queue((0,E.A)(function*(){}))),(null===(h=a._currentUser)||void 0===h?void 0:h._redirectEventId)===s?a._currentUser:(null===(g=a.redirectUser)||void 0===g?void 0:g._redirectEventId)===s?a.redirectUser:null})()}_persistUserIfCurrent(s){var a=this;return(0,E.A)(function*(){if(s===a.currentUser)return a.queue((0,E.A)(function*(){return a.directlySetCurrentUser(s)}))})()}_notifyListenersIfCurrent(s){s===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const h=null!==(a=null===(s=this.currentUser)||void 0===s?void 0:s.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==h&&(this.lastNotifiedUid=h,this.authStateSubscription.next(this.currentUser))}registerStateListener(s,a,h,g){if(this._deleted)return()=>{};const I="function"==typeof a?a:a.next.bind(a);let P=!1;const M=this._isInitialized?Promise.resolve():this._initializationPromise;if(b(M,this,"internal-error"),M.then(()=>{P||I(this.currentUser)}),"function"==typeof a){const q=s.addObserver(a,h,g);return()=>{P=!0,q()}}{const q=s.addObserver(a);return()=>{P=!0,q()}}}directlySetCurrentUser(s){var a=this;return(0,E.A)(function*(){a.currentUser&&a.currentUser!==s&&a._currentUser._stopProactiveRefresh(),s&&a.isProactiveRefreshEnabled&&s._startProactiveRefresh(),a.currentUser=s,s?yield a.assertedPersistence.setCurrentUser(s):yield a.assertedPersistence.removeCurrentUser()})()}queue(s){return this.operations=this.operations.then(s,s),this.operations}get assertedPersistence(){return b(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(s){!s||this.frameworks.includes(s)||(this.frameworks.push(s),this.frameworks.sort(),this.clientVersion=au(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var s=this;return(0,E.A)(function*(){var a;const h={"X-Client-Version":s.clientVersion};s.app.options.appId&&(h["X-Firebase-gmpid"]=s.app.options.appId);const g=yield null===(a=s.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();g&&(h["X-Firebase-Client"]=g);const I=yield s._getAppCheckToken();return I&&(h["X-Firebase-AppCheck"]=I),h})()}_getAppCheckToken(){var s=this;return(0,E.A)(function*(){var a;const h=yield null===(a=s.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getToken();return null!=h&&h.error&&function Ni(l,...s){Sn.logLevel<=$e.$b.WARN&&Sn.warn(`Auth (${oe.SDK_VERSION}): ${l}`,...s)}(`Error while retrieving App Check token: ${h.error}`),null==h?void 0:h.token})()}}function Ne(l){return(0,K.Ku)(l)}class vo{constructor(s){this.auth=s,this.observer=null,this.addObserver=(0,K.tD)(a=>this.observer=a)}get next(){return b(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let zr={loadJS:()=>(0,E.A)(function*(){throw new Error("Unable to load external scripts")})(),recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function je(l){return zr.loadJS(l)}function Eo(l){return`__${l}${Math.floor(1e6*Math.random())}`}class Je{constructor(s){this.type="recaptcha-enterprise",this.auth=Ne(s)}verify(s="verify",a=!1){var h=this;return(0,E.A)(function*(){function I(){return I=(0,E.A)(function*(M){if(!a){if(null==M.tenantId&&null!=M._agentRecaptchaConfig)return M._agentRecaptchaConfig.siteKey;if(null!=M.tenantId&&void 0!==M._tenantRecaptchaConfigs[M.tenantId])return M._tenantRecaptchaConfigs[M.tenantId].siteKey}return new Promise(function(){var q=(0,E.A)(function*(Y,re){Xa(M,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(fe=>{if(void 0!==fe.recaptchaKey){const ut=new te(fe);return null==M.tenantId?M._agentRecaptchaConfig=ut:M._tenantRecaptchaConfigs[M.tenantId]=ut,Y(ut.siteKey)}re(new Error("recaptcha Enterprise site key undefined"))}).catch(fe=>{re(fe)})});return function(Y,re){return q.apply(this,arguments)}}())}),I.apply(this,arguments)}function P(M,q,Y){const re=window.grecaptcha;De(re)?re.enterprise.ready(()=>{re.enterprise.execute(M,{action:s}).then(fe=>{q(fe)}).catch(()=>{q("NO_RECAPTCHA")})}):Y(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((M,q)=>{(function g(M){return I.apply(this,arguments)})(h.auth).then(Y=>{if(!a&&De(window.grecaptcha))P(Y,M,q);else{if(typeof window>"u")return void q(new Error("RecaptchaVerifier is only supported in browser"));let re=function Zt(){return zr.recaptchaEnterpriseScript}();0!==re.length&&(re+=Y),je(re).then(()=>{P(Y,M,q)}).catch(fe=>{q(fe)})}}).catch(Y=>{q(Y)})})})()}}function Ee(l,s,a){return qi.apply(this,arguments)}function qi(){return(qi=(0,E.A)(function*(l,s,a,h=!1){const g=new Je(l);let I;try{I=yield g.verify(a)}catch{I=yield g.verify(a,!0)}const P=Object.assign({},s);return Object.assign(P,h?{captchaResp:I}:{captchaResponse:I}),Object.assign(P,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(P,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),P})).apply(this,arguments)}function bt(l,s,a,h){return et.apply(this,arguments)}function et(){return et=(0,E.A)(function*(l,s,a,h){var g;if(null!==(g=l._getRecaptchaConfig())&&void 0!==g&&g.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const I=yield Ee(l,s,a,"getOobCode"===a);return h(l,I)}return h(l,s).catch(function(){var I=(0,E.A)(function*(P){if("auth/missing-recaptcha-token"===P.code){console.log(`${a} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const M=yield Ee(l,s,a,"getOobCode"===a);return h(l,M)}return Promise.reject(P)});return function(P){return I.apply(this,arguments)}}())}),et.apply(this,arguments)}function Ct(l,s,a){const h=Ne(l);b(h._canInitEmulator,h,"emulator-config-failed"),b(/^https?:\/\//.test(s),h,"invalid-emulator-scheme");const g=!(null==a||!a.disableWarnings),I=Oe(s),{host:P,port:M}=function qt(l){const s=Oe(l),a=/(\/\/)?([^?#/]+)/.exec(l.substr(s.length));if(!a)return{host:"",port:null};const h=a[2].split("@").pop()||"",g=/^(\[[^\]]+\])(:|$)/.exec(h);if(g){const I=g[1];return{host:I,port:Kr(h.substr(I.length+1))}}{const[I,P]=h.split(":");return{host:I,port:Kr(P)}}}(s);h.config.emulator={url:`${I}//${P}${null===M?"":`:${M}`}/`},h.settings.appVerificationDisabledForTesting=!0,h.emulatorConfig=Object.freeze({host:P,port:M,protocol:I.replace(":",""),options:Object.freeze({disableWarnings:g})}),g||function Gi(){function l(){const s=document.createElement("p"),a=s.style;s.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",s.classList.add("firebase-emulator-warning"),document.body.appendChild(s)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",l):l())}()}function Oe(l){const s=l.indexOf(":");return s<0?"":l.substr(0,s+1)}function Kr(l){if(!l)return null;const s=Number(l);return isNaN(s)?null:s}class xt{constructor(s,a){this.providerId=s,this.signInMethod=a}toJSON(){return ye("not implemented")}_getIdTokenResponse(s){return ye("not implemented")}_linkToIdToken(s,a){return ye("not implemented")}_getReauthenticationResolver(s){return ye("not implemented")}}function pu(l,s){return Gt.apply(this,arguments)}function Gt(){return(Gt=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:resetPassword",xe(l,s))})).apply(this,arguments)}function or(){return(or=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function tn(l,s){return _t.apply(this,arguments)}function _t(){return(_t=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:signUp",s)})).apply(this,arguments)}function Vt(){return(Vt=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:update",xe(l,s))})).apply(this,arguments)}function mu(l,s){return nn.apply(this,arguments)}function nn(){return(nn=(0,E.A)(function*(l,s){return Ft(l,"POST","/v1/accounts:signInWithPassword",xe(l,s))})).apply(this,arguments)}function ar(l,s){return ur.apply(this,arguments)}function ur(){return(ur=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:sendOobCode",xe(l,s))})).apply(this,arguments)}function $r(){return($r=(0,E.A)(function*(l,s){return ar(l,s)})).apply(this,arguments)}function Hr(l,s){return ji.apply(this,arguments)}function ji(){return(ji=(0,E.A)(function*(l,s){return ar(l,s)})).apply(this,arguments)}function gu(l,s){return cr.apply(this,arguments)}function cr(){return(cr=(0,E.A)(function*(l,s){return ar(l,s)})).apply(this,arguments)}function zi(){return(zi=(0,E.A)(function*(l,s){return ar(l,s)})).apply(this,arguments)}function Ao(){return(Ao=(0,E.A)(function*(l,s){return Ft(l,"POST","/v1/accounts:signInWithEmailLink",xe(l,s))})).apply(this,arguments)}function Ki(){return(Ki=(0,E.A)(function*(l,s){return Ft(l,"POST","/v1/accounts:signInWithEmailLink",xe(l,s))})).apply(this,arguments)}class Ue extends xt{constructor(s,a,h,g=null){super("password",h),this._email=s,this._password=a,this._tenantId=g}static _fromEmailAndPassword(s,a){return new Ue(s,a,"password")}static _fromEmailAndCode(s,a,h=null){return new Ue(s,a,"emailLink",h)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s;if(null!=a&&a.email&&null!=a&&a.password){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(s){var a=this;return(0,E.A)(function*(){switch(a.signInMethod){case"password":return bt(s,{returnSecureToken:!0,email:a._email,password:a._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",mu);case"emailLink":return function yl(l,s){return Ao.apply(this,arguments)}(s,{email:a._email,oobCode:a._password});default:Q(s,"internal-error")}})()}_linkToIdToken(s,a){var h=this;return(0,E.A)(function*(){switch(h.signInMethod){case"password":return bt(s,{idToken:a,returnSecureToken:!0,email:h._email,password:h._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",tn);case"emailLink":return function _u(l,s){return Ki.apply(this,arguments)}(s,{idToken:a,email:h._email,oobCode:h._password});default:Q(s,"internal-error")}})()}_getReauthenticationResolver(s){return this._getIdTokenResponse(s)}}function kt(l,s){return Re.apply(this,arguments)}function Re(){return(Re=(0,E.A)(function*(l,s){return Ft(l,"POST","/v1/accounts:signInWithIdp",xe(l,s))})).apply(this,arguments)}class Tt extends xt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(s){const a=new Tt(s.providerId,s.signInMethod);return s.idToken||s.accessToken?(s.idToken&&(a.idToken=s.idToken),s.accessToken&&(a.accessToken=s.accessToken),s.nonce&&!s.pendingToken&&(a.nonce=s.nonce),s.pendingToken&&(a.pendingToken=s.pendingToken)):s.oauthToken&&s.oauthTokenSecret?(a.accessToken=s.oauthToken,a.secret=s.oauthTokenSecret):Q("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s,{providerId:h,signInMethod:g}=a,I=(0,Ae.Tt)(a,["providerId","signInMethod"]);if(!h||!g)return null;const P=new Tt(h,g);return P.idToken=I.idToken||void 0,P.accessToken=I.accessToken||void 0,P.secret=I.secret,P.nonce=I.nonce,P.pendingToken=I.pendingToken||null,P}_getIdTokenResponse(s){return kt(s,this.buildRequest())}_linkToIdToken(s,a){const h=this.buildRequest();return h.idToken=a,kt(s,h)}_getReauthenticationResolver(s){const a=this.buildRequest();return a.autoCreate=!1,kt(s,a)}buildRequest(){const s={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)s.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),s.postBody=(0,K.Am)(a)}return s}}function Dn(){return(Dn=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:sendVerificationCode",xe(l,s))})).apply(this,arguments)}function Wi(){return(Wi=(0,E.A)(function*(l,s){return Ft(l,"POST","/v1/accounts:signInWithPhoneNumber",xe(l,s))})).apply(this,arguments)}function Ie(){return(Ie=(0,E.A)(function*(l,s){const a=yield Ft(l,"POST","/v1/accounts:signInWithPhoneNumber",xe(l,s));if(a.temporaryProof)throw Rt(l,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const lr={USER_NOT_FOUND:"user-not-found"};function Jr(){return(Jr=(0,E.A)(function*(l,s){return Ft(l,"POST","/v1/accounts:signInWithPhoneNumber",xe(l,Object.assign(Object.assign({},s),{operation:"REAUTH"})),lr)})).apply(this,arguments)}class sn extends xt{constructor(s){super("phone","phone"),this.params=s}static _fromVerification(s,a){return new sn({verificationId:s,verificationCode:a})}static _fromTokenResponse(s,a){return new sn({phoneNumber:s,temporaryProof:a})}_getIdTokenResponse(s){return function Il(l,s){return Wi.apply(this,arguments)}(s,this._makeVerificationRequest())}_linkToIdToken(s,a){return function pe(l,s){return Ie.apply(this,arguments)}(s,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(s){return function wo(l,s){return Jr.apply(this,arguments)}(s,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:s,phoneNumber:a,verificationId:h,verificationCode:g}=this.params;return s&&a?{temporaryProof:s,phoneNumber:a}:{sessionInfo:h,code:g}}toJSON(){const s={providerId:this.providerId};return this.params.phoneNumber&&(s.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(s.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(s.verificationCode=this.params.verificationCode),this.params.verificationId&&(s.verificationId=this.params.verificationId),s}static fromJSON(s){"string"==typeof s&&(s=JSON.parse(s));const{verificationId:a,verificationCode:h,phoneNumber:g,temporaryProof:I}=s;return h||a||g||I?new sn({verificationId:a,verificationCode:h,phoneNumber:g,temporaryProof:I}):null}}class hr{constructor(s){var a,h,g,I,P,M;const q=(0,K.I9)((0,K.hp)(s)),Y=null!==(a=q.apiKey)&&void 0!==a?a:null,re=null!==(h=q.oobCode)&&void 0!==h?h:null,fe=function Ro(l){switch(l){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(g=q.mode)&&void 0!==g?g:null);b(Y&&re&&fe,"argument-error"),this.apiKey=Y,this.operation=fe,this.code=re,this.continueUrl=null!==(I=q.continueUrl)&&void 0!==I?I:null,this.languageCode=null!==(P=q.languageCode)&&void 0!==P?P:null,this.tenantId=null!==(M=q.tenantId)&&void 0!==M?M:null}static parseLink(s){const a=function Iu(l){const s=(0,K.I9)((0,K.hp)(l)).link,a=s?(0,K.I9)((0,K.hp)(s)).deep_link_id:null,h=(0,K.I9)((0,K.hp)(l)).deep_link_id;return(h?(0,K.I9)((0,K.hp)(h)).link:null)||h||a||s||l}(s);try{return new hr(a)}catch{return null}}}let Po=(()=>{class l{constructor(){this.providerId=l.PROVIDER_ID}static credential(a,h){return Ue._fromEmailAndPassword(a,h)}static credentialWithLink(a,h){const g=hr.parseLink(h);return b(g,"argument-error"),Ue._fromEmailAndCode(a,g.code,g.tenantId)}}return l.PROVIDER_ID="password",l.EMAIL_PASSWORD_SIGN_IN_METHOD="password",l.EMAIL_LINK_SIGN_IN_METHOD="emailLink",l})();class jt{constructor(s){this.providerId=s,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(s){this.defaultLanguageCode=s}setCustomParameters(s){return this.customParameters=s,this}getCustomParameters(){return this.customParameters}}class dr extends jt{constructor(){super(...arguments),this.scopes=[]}addScope(s){return this.scopes.includes(s)||this.scopes.push(s),this}getScopes(){return[...this.scopes]}}class fr extends dr{static credentialFromJSON(s){const a="string"==typeof s?JSON.parse(s):s;return b("providerId"in a&&"signInMethod"in a,"argument-error"),Tt._fromParams(a)}credential(s){return this._credential(Object.assign(Object.assign({},s),{nonce:s.rawNonce}))}_credential(s){return b(s.idToken||s.accessToken,"argument-error"),Tt._fromParams(Object.assign(Object.assign({},s),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(s){return fr.oauthCredentialFromTaggedObject(s)}static credentialFromError(s){return fr.oauthCredentialFromTaggedObject(s.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{oauthIdToken:a,oauthAccessToken:h,oauthTokenSecret:g,pendingToken:I,nonce:P,providerId:M}=s;if(!h&&!g&&!a&&!I||!M)return null;try{return new fr(M)._credential({idToken:a,accessToken:h,nonce:P,pendingToken:I})}catch{return null}}}let Tl=(()=>{class l extends dr{constructor(){super("facebook.com")}static credential(a){return Tt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return l.credential(a.oauthAccessToken)}catch{return null}}}return l.FACEBOOK_SIGN_IN_METHOD="facebook.com",l.PROVIDER_ID="facebook.com",l})(),vu=(()=>{class l extends dr{constructor(){super("google.com"),this.addScope("profile")}static credential(a,h){return Tt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:h})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:h,oauthAccessToken:g}=a;if(!h&&!g)return null;try{return l.credential(h,g)}catch{return null}}}return l.GOOGLE_SIGN_IN_METHOD="google.com",l.PROVIDER_ID="google.com",l})(),El=(()=>{class l extends dr{constructor(){super("github.com")}static credential(a){return Tt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return l.credential(a.oauthAccessToken)}catch{return null}}}return l.GITHUB_SIGN_IN_METHOD="github.com",l.PROVIDER_ID="github.com",l})();class pr extends xt{constructor(s,a){super(s,s),this.pendingToken=a}_getIdTokenResponse(s){return kt(s,this.buildRequest())}_linkToIdToken(s,a){const h=this.buildRequest();return h.idToken=a,kt(s,h)}_getReauthenticationResolver(s){const a=this.buildRequest();return a.autoCreate=!1,kt(s,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s,{providerId:h,signInMethod:g,pendingToken:I}=a;return h&&g&&I&&h===g?new pr(h,I):null}static _create(s,a){return new pr(s,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Dt extends jt{constructor(s){b(s.startsWith("saml."),"argument-error"),super(s)}static credentialFromResult(s){return Dt.samlCredentialFromTaggedObject(s)}static credentialFromError(s){return Dt.samlCredentialFromTaggedObject(s.customData||{})}static credentialFromJSON(s){const a=pr.fromJSON(s);return b(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{pendingToken:a,providerId:h}=s;if(!a||!h)return null;try{return pr._create(h,a)}catch{return null}}}let Yr=(()=>{class l extends dr{constructor(){super("twitter.com")}static credential(a,h){return Tt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:h})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:h,oauthTokenSecret:g}=a;if(!h||!g)return null;try{return l.credential(h,g)}catch{return null}}}return l.TWITTER_SIGN_IN_METHOD="twitter.com",l.PROVIDER_ID="twitter.com",l})();function Xr(l,s){return mr.apply(this,arguments)}function mr(){return(mr=(0,E.A)(function*(l,s){return Ft(l,"POST","/v1/accounts:signUp",xe(l,s))})).apply(this,arguments)}class pt{constructor(s){this.user=s.user,this.providerId=s.providerId,this._tokenResponse=s._tokenResponse,this.operationType=s.operationType}static _fromIdTokenResponse(s,a,h,g=!1){return(0,E.A)(function*(){const I=yield ft._fromIdTokenResponse(s,h,g),P=bo(h);return new pt({user:I,providerId:P,_tokenResponse:h,operationType:a})})()}static _forOperation(s,a,h){return(0,E.A)(function*(){yield s._updateTokensIfNecessary(h,!0);const g=bo(h);return new pt({user:s,providerId:g,_tokenResponse:h,operationType:a})})()}}function bo(l){return l.providerId?l.providerId:"phoneNumber"in l?"phone":null}function zt(l){return $i.apply(this,arguments)}function $i(){return($i=(0,E.A)(function*(l){var s;if((0,oe._isFirebaseServerApp)(l.app))return Promise.reject(ce(l));const a=Ne(l);if(yield a._initializationPromise,null!==(s=a.currentUser)&&void 0!==s&&s.isAnonymous)return new pt({user:a.currentUser,providerId:null,operationType:"signIn"});const h=yield Xr(a,{returnSecureToken:!0}),g=yield pt._fromIdTokenResponse(a,"signIn",h,!0);return yield a._updateCurrentUser(g.user),g})).apply(this,arguments)}class Kt extends K.g{constructor(s,a,h,g){var I;super(a.code,a.message),this.operationType=h,this.user=g,Object.setPrototypeOf(this,Kt.prototype),this.customData={appName:s.name,tenantId:null!==(I=s.tenantId)&&void 0!==I?I:void 0,_serverResponse:a.customData._serverResponse,operationType:h}}static _fromErrorAndOperation(s,a,h,g){return new Kt(s,a,h,g)}}function Co(l,s,a,h){return("reauthenticate"===s?a._getReauthenticationResolver(l):a._getIdTokenResponse(l)).catch(I=>{throw"auth/multi-factor-auth-required"===I.code?Kt._fromErrorAndOperation(l,I,s,h):I})}function Hi(l){return new Set(l.map(({providerId:s})=>s).filter(s=>!!s))}function gr(l,s){return Ye.apply(this,arguments)}function Ye(){return Ye=(0,E.A)(function*(l,s){const a=(0,K.Ku)(l);yield _r(!0,a,s);const{providerUserInfo:h}=yield function lo(l,s){return Ut.apply(this,arguments)}(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[s]}),g=Hi(h||[]);return a.providerData=a.providerData.filter(I=>g.has(I.providerId)),g.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a}),Ye.apply(this,arguments)}function Qi(l,s){return Ji.apply(this,arguments)}function Ji(){return(Ji=(0,E.A)(function*(l,s,a=!1){const h=yield Pt(l,s._linkToIdToken(l.auth,yield l.getIdToken()),a);return pt._forOperation(l,"link",h)})).apply(this,arguments)}function _r(l,s,a){return yr.apply(this,arguments)}function yr(){return(yr=(0,E.A)(function*(l,s,a){yield at(s);const g=!1===l?"provider-already-linked":"no-such-provider";b(Hi(s.providerData).has(a)===l,s.auth,g)})).apply(this,arguments)}function Ir(l,s){return Yi.apply(this,arguments)}function Yi(){return(Yi=(0,E.A)(function*(l,s,a=!1){const{auth:h}=l;if((0,oe._isFirebaseServerApp)(h.app))return Promise.reject(ce(h));const g="reauthenticate";try{const I=yield Pt(l,Co(h,g,s,l),a);b(I.idToken,h,"internal-error");const P=tr(I.idToken);b(P,h,"internal-error");const{sub:M}=P;return b(l.uid===M,h,"user-mismatch"),pt._forOperation(l,g,I)}catch(I){throw"auth/user-not-found"===(null==I?void 0:I.code)&&Q(h,"user-mismatch"),I}})).apply(this,arguments)}function Nn(l,s){return On.apply(this,arguments)}function On(){return(On=(0,E.A)(function*(l,s,a=!1){if((0,oe._isFirebaseServerApp)(l.app))return Promise.reject(ce(l));const h="signIn",g=yield Co(l,h,s),I=yield pt._fromIdTokenResponse(l,h,g);return a||(yield l._updateCurrentUser(I.user)),I})).apply(this,arguments)}function Zr(l,s){return Xi.apply(this,arguments)}function Xi(){return(Xi=(0,E.A)(function*(l,s){return Nn(Ne(l),s)})).apply(this,arguments)}function Tu(l,s){return Et.apply(this,arguments)}function Et(){return(Et=(0,E.A)(function*(l,s){const a=(0,K.Ku)(l);return yield _r(!1,a,s.providerId),Qi(a,s)})).apply(this,arguments)}function Eu(l,s){return tt.apply(this,arguments)}function tt(){return(tt=(0,E.A)(function*(l,s){return Ir((0,K.Ku)(l),s)})).apply(this,arguments)}function Mn(){return(Mn=(0,E.A)(function*(l,s){return Ft(l,"POST","/v1/accounts:signInWithCustomToken",xe(l,s))})).apply(this,arguments)}function wu(l,s){return yt.apply(this,arguments)}function yt(){return yt=(0,E.A)(function*(l,s){if((0,oe._isFirebaseServerApp)(l.app))return Promise.reject(ce(l));const a=Ne(l),h=yield function Au(l,s){return Mn.apply(this,arguments)}(a,{token:s,returnSecureToken:!0}),g=yield pt._fromIdTokenResponse(a,"signIn",h);return yield a._updateCurrentUser(g.user),g}),yt.apply(this,arguments)}class vr{constructor(s,a){this.factorId=s,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(s,a){return"phoneInfo"in a?Ln._fromServerResponse(s,a):"totpInfo"in a?xo._fromServerResponse(s,a):Q(s,"internal-error")}}class Ln extends vr{constructor(s){super("phone",s),this.phoneNumber=s.phoneInfo}static _fromServerResponse(s,a){return new Ln(a)}}class xo extends vr{constructor(s){super("totp",s)}static _fromServerResponse(s,a){return new xo(a)}}function Zi(l,s,a){var h;b((null===(h=a.url)||void 0===h?void 0:h.length)>0,l,"invalid-continue-uri"),b(typeof a.dynamicLinkDomain>"u"||a.dynamicLinkDomain.length>0,l,"invalid-dynamic-link-domain"),s.continueUrl=a.url,s.dynamicLinkDomain=a.dynamicLinkDomain,s.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(b(a.iOS.bundleId.length>0,l,"missing-ios-bundle-id"),s.iOSBundleId=a.iOS.bundleId),a.android&&(b(a.android.packageName.length>0,l,"missing-android-pkg-name"),s.androidInstallApp=a.android.installApp,s.androidMinimumVersionCode=a.android.minimumVersion,s.androidPackageName=a.android.packageName)}function ue(l){return Vo.apply(this,arguments)}function Vo(){return(Vo=(0,E.A)(function*(l){const s=Ne(l);s._getPasswordPolicyInternal()&&(yield s._updatePasswordPolicy())})).apply(this,arguments)}function ko(l,s,a){return es.apply(this,arguments)}function es(){return(es=(0,E.A)(function*(l,s,a){const h=Ne(l),g={requestType:"PASSWORD_RESET",email:s,clientType:"CLIENT_TYPE_WEB"};a&&Zi(h,g,a),yield bt(h,g,"getOobCode",Hr)})).apply(this,arguments)}function Ru(l,s,a){return ts.apply(this,arguments)}function ts(){return ts=(0,E.A)(function*(l,s,a){yield pu((0,K.Ku)(l),{oobCode:s,newPassword:a}).catch(function(){var h=(0,E.A)(function*(g){throw"auth/password-does-not-meet-requirements"===g.code&&ue(l),g});return function(g){return h.apply(this,arguments)}}())}),ts.apply(this,arguments)}function ns(l,s){return Do.apply(this,arguments)}function Do(){return Do=(0,E.A)(function*(l,s){yield function Wr(l,s){return Vt.apply(this,arguments)}((0,K.Ku)(l),{oobCode:s})}),Do.apply(this,arguments)}function Pu(l,s){return rs.apply(this,arguments)}function rs(){return(rs=(0,E.A)(function*(l,s){const a=(0,K.Ku)(l),h=yield pu(a,{oobCode:s}),g=h.requestType;switch(b(g,a,"internal-error"),g){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":b(h.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":b(h.mfaInfo,a,"internal-error");default:b(h.email,a,"internal-error")}let I=null;return h.mfaInfo&&(I=vr._fromServerResponse(Ne(a),h.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.newEmail:h.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.email:h.newEmail)||null,multiFactorInfo:I},operation:g}})).apply(this,arguments)}function Tr(l,s){return Wt.apply(this,arguments)}function Wt(){return(Wt=(0,E.A)(function*(l,s){const{data:a}=yield Pu((0,K.Ku)(l),s);return a.email})).apply(this,arguments)}function Su(l,s,a){return $t.apply(this,arguments)}function $t(){return($t=(0,E.A)(function*(l,s,a){if((0,oe._isFirebaseServerApp)(l.app))return Promise.reject(ce(l));const h=Ne(l),P=yield bt(h,{returnSecureToken:!0,email:s,password:a,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Xr).catch(q=>{throw"auth/password-does-not-meet-requirements"===q.code&&ue(l),q}),M=yield pt._fromIdTokenResponse(h,"signIn",P);return yield h._updateCurrentUser(M.user),M})).apply(this,arguments)}function bu(l,s,a){return(0,oe._isFirebaseServerApp)(l.app)?Promise.reject(ce(l)):Zr((0,K.Ku)(l),Po.credential(s,a)).catch(function(){var h=(0,E.A)(function*(g){throw"auth/password-does-not-meet-requirements"===g.code&&ue(l),g});return function(g){return h.apply(this,arguments)}}())}function Er(l,s,a){return is.apply(this,arguments)}function is(){return(is=(0,E.A)(function*(l,s,a){const h=Ne(l),g={requestType:"EMAIL_SIGNIN",email:s,clientType:"CLIENT_TYPE_WEB"};(function I(P,M){b(M.handleCodeInApp,h,"argument-error"),M&&Zi(h,P,M)})(g,a),yield bt(h,g,"getOobCode",gu)})).apply(this,arguments)}function Cu(l,s){const a=hr.parseLink(s);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}function ei(l,s,a){return No.apply(this,arguments)}function No(){return(No=(0,E.A)(function*(l,s,a){if((0,oe._isFirebaseServerApp)(l.app))return Promise.reject(ce(l));const h=(0,K.Ku)(l),g=Po.credentialWithLink(s,a||Cn());return b(g._tenantId===(h.tenantId||null),h,"tenant-id-mismatch"),Zr(h,g)})).apply(this,arguments)}function be(){return(be=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:createAuthUri",xe(l,s))})).apply(this,arguments)}function ss(l,s){return Ar.apply(this,arguments)}function Ar(){return Ar=(0,E.A)(function*(l,s){const h={identifier:s,continueUri:J()?Cn():"http://localhost"},{signinMethods:g}=yield function wl(l,s){return be.apply(this,arguments)}((0,K.Ku)(l),h);return g||[]}),Ar.apply(this,arguments)}function xu(l,s){return Oo.apply(this,arguments)}function Oo(){return Oo=(0,E.A)(function*(l,s){const a=(0,K.Ku)(l),g={requestType:"VERIFY_EMAIL",idToken:yield l.getIdToken()};s&&Zi(a.auth,g,s);const{email:I}=yield function kn(l,s){return $r.apply(this,arguments)}(a.auth,g);I!==l.email&&(yield l.reload())}),Oo.apply(this,arguments)}function ti(l,s,a){return Mo.apply(this,arguments)}function Mo(){return Mo=(0,E.A)(function*(l,s,a){const h=(0,K.Ku)(l),I={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield l.getIdToken(),newEmail:s};a&&Zi(h.auth,I,a);const{email:P}=yield function Qr(l,s){return zi.apply(this,arguments)}(h.auth,I);P!==l.email&&(yield l.reload())}),Mo.apply(this,arguments)}function on(){return(on=(0,E.A)(function*(l,s){return Ve(l,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function Ht(l,s){return os.apply(this,arguments)}function os(){return os=(0,E.A)(function*(l,{displayName:s,photoURL:a}){if(void 0===s&&void 0===a)return;const h=(0,K.Ku)(l),I={idToken:yield h.getIdToken(),displayName:s,photoUrl:a,returnSecureToken:!0},P=yield Pt(h,function Vu(l,s){return on.apply(this,arguments)}(h.auth,I));h.displayName=P.displayName||null,h.photoURL=P.photoUrl||null;const M=h.providerData.find(({providerId:q})=>"password"===q);M&&(M.displayName=h.displayName,M.photoURL=h.photoURL),yield h._updateTokensIfNecessary(P)}),os.apply(this,arguments)}function ku(l,s){const a=(0,K.Ku)(l);return(0,oe._isFirebaseServerApp)(a.auth.app)?Promise.reject(ce(a.auth)):Fn(a,s,null)}function Du(l,s){return Fn((0,K.Ku)(l),null,s)}function Fn(l,s,a){return ni.apply(this,arguments)}function ni(){return ni=(0,E.A)(function*(l,s,a){const{auth:h}=l,I={idToken:yield l.getIdToken(),returnSecureToken:!0};s&&(I.email=s),a&&(I.password=a);const P=yield Pt(l,function en(l,s){return or.apply(this,arguments)}(h,I));yield l._updateTokensIfNecessary(P,!0)}),ni.apply(this,arguments)}class an{constructor(s,a,h={}){this.isNewUser=s,this.providerId=a,this.profile=h}}class as extends an{constructor(s,a,h,g){super(s,a,h),this.username=g}}class Nu extends an{constructor(s,a){super(s,"facebook.com",a)}}class Rl extends as{constructor(s,a){super(s,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class ze extends an{constructor(s,a){super(s,"google.com",a)}}class ge extends as{constructor(s,a,h){super(s,"twitter.com",a,h)}}function Ou(l){const{user:s,_tokenResponse:a}=l;return s.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function Lo(l){var s,a;if(!l)return null;const{providerId:h}=l,g=l.rawUserInfo?JSON.parse(l.rawUserInfo):{},I=l.isNewUser||"identitytoolkit#SignupNewUserResponse"===l.kind;if(!h&&null!=l&&l.idToken){const P=null===(a=null===(s=tr(l.idToken))||void 0===s?void 0:s.firebase)||void 0===a?void 0:a.sign_in_provider;if(P)return new an(I,"anonymous"!==P&&"custom"!==P?P:null)}if(!h)return null;switch(h){case"facebook.com":return new Nu(I,g);case"github.com":return new Rl(I,g);case"google.com":return new ze(I,g);case"twitter.com":return new ge(I,g,l.screenName||null);case"custom":case"anonymous":return new an(I,null);default:return new an(I,h,g)}}(a)}function ri(l){return(0,K.Ku)(l).signOut()}class un{constructor(s,a,h){this.type=s,this.credential=a,this.user=h}static _fromIdtoken(s,a){return new un("enroll",s,a)}static _fromMfaPendingCredential(s){return new un("signin",s)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(s){var a,h;if(null!=s&&s.multiFactorSession){if(null!==(a=s.multiFactorSession)&&void 0!==a&&a.pendingCredential)return un._fromMfaPendingCredential(s.multiFactorSession.pendingCredential);if(null!==(h=s.multiFactorSession)&&void 0!==h&&h.idToken)return un._fromIdtoken(s.multiFactorSession.idToken)}return null}}class qo{constructor(s,a,h){this.session=s,this.hints=a,this.signInResolver=h}static _fromError(s,a){const h=Ne(s),g=a.customData._serverResponse,I=(g.mfaInfo||[]).map(M=>vr._fromServerResponse(h,M));b(g.mfaPendingCredential,h,"internal-error");const P=un._fromMfaPendingCredential(g.mfaPendingCredential);return new qo(P,I,function(){var M=(0,E.A)(function*(q){const Y=yield q._process(h,P);delete g.mfaInfo,delete g.mfaPendingCredential;const re=Object.assign(Object.assign({},g),{idToken:Y.idToken,refreshToken:Y.refreshToken});switch(a.operationType){case"signIn":const fe=yield pt._fromIdTokenResponse(h,a.operationType,re);return yield h._updateCurrentUser(fe.user),fe;case"reauthenticate":return b(a.user,h,"internal-error"),pt._forOperation(a.user,a.operationType,re);default:Q(h,"internal-error")}});return function(q){return M.apply(this,arguments)}}())}resolveSignIn(s){var a=this;return(0,E.A)(function*(){return a.signInResolver(s)})()}}function Uu(l,s){var a;const h=(0,K.Ku)(l),g=s;return b(s.customData.operationType,h,"argument-error"),b(null===(a=g.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,h,"argument-error"),qo._fromError(h,g)}class ii{constructor(s){this.user=s,this.enrolledFactors=[],s._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(h=>vr._fromServerResponse(s.auth,h)))})}static _fromUser(s){return new ii(s)}getSession(){var s=this;return(0,E.A)(function*(){return un._fromIdtoken(yield s.user.getIdToken(),s.user)})()}enroll(s,a){var h=this;return(0,E.A)(function*(){const g=s,I=yield h.getSession(),P=yield Pt(h.user,g._process(h.user.auth,I,a));return yield h.user._updateTokensIfNecessary(P),h.user.reload()})()}unenroll(s){var a=this;return(0,E.A)(function*(){const h="string"==typeof s?s:s.uid,g=yield a.user.getIdToken();try{const I=yield Pt(a.user,function Vl(l,s){return Ve(l,"POST","/v2/accounts/mfaEnrollment:withdraw",xe(l,s))}(a.user.auth,{idToken:g,mfaEnrollmentId:h}));a.enrolledFactors=a.enrolledFactors.filter(({uid:P})=>P!==h),yield a.user._updateTokensIfNecessary(I),yield a.user.reload()}catch(I){throw I}})()}}const cn=new WeakMap;function qu(l){const s=(0,K.Ku)(l);return cn.has(s)||cn.set(s,ii._fromUser(s)),cn.get(s)}const hs="__sak";class Fe{constructor(s,a){this.storageRetriever=s,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(hs,"1"),this.storage.removeItem(hs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(s,a){return this.storage.setItem(s,JSON.stringify(a)),Promise.resolve()}_get(s){const a=this.storage.getItem(s);return Promise.resolve(a?JSON.parse(a):null)}_remove(s){return this.storage.removeItem(s),Promise.resolve()}get storage(){return this.storageRetriever()}}const At=(()=>{class l extends Fe{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,h)=>this.onStorageEvent(a,h),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function Go(){const l=(0,K.ZQ)();return Ui(l)||jr(l)}()&&function fl(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=ou(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const h of Object.keys(this.listeners)){const g=this.storage.getItem(h),I=this.localCache[h];g!==I&&a(h,I,g)}}onStorageEvent(a,h=!1){if(!a.key)return void this.forAllChangedKeys((M,q,Y)=>{this.notifyListeners(M,Y)});const g=a.key;if(h?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const M=this.storage.getItem(g);if(a.newValue!==M)null!==a.newValue?this.storage.setItem(g,a.newValue):this.storage.removeItem(g);else if(this.localCache[g]===a.newValue&&!h)return}const I=()=>{const M=this.storage.getItem(g);!h&&this.localCache[g]===M||this.notifyListeners(g,M)},P=this.storage.getItem(g);!function dl(){return(0,K.lT)()&&10===document.documentMode}()||P===a.newValue||a.newValue===a.oldValue?I():setTimeout(I,10)}notifyListeners(a,h){this.localCache[a]=h;const g=this.listeners[a];if(g)for(const I of Array.from(g))I(h&&JSON.parse(h))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,h,g)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:h,newValue:g}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,h){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,h){var g=()=>super._set,I=this;return(0,E.A)(function*(){yield g().call(I,a,h),I.localCache[a]=JSON.stringify(h)})()}_get(a){var h=()=>super._get,g=this;return(0,E.A)(function*(){const I=yield h().call(g,a);return g.localCache[a]=JSON.stringify(I),I})()}_remove(a){var h=()=>super._remove,g=this;return(0,E.A)(function*(){yield h().call(g,a),delete g.localCache[a]})()}}return l.type="LOCAL",l})(),fs=(()=>{class l extends Fe{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,h){}_removeListener(a,h){}}return l.type="SESSION",l})();let ju=(()=>{class l{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const h=this.receivers.find(I=>I.isListeningto(a));if(h)return h;const g=new l(a);return this.receivers.push(g),g}isListeningto(a){return this.eventTarget===a}handleEvent(a){var h=this;return(0,E.A)(function*(){const g=a,{eventId:I,eventType:P,data:M}=g.data,q=h.handlersMap[P];if(null==q||!q.size)return;g.ports[0].postMessage({status:"ack",eventId:I,eventType:P});const Y=Array.from(q).map(function(){var fe=(0,E.A)(function*(ut){return ut(g.origin,M)});return function(ut){return fe.apply(this,arguments)}}()),re=yield function zo(l){return Promise.all(l.map(function(){var s=(0,E.A)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(h){return{fulfilled:!1,reason:h}}});return function(a){return s.apply(this,arguments)}}()))}(Y);g.ports[0].postMessage({status:"done",eventId:I,eventType:P,response:re})})()}_subscribe(a,h){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(h)}_unsubscribe(a,h){this.handlersMap[a]&&h&&this.handlersMap[a].delete(h),(!h||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return l.receivers=[],l})();function wr(l="",s=10){let a="";for(let h=0;h<s;h++)a+=Math.floor(10*Math.random());return l+a}class zu{constructor(s){this.target=s,this.handlers=new Set}removeMessageHandler(s){s.messageChannel&&(s.messageChannel.port1.removeEventListener("message",s.onMessage),s.messageChannel.port1.close()),this.handlers.delete(s)}_send(s,a,h=50){var g=this;return(0,E.A)(function*(){const I=typeof MessageChannel<"u"?new MessageChannel:null;if(!I)throw new Error("connection_unavailable");let P,M;return new Promise((q,Y)=>{const re=wr("",20);I.port1.start();const fe=setTimeout(()=>{Y(new Error("unsupported_event"))},h);M={messageChannel:I,onMessage(ut){const yn=ut;if(yn.data.eventId===re)switch(yn.data.status){case"ack":clearTimeout(fe),P=setTimeout(()=>{Y(new Error("timeout"))},3e3);break;case"done":clearTimeout(P),q(yn.data.response);break;default:clearTimeout(fe),clearTimeout(P),Y(new Error("invalid_response"))}}},g.handlers.add(M),I.port1.addEventListener("message",M.onMessage),g.target.postMessage({eventType:s,eventId:re,data:a},[I.port2])}).finally(()=>{M&&g.removeMessageHandler(M)})})()}}function Ke(){return window}function Un(){return typeof Ke().WorkerGlobalScope<"u"&&"function"==typeof Ke().importScripts}function Wo(){return(Wo=(0,E.A)(function*(){if(null==navigator||!navigator.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const $o="firebaseLocalStorageDb",ms="firebaseLocalStorage",Ho="fbase_key";class si{constructor(s){this.request=s}toPromise(){return new Promise((s,a)=>{this.request.addEventListener("success",()=>{s(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function gs(l,s){return l.transaction([ms],s?"readwrite":"readonly").objectStore(ms)}function Nt(){const l=indexedDB.open($o,1);return new Promise((s,a)=>{l.addEventListener("error",()=>{a(l.error)}),l.addEventListener("upgradeneeded",()=>{const h=l.result;try{h.createObjectStore(ms,{keyPath:Ho})}catch(g){a(g)}}),l.addEventListener("success",(0,E.A)(function*(){const h=l.result;h.objectStoreNames.contains(ms)?s(h):(h.close(),yield function Nl(){const l=indexedDB.deleteDatabase($o);return new si(l).toPromise()}(),s(yield Nt()))}))})}function Bn(l,s,a){return _s.apply(this,arguments)}function _s(){return(_s=(0,E.A)(function*(l,s,a){const h=gs(l,!0).put({[Ho]:s,value:a});return new si(h).toPromise()})).apply(this,arguments)}function ys(){return(ys=(0,E.A)(function*(l,s){const a=gs(l,!1).get(s),h=yield new si(a).toPromise();return void 0===h?null:h.value})).apply(this,arguments)}function Ot(l,s){const a=gs(l,!0).delete(s);return new si(a).toPromise()}const oi=(()=>{class l{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,E.A)(function*(){return a.db||(a.db=yield Nt()),a.db})()}_withRetries(a){var h=this;return(0,E.A)(function*(){let g=0;for(;;)try{const I=yield h._openDb();return yield a(I)}catch(I){if(g++>3)throw I;h.db&&(h.db.close(),h.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,E.A)(function*(){return Un()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,E.A)(function*(){a.receiver=ju._getInstance(function ps(){return Un()?self:null}()),a.receiver._subscribe("keyChanged",function(){var h=(0,E.A)(function*(g,I){return{keyProcessed:(yield a._poll()).includes(I.key)}});return function(g,I){return h.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var h=(0,E.A)(function*(g,I){return["keyChanged"]});return function(g,I){return h.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,E.A)(function*(){var h,g;if(a.activeServiceWorker=yield function Ko(){return Wo.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new zu(a.activeServiceWorker);const I=yield a.sender._send("ping",{},800);I&&null!==(h=I[0])&&void 0!==h&&h.fulfilled&&null!==(g=I[0])&&void 0!==g&&g.value.includes("keyChanged")&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var h=this;return(0,E.A)(function*(){if(h.sender&&h.activeServiceWorker&&function Ku(){var l;return(null===(l=null==navigator?void 0:navigator.serviceWorker)||void 0===l?void 0:l.controller)||null}()===h.activeServiceWorker)try{yield h.sender._send("keyChanged",{key:a},h.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,E.A)(function*(){try{if(!indexedDB)return!1;const a=yield Nt();return yield Bn(a,hs,"1"),yield Ot(a,hs),!0}catch{}return!1})()}_withPendingWrite(a){var h=this;return(0,E.A)(function*(){h.pendingWrites++;try{yield a()}finally{h.pendingWrites--}})()}_set(a,h){var g=this;return(0,E.A)(function*(){return g._withPendingWrite((0,E.A)(function*(){return yield g._withRetries(I=>Bn(I,a,h)),g.localCache[a]=h,g.notifyServiceWorker(a)}))})()}_get(a){var h=this;return(0,E.A)(function*(){const g=yield h._withRetries(I=>function Ol(l,s){return ys.apply(this,arguments)}(I,a));return h.localCache[a]=g,g})()}_remove(a){var h=this;return(0,E.A)(function*(){return h._withPendingWrite((0,E.A)(function*(){return yield h._withRetries(g=>Ot(g,a)),delete h.localCache[a],h.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,E.A)(function*(){const h=yield a._withRetries(P=>{const M=gs(P,!1).getAll();return new si(M).toPromise()});if(!h)return[];if(0!==a.pendingWrites)return[];const g=[],I=new Set;if(0!==h.length)for(const{fbase_key:P,value:M}of h)I.add(P),JSON.stringify(a.localCache[P])!==JSON.stringify(M)&&(a.notifyListeners(P,M),g.push(P));for(const P of Object.keys(a.localCache))a.localCache[P]&&!I.has(P)&&(a.notifyListeners(P,null),g.push(P));return g})()}notifyListeners(a,h){this.localCache[a]=h;const g=this.listeners[a];if(g)for(const I of Array.from(g))I(h)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,E.A)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,h){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return l.type="LOCAL",l})(),Rr=1e12;class Qo{constructor(s){this.auth=s,this.counter=Rr,this._widgets=new Map}render(s,a){const h=this.counter;return this._widgets.set(h,new Qu(s,this.auth.name,a||{})),this.counter++,h}reset(s){var a;const h=s||Rr;null===(a=this._widgets.get(h))||void 0===a||a.delete(),this._widgets.delete(h)}getResponse(s){var a;return(null===(a=this._widgets.get(s||Rr))||void 0===a?void 0:a.getResponse())||""}execute(s){var a=this;return(0,E.A)(function*(){var h;return null===(h=a._widgets.get(s||Rr))||void 0===h||h.execute(),""})()}}class Qu{constructor(s,a,h){this.params=h,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const g="string"==typeof s?document.getElementById(s):s;b(g,"argument-error",{appName:a}),this.container=g,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Ju(l){const s=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let h=0;h<l;h++)s.push(a.charAt(Math.floor(62*Math.random())));return s.join("")}(50);const{callback:s,"expired-callback":a}=this.params;if(s)try{s(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Jo=Eo("rcb"),Yu=new F(3e4,6e4);class Xu{constructor(){var s;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(s=Ke().grecaptcha)||void 0===s||!s.render)}load(s,a=""){return b(function Is(l){return l.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(l)}(a),s,"argument-error"),this.shouldResolveImmediately(a)&&co(Ke().grecaptcha)?Promise.resolve(Ke().grecaptcha):new Promise((h,g)=>{const I=Ke().setTimeout(()=>{g(se(s,"network-request-failed"))},Yu.get());Ke()[Jo]=()=>{Ke().clearTimeout(I),delete Ke()[Jo];const M=Ke().grecaptcha;if(!M||!co(M))return void g(se(s,"internal-error"));const q=M.render;M.render=(Y,re)=>{const fe=q(Y,re);return this.counter++,fe},this.hostLanguage=a,h(M)},je(`${function lu(){return zr.recaptchaV2Script}()}?${(0,K.Am)({onload:Jo,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(I),g(se(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(s){var a;return!(null===(a=Ke().grecaptcha)||void 0===a||!a.render)&&(s===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class ui{load(s){return(0,E.A)(function*(){return new Qo(s)})()}clearedOneInstance(){}}const ln="recaptcha",Fl={theme:"light",type:"image"};class Zu{constructor(s,a,h=Object.assign({},Fl)){this.parameters=h,this.type=ln,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ne(s),this.isInvisible="invisible"===this.parameters.size,b(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const g="string"==typeof a?document.getElementById(a):a;b(g,this.auth,"argument-error"),this.container=g,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new ui:new Xu,this.validateStartingState()}verify(){var s=this;return(0,E.A)(function*(){s.assertNotDestroyed();const a=yield s.render(),h=s.getAssertedRecaptcha();return h.getResponse(a)||new Promise(I=>{const P=M=>{M&&(s.tokenChangeListeners.delete(P),I(M))};s.tokenChangeListeners.add(P),s.isInvisible&&h.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(s){return Promise.reject(s)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(s=>{throw this.renderPromise=null,s})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(s=>{this.container.removeChild(s)})}validateStartingState(){b(!this.parameters.sitekey,this.auth,"argument-error"),b(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),b(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(s){return a=>{if(this.tokenChangeListeners.forEach(h=>h(a)),"function"==typeof s)s(a);else if("string"==typeof s){const h=Ke()[s];"function"==typeof h&&h(a)}}}assertNotDestroyed(){b(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var s=this;return(0,E.A)(function*(){if(yield s.init(),!s.widgetId){let a=s.container;if(!s.isInvisible){const h=document.createElement("div");a.appendChild(h),a=h}s.widgetId=s.getAssertedRecaptcha().render(a,s.parameters)}return s.widgetId})()}init(){var s=this;return(0,E.A)(function*(){b(J()&&!Un(),s.auth,"internal-error"),yield function Ul(){let l=null;return new Promise(s=>{"complete"!==document.readyState?(l=()=>s(),window.addEventListener("load",l)):s()}).catch(s=>{throw l&&window.removeEventListener("load",l),s})}(),s.recaptcha=yield s._recaptchaLoader.load(s.auth,s.auth.languageCode||void 0);const a=yield function Ur(l){return he.apply(this,arguments)}(s.auth);b(a,s.auth,"internal-error"),s.parameters.sitekey=a})()}getAssertedRecaptcha(){return b(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Yo{constructor(s,a){this.verificationId=s,this.onConfirmation=a}confirm(s){const a=sn._fromVerification(this.verificationId,s);return this.onConfirmation(a)}}function Bl(l,s,a){return zn.apply(this,arguments)}function zn(){return(zn=(0,E.A)(function*(l,s,a){if((0,oe._isFirebaseServerApp)(l.app))return Promise.reject(ce(l));const h=Ne(l),g=yield ci(h,s,(0,K.Ku)(a));return new Yo(g,I=>Zr(h,I))})).apply(this,arguments)}function Kn(l,s,a){return Mt.apply(this,arguments)}function Mt(){return(Mt=(0,E.A)(function*(l,s,a){const h=(0,K.Ku)(l);yield _r(!1,h,"phone");const g=yield ci(h.auth,s,(0,K.Ku)(a));return new Yo(g,I=>Tu(h,I))})).apply(this,arguments)}function ec(l,s,a){return vs.apply(this,arguments)}function vs(){return(vs=(0,E.A)(function*(l,s,a){const h=(0,K.Ku)(l);if((0,oe._isFirebaseServerApp)(h.auth.app))return Promise.reject(ce(h.auth));const g=yield ci(h.auth,s,(0,K.Ku)(a));return new Yo(g,I=>Eu(h,I))})).apply(this,arguments)}function ci(l,s,a){return Xo.apply(this,arguments)}function Xo(){return Xo=(0,E.A)(function*(l,s,a){var h;const g=yield a.verify();try{let I;if(b("string"==typeof g,l,"argument-error"),b(a.type===ln,l,"argument-error"),I="string"==typeof s?{phoneNumber:s}:s,"session"in I){const P=I.session;if("phoneNumber"in I)return b("enroll"===P.type,l,"internal-error"),(yield function Bu(l,s){return Ve(l,"POST","/v2/accounts/mfaEnrollment:start",xe(l,s))}(l,{idToken:P.credential,phoneEnrollmentInfo:{phoneNumber:I.phoneNumber,recaptchaToken:g}})).phoneSessionInfo.sessionInfo;{b("signin"===P.type,l,"internal-error");const M=(null===(h=I.multiFactorHint)||void 0===h?void 0:h.uid)||I.multiFactorUid;return b(M,l,"missing-multi-factor-info"),(yield function qn(l,s){return Ve(l,"POST","/v2/accounts/mfaSignIn:start",xe(l,s))}(l,{mfaPendingCredential:P.credential,mfaEnrollmentId:M,phoneSignInInfo:{recaptchaToken:g}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:P}=yield function yu(l,s){return Dn.apply(this,arguments)}(l,{phoneNumber:I.phoneNumber,recaptchaToken:g});return P}}finally{a._reset()}}),Xo.apply(this,arguments)}function Zo(l,s){return li.apply(this,arguments)}function li(){return(li=(0,E.A)(function*(l,s){const a=(0,K.Ku)(l);if((0,oe._isFirebaseServerApp)(a.auth.app))return Promise.reject(ce(a.auth));yield Qi(a,s)})).apply(this,arguments)}let tc=(()=>{class l{constructor(a){this.providerId=l.PROVIDER_ID,this.auth=Ne(a)}verifyPhoneNumber(a,h){return ci(this.auth,a,(0,K.Ku)(h))}static credential(a,h){return sn._fromVerification(a,h)}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:h,temporaryProof:g}=a;return h&&g?sn._fromTokenResponse(h,g):null}}return l.PROVIDER_ID="phone",l.PHONE_SIGN_IN_METHOD="phone",l})();function Qt(l,s){return s?vt(s):(b(l._popupRedirectResolver,l,"argument-error"),l._popupRedirectResolver)}class hi extends xt{constructor(s){super("custom","custom"),this.params=s}_getIdTokenResponse(s){return kt(s,this._buildIdpRequest())}_linkToIdToken(s,a){return kt(s,this._buildIdpRequest(a))}_getReauthenticationResolver(s){return kt(s,this._buildIdpRequest())}_buildIdpRequest(s){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return s&&(a.idToken=s),a}}function nc(l){return Nn(l.auth,new hi(l),l.bypassAuthState)}function Ts(l){const{auth:s,user:a}=l;return b(a,s,"internal-error"),Ir(a,new hi(l),l.bypassAuthState)}function ql(l){return di.apply(this,arguments)}function di(){return(di=(0,E.A)(function*(l){const{auth:s,user:a}=l;return b(a,s,"internal-error"),Qi(a,new hi(l),l.bypassAuthState)})).apply(this,arguments)}class fi{constructor(s,a,h,g,I=!1){this.auth=s,this.resolver=h,this.user=g,this.bypassAuthState=I,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var s=this;return new Promise(function(){var a=(0,E.A)(function*(h,g){s.pendingPromise={resolve:h,reject:g};try{s.eventManager=yield s.resolver._initialize(s.auth),yield s.onExecution(),s.eventManager.registerConsumer(s)}catch(I){s.reject(I)}});return function(h,g){return a.apply(this,arguments)}}())}onAuthEvent(s){var a=this;return(0,E.A)(function*(){const{urlResponse:h,sessionId:g,postBody:I,tenantId:P,error:M,type:q}=s;if(M)return void a.reject(M);const Y={auth:a.auth,requestUri:h,sessionId:g,tenantId:P||void 0,postBody:I||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(q)(Y))}catch(re){a.reject(re)}})()}onError(s){this.reject(s)}getIdpTask(s){switch(s){case"signInViaPopup":case"signInViaRedirect":return nc;case"linkViaPopup":case"linkViaRedirect":return ql;case"reauthViaPopup":case"reauthViaRedirect":return Ts;default:Q(this.auth,"internal-error")}}resolve(s){Le(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(s),this.unregisterAndCleanUp()}reject(s){Le(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(s),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Gl=new F(2e3,1e4);function rc(l,s,a){return hn.apply(this,arguments)}function hn(){return(hn=(0,E.A)(function*(l,s,a){if((0,oe._isFirebaseServerApp)(l.app))return Promise.reject(se(l,"operation-not-supported-in-this-environment"));const h=Ne(l);we(l,s,jt);const g=Qt(h,a);return new Xe(h,"signInViaPopup",s,g).executeNotNull()})).apply(this,arguments)}function pi(l,s,a){return dn.apply(this,arguments)}function dn(){return(dn=(0,E.A)(function*(l,s,a){const h=(0,K.Ku)(l);if((0,oe._isFirebaseServerApp)(h.auth.app))return Promise.reject(se(h.auth,"operation-not-supported-in-this-environment"));we(h.auth,s,jt);const g=Qt(h.auth,a);return new Xe(h.auth,"reauthViaPopup",s,g,h).executeNotNull()})).apply(this,arguments)}function ic(l,s,a){return Es.apply(this,arguments)}function Es(){return(Es=(0,E.A)(function*(l,s,a){const h=(0,K.Ku)(l);we(h.auth,s,jt);const g=Qt(h.auth,a);return new Xe(h.auth,"linkViaPopup",s,g,h).executeNotNull()})).apply(this,arguments)}let Xe=(()=>{class l extends fi{constructor(a,h,g,I,P){super(a,h,I,P),this.provider=g,this.authWindow=null,this.pollId=null,l.currentPopupAction&&l.currentPopupAction.cancel(),l.currentPopupAction=this}executeNotNull(){var a=this;return(0,E.A)(function*(){const h=yield a.execute();return b(h,a.auth,"internal-error"),h})()}onExecution(){var a=this;return(0,E.A)(function*(){Le(1===a.filter.length,"Popup operations only handle one event");const h=wr();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],h),a.authWindow.associatedEvent=h,a.resolver._originValidation(a.auth).catch(g=>{a.reject(g)}),a.resolver._isIframeWebStorageSupported(a.auth,g=>{g||a.reject(se(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(se(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,l.currentPopupAction=null}pollUserCancellation(){const a=()=>{var h,g;this.pollId=null!==(g=null===(h=this.authWindow)||void 0===h?void 0:h.window)&&void 0!==g&&g.closed?window.setTimeout(()=>{this.pollId=null,this.reject(se(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(a,Gl.get())};a()}}return l.currentPopupAction=null,l})();const sc="pendingRedirect",fn=new Map;class As extends fi{constructor(s,a,h=!1){super(s,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,h),this.eventId=null}execute(){var s=()=>super.execute,a=this;return(0,E.A)(function*(){let h=fn.get(a.auth._key());if(!h){try{const I=(yield function oc(l,s){return Lt.apply(this,arguments)}(a.resolver,a.auth))?yield s().call(a):null;h=()=>Promise.resolve(I)}catch(g){h=()=>Promise.reject(g)}fn.set(a.auth._key(),h)}return a.bypassAuthState||fn.set(a.auth._key(),()=>Promise.resolve(null)),h()})()}onAuthEvent(s){var a=()=>super.onAuthEvent,h=this;return(0,E.A)(function*(){if("signInViaRedirect"===s.type)return a().call(h,s);if("unknown"!==s.type){if(s.eventId){const g=yield h.auth._redirectUserForId(s.eventId);if(g)return h.user=g,a().call(h,s);h.resolve(null)}}else h.resolve(null)})()}onExecution(){return(0,E.A)(function*(){})()}cleanUp(){}}function Lt(){return(Lt=(0,E.A)(function*(l,s){const a=ea(s),h=$n(l);if(!(yield h._isAvailable()))return!1;const g="true"===(yield h._get(a));return yield h._remove(a),g})).apply(this,arguments)}function pn(l,s){return ws.apply(this,arguments)}function ws(){return(ws=(0,E.A)(function*(l,s){return $n(l)._set(ea(s),"true")})).apply(this,arguments)}function Wn(){fn.clear()}function ac(l,s){fn.set(l._key(),s)}function $n(l){return vt(l._redirectPersistence)}function ea(l){return sr(sc,l.config.apiKey,l.name)}function mn(l,s,a){return function uc(l,s,a){return ta.apply(this,arguments)}(l,s,a)}function ta(){return(ta=(0,E.A)(function*(l,s,a){if((0,oe._isFirebaseServerApp)(l.app))return Promise.reject(ce(l));const h=Ne(l);we(l,s,jt),yield h._initializationPromise;const g=Qt(h,a);return yield pn(g,h),g._openRedirect(h,s,"signInViaRedirect")})).apply(this,arguments)}function cc(l,s,a){return function jl(l,s,a){return Rs.apply(this,arguments)}(l,s,a)}function Rs(){return(Rs=(0,E.A)(function*(l,s,a){const h=(0,K.Ku)(l);if(we(h.auth,s,jt),(0,oe._isFirebaseServerApp)(h.auth.app))return Promise.reject(ce(h.auth));yield h.auth._initializationPromise;const g=Qt(h.auth,a);yield pn(g,h.auth);const I=yield gn(h);return g._openRedirect(h.auth,s,"reauthViaRedirect",I)})).apply(this,arguments)}function zl(l,s,a){return function Ps(l,s,a){return Ss.apply(this,arguments)}(l,s,a)}function Ss(){return(Ss=(0,E.A)(function*(l,s,a){const h=(0,K.Ku)(l);we(h.auth,s,jt),yield h.auth._initializationPromise;const g=Qt(h.auth,a);yield _r(!1,h,s.providerId),yield pn(g,h.auth);const I=yield gn(h);return g._openRedirect(h.auth,s,"linkViaRedirect",I)})).apply(this,arguments)}function Kl(l,s){return bs.apply(this,arguments)}function bs(){return(bs=(0,E.A)(function*(l,s){return yield Ne(l)._initializationPromise,na(l,s,!1)})).apply(this,arguments)}function na(l,s){return Cs.apply(this,arguments)}function Cs(){return(Cs=(0,E.A)(function*(l,s,a=!1){if((0,oe._isFirebaseServerApp)(l.app))return Promise.reject(ce(l));const h=Ne(l),g=Qt(h,s),P=yield new As(h,g,a).execute();return P&&!a&&(delete P.user._redirectEventId,yield h._persistUserIfCurrent(P.user),yield h._setRedirectUser(null,s)),P})).apply(this,arguments)}function gn(l){return Hn.apply(this,arguments)}function Hn(){return(Hn=(0,E.A)(function*(l){const s=wr(`${l.uid}:::`);return l._redirectEventId=s,yield l.auth._setRedirectUser(l),yield l.auth._persistUserIfCurrent(l),s})).apply(this,arguments)}class ra{constructor(s){this.auth=s,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(s){this.consumers.add(s),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,s)&&(this.sendToConsumer(this.queuedRedirectEvent,s),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(s){this.consumers.delete(s)}onEvent(s){if(this.hasEventBeenHandled(s))return!1;let a=!1;return this.consumers.forEach(h=>{this.isEventForConsumer(s,h)&&(a=!0,this.sendToConsumer(s,h),this.saveEventToCache(s))}),this.hasHandledPotentialRedirect||!function Wl(l){switch(l.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ia(l);default:return!1}}(s)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=s,a=!0)),a}sendToConsumer(s,a){var h;if(s.error&&!ia(s)){const g=(null===(h=s.error.code)||void 0===h?void 0:h.split("auth/")[1])||"internal-error";a.onError(se(this.auth,g))}else a.onAuthEvent(s)}isEventForConsumer(s,a){const h=null===a.eventId||!!s.eventId&&s.eventId===a.eventId;return a.filter.includes(s.type)&&h}hasEventBeenHandled(s){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(hc(s))}saveEventToCache(s){this.cachedEventUids.add(hc(s)),this.lastProcessedEventTime=Date.now()}}function hc(l){return[l.type,l.eventId,l.sessionId,l.tenantId].filter(s=>s).join("-")}function ia({type:l,error:s}){return"unknown"===l&&"auth/no-auth-event"===(null==s?void 0:s.code)}function dc(l){return mi.apply(this,arguments)}function mi(){return(mi=(0,E.A)(function*(l,s={}){return Ve(l,"GET","/v1/projects",s)})).apply(this,arguments)}const Ze=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$l=/^https?/;function sa(){return(sa=(0,E.A)(function*(l){if(l.config.emulator)return;const{authorizedDomains:s}=yield dc(l);for(const a of s)try{if(Ql(a))return}catch{}Q(l,"unauthorized-domain")})).apply(this,arguments)}function Ql(l){const s=Cn(),{protocol:a,hostname:h}=new URL(s);if(l.startsWith("chrome-extension://")){const P=new URL(l);return""===P.hostname&&""===h?"chrome-extension:"===a&&l.replace("chrome-extension://","")===s.replace("chrome-extension://",""):"chrome-extension:"===a&&P.hostname===h}if(!$l.test(a))return!1;if(Ze.test(l))return h===l;const g=l.replace(/\./g,"\\.");return new RegExp("^(.+\\."+g+"|"+g+")$","i").test(h)}const oa=new F(3e4,6e4);function fc(){const l=Ke().___jsl;if(null!=l&&l.H)for(const s of Object.keys(l.H))if(l.H[s].r=l.H[s].r||[],l.H[s].L=l.H[s].L||[],l.H[s].r=[...l.H[s].L],l.CP)for(let a=0;a<l.CP.length;a++)l.CP[a]=null}let Qn=null;const pc=new F(5e3,15e3),aa="__/auth/iframe",ua="emulator/auth/iframe",gi={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Vs=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ca(l){const s=l.config;b(s.authDomain,l,"auth-domain-config-required");const a=s.emulator?G(s,ua):`https://${l.config.authDomain}/${aa}`,h={apiKey:s.apiKey,appName:l.name,v:oe.SDK_VERSION},g=Vs.get(l.config.apiHost);g&&(h.eid=g);const I=l._getFrameworks();return I.length&&(h.fw=I.join(",")),`${a}?${(0,K.Am)(h).slice(1)}`}function ha(){return ha=(0,E.A)(function*(l){const s=yield function Jl(l){return Qn=Qn||function xs(l){return new Promise((s,a)=>{var h,g,I;function P(){fc(),gapi.load("gapi.iframes",{callback:()=>{s(gapi.iframes.getContext())},ontimeout:()=>{fc(),a(se(l,"network-request-failed"))},timeout:oa.get()})}if(null!==(g=null===(h=Ke().gapi)||void 0===h?void 0:h.iframes)&&void 0!==g&&g.Iframe)s(gapi.iframes.getContext());else{if(null===(I=Ke().gapi)||void 0===I||!I.load){const M=Eo("iframefcb");return Ke()[M]=()=>{gapi.load?P():a(se(l,"network-request-failed"))},je(`${function hu(){return zr.gapiScript}()}?onload=${M}`).catch(q=>a(q))}P()}}).catch(s=>{throw Qn=null,s})}(l),Qn}(l),a=Ke().gapi;return b(a,l,"internal-error"),s.open({where:document.body,url:ca(l),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gi,dontclear:!0},h=>new Promise(function(){var g=(0,E.A)(function*(I,P){yield h.restyle({setHideOnLeave:!1});const M=se(l,"network-request-failed"),q=Ke().setTimeout(()=>{P(M)},pc.get());function Y(){Ke().clearTimeout(q),I(h)}h.ping(Y).then(Y,()=>{P(M)})});return function(I,P){return g.apply(this,arguments)}}()))}),ha.apply(this,arguments)}const mc={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class yc{constructor(s){this.window=s,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const vc="__/auth/handler",Zl="emulator/auth/handler",Pr=encodeURIComponent("fac");function _n(l,s,a,h,g,I){return _i.apply(this,arguments)}function _i(){return(_i=(0,E.A)(function*(l,s,a,h,g,I){b(l.config.authDomain,l,"auth-domain-config-required"),b(l.config.apiKey,l,"invalid-api-key");const P={apiKey:l.config.apiKey,appName:l.name,authType:a,redirectUrl:h,v:oe.SDK_VERSION,eventId:g};if(s instanceof jt){s.setDefaultLanguage(l.languageCode),P.providerId=s.providerId||"",(0,K.Im)(s.getCustomParameters())||(P.customParameters=JSON.stringify(s.getCustomParameters()));for(const[re,fe]of Object.entries(I||{}))P[re]=fe}if(s instanceof dr){const re=s.getScopes().filter(fe=>""!==fe);re.length>0&&(P.scopes=re.join(","))}l.tenantId&&(P.tid=l.tenantId);const M=P;for(const re of Object.keys(M))void 0===M[re]&&delete M[re];const q=yield l._getAppCheckToken(),Y=q?`#${Pr}=${encodeURIComponent(q)}`:"";return`${function ks({config:l}){return l.emulator?G(l,Zl):`https://${l.authDomain}/${vc}`}(l)}?${(0,K.Am)(M).slice(1)}${Y}`})).apply(this,arguments)}const Ds="webStorageSupport",fa=class Tc{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=fs,this._completeRedirectFn=na,this._overrideRedirectResult=ac}_openPopup(s,a,h,g){var I=this;return(0,E.A)(function*(){var P;Le(null===(P=I.eventManagers[s._key()])||void 0===P?void 0:P.manager,"_initialize() not called before _openPopup()");const M=yield _n(s,a,h,Cn(),g);return function Ic(l,s,a,h=500,g=600){const I=Math.max((window.screen.availHeight-g)/2,0).toString(),P=Math.max((window.screen.availWidth-h)/2,0).toString();let M="";const q=Object.assign(Object.assign({},mc),{width:h.toString(),height:g.toString(),top:I,left:P}),Y=(0,K.ZQ)().toLowerCase();a&&(M=nu(Y)?"_blank":a),Gr(Y)&&(s=s||"http://localhost",q.scrollbars="yes");const re=Object.entries(q).reduce((ut,[yn,In])=>`${ut}${yn}=${In},`,"");if(function hl(l=(0,K.ZQ)()){var s;return jr(l)&&!(null===(s=window.navigator)||void 0===s||!s.standalone)}(Y)&&"_self"!==M)return function Xl(l,s){const a=document.createElement("a");a.href=l,a.target=s;const h=document.createEvent("MouseEvent");h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(h)}(s||"",M),new yc(null);const fe=window.open(s||"",M,re);b(fe,l,"popup-blocked");try{fe.focus()}catch{}return new yc(fe)}(s,M,wr())})()}_openRedirect(s,a,h,g){var I=this;return(0,E.A)(function*(){return yield I._originValidation(s),function Dl(l){Ke().location.href=l}(yield _n(s,a,h,Cn(),g)),new Promise(()=>{})})()}_initialize(s){const a=s._key();if(this.eventManagers[a]){const{manager:g,promise:I}=this.eventManagers[a];return g?Promise.resolve(g):(Le(I,"If manager is not set, promise should be"),I)}const h=this.initAndGetManager(s);return this.eventManagers[a]={promise:h},h.catch(()=>{delete this.eventManagers[a]}),h}initAndGetManager(s){var a=this;return(0,E.A)(function*(){const h=yield function la(l){return ha.apply(this,arguments)}(s),g=new ra(s);return h.register("authEvent",I=>(b(null==I?void 0:I.authEvent,s,"invalid-auth-event"),{status:g.onEvent(I.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[s._key()]={manager:g},a.iframes[s._key()]=h,g})()}_isIframeWebStorageSupported(s,a){this.iframes[s._key()].send(Ds,{type:Ds},g=>{var I;const P=null===(I=null==g?void 0:g[0])||void 0===I?void 0:I[Ds];void 0!==P&&a(!!P),Q(s,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(s){const a=s._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Hl(l){return sa.apply(this,arguments)}(s)),this.originValidationPromises[a]}get _shouldInitProactively(){return ou()||Ui()||jr()}};class Ec{constructor(s){this.factorId=s}_process(s,a,h){switch(a.type){case"enroll":return this._finalizeEnroll(s,a.credential,h);case"signin":return this._finalizeSignIn(s,a.credential);default:return ye("unexpected MultiFactorSessionType")}}}class yi extends Ec{constructor(s){super("phone"),this.credential=s}static _fromCredential(s){return new yi(s)}_finalizeEnroll(s,a,h){return function Cl(l,s){return Ve(l,"POST","/v2/accounts/mfaEnrollment:finalize",xe(l,s))}(s,{idToken:a,displayName:h,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(s,a){return function Gn(l,s){return Ve(l,"POST","/v2/accounts/mfaSignIn:finalize",xe(l,s))}(s,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let eh=(()=>{class l{constructor(){}static assertion(a){return yi._fromCredential(a)}}return l.FACTOR_ID="phone",l})();var Ii="@firebase/auth";class Os{constructor(s){this.auth=s,this.internalListeners=new Map}getUid(){var s;return this.assertAuthConfigured(),(null===(s=this.auth.currentUser)||void 0===s?void 0:s.uid)||null}getToken(s){var a=this;return(0,E.A)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(s)}:null})()}addAuthTokenListener(s){if(this.assertAuthConfigured(),this.internalListeners.has(s))return;const a=this.auth.onIdTokenChanged(h=>{s((null==h?void 0:h.stsTokenManager.accessToken)||null)});this.internalListeners.set(s,a),this.updateProactiveRefresh()}removeAuthTokenListener(s){this.assertAuthConfigured();const a=this.internalListeners.get(s);a&&(this.internalListeners.delete(s),a(),this.updateProactiveRefresh())}assertAuthConfigured(){b(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const wc=(0,K.XA)("authIdTokenMaxAge")||300;let Rc=null;const Pc=l=>function(){var s=(0,E.A)(function*(a){const h=a&&(yield a.getIdTokenResult()),g=h&&((new Date).getTime()-Date.parse(h.issuedAtTime))/1e3;if(g&&g>wc)return;const I=null==h?void 0:h.token;Rc!==I&&(Rc=I,yield fetch(l,{method:I?"POST":"DELETE",headers:I?{Authorization:`Bearer ${I}`}:{}}))});return function(a){return s.apply(this,arguments)}}();function Ms(l=(0,oe.getApp)()){const s=(0,oe._getProvider)(l,"auth");if(s.isInitialized())return s.getImmediate();const a=function He(l,s){const a=(0,oe._getProvider)(l,"auth");if(a.isInitialized()){const g=a.getImmediate(),I=a.getOptions();if((0,K.bD)(I,null!=s?s:{}))return g;Q(g,"already-initialized")}return a.initialize({options:s})}(l,{popupRedirectResolver:fa,persistence:[oi,At,fs]}),h=(0,K.XA)("authTokenSyncURL");if(h&&"boolean"==typeof isSecureContext&&isSecureContext){const I=new URL(h,location.origin);if(location.origin===I.origin){const P=Pc(I.toString());(function Lu(l,s,a){(0,K.Ku)(l).beforeAuthStateChanged(s,a)})(a,P,()=>P(a.currentUser)),function Mu(l,s,a,h){(0,K.Ku)(l).onIdTokenChanged(s,a,h)}(a,M=>P(M))}}const g=(0,K.Tj)("auth");return g&&Ct(a,`http://${g}`),a}(function To(l){zr=l})({loadJS:l=>new Promise((s,a)=>{const h=document.createElement("script");h.setAttribute("src",l),h.onload=s,h.onerror=g=>{const I=se("internal-error");I.customData=g,a(I)},h.type="text/javascript",h.charset="UTF-8",function ya(){var l,s;return null!==(s=null===(l=document.getElementsByTagName("head"))||void 0===l?void 0:l[0])&&void 0!==s?s:document}().appendChild(h)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),function ga(l){(0,oe._registerComponent)(new wn.uA("auth",(s,{options:a})=>{const h=s.getProvider("app").getImmediate(),g=s.getProvider("heartbeat"),I=s.getProvider("app-check-internal"),{apiKey:P,authDomain:M}=h.options;b(P&&!P.includes(":"),"invalid-api-key",{appName:h.name});const q={apiKey:P,authDomain:M,clientPlatform:l,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:au(l)},Y=new cu(h,g,I,q);return function _l(l,s){const a=(null==s?void 0:s.persistence)||[],h=(Array.isArray(a)?a:[a]).map(vt);null!=s&&s.errorMap&&l._updateErrorMap(s.errorMap),l._initializeWithPersistence(h,null==s?void 0:s.popupRedirectResolver)}(Y,a),Y},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((s,a,h)=>{s.getProvider("auth-internal").initialize()})),(0,oe._registerComponent)(new wn.uA("auth-internal",s=>{const a=Ne(s.getProvider("auth").getImmediate());return new Os(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,oe.registerVersion)(Ii,"1.7.4",function ma(l){switch(l){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(l)),(0,oe.registerVersion)(Ii,"1.7.4","esm2017")}("Browser")},5075:(al,er,X)=>{X.r(er),X.d(er,{HomePageModule:()=>bn});var E=X(177),oe=X(5150),K=X(4341),$e=X(70),Ae=X(467),wn=X(7231),Mr=X(3273),k=X(3953);function so(Q,se){if(1&Q&&(k.j41(0,"li",20)(1,"a",57),k.EFF(2),k.k0s()()),2&Q){const _e=se.$implicit;k.R7$(),k.Mz_("href","/brand/",_e.name,"",k.B4B),k.Mz_("routerLink","/brand/",_e.name,""),k.R7$(),k.JRh(_e.name.toUpperCase())}}function Lr(Q,se){1&Q&&(k.j41(0,"li",12)(1,"a",58)(2,"ion-text",14),k.EFF(3,"SIGN IN"),k.k0s()()())}function It(Q,se){1&Q&&(k.j41(0,"li",12)(1,"a",61)(2,"ion-text",14),k.EFF(3,"ADD VEHICLE"),k.k0s()()(),k.j41(4,"li",12)(5,"a",62)(6,"ion-text",14),k.EFF(7,"ADD BRAND"),k.k0s()()())}function ki(Q,se){if(1&Q){const _e=k.RV6();k.DNE(0,It,8,0),k.j41(1,"li",12)(2,"a",59),k.bIt("click",function(){k.eBV(_e);const we=k.XpG();return k.Njj(we.signOuter())}),k.j41(3,"ion-text",60),k.EFF(4,"SIGN OUT"),k.k0s()()()}if(2&Q){const _e=k.XpG();k.vxM(_e.email&&"mailer"==_e.email?0:-1)}}function Fr(Q,se){if(1&Q&&(k.j41(0,"li")(1,"a",57),k.EFF(2),k.k0s()()),2&Q){const _e=se.$implicit;k.R7$(),k.Mz_("href","/brand/",_e.name,"",k.B4B),k.Mz_("routerLink","/brand/",_e.name,""),k.R7$(),k.JRh(_e.name.toUpperCase())}}function Rn(Q,se){1&Q&&(k.j41(0,"li",35)(1,"a",58)(2,"ion-text",14),k.EFF(3,"SIGN IN"),k.k0s()()())}function Di(Q,se){1&Q&&(k.j41(0,"li",35)(1,"a",61)(2,"ion-text",14),k.EFF(3,"ADD VEHICLE"),k.k0s()()(),k.j41(4,"li",35)(5,"a",62)(6,"ion-text",14),k.EFF(7,"ADD BRAND"),k.k0s()()())}function Pn(Q,se){if(1&Q){const _e=k.RV6();k.DNE(0,Di,8,0),k.j41(1,"li",35)(2,"a",59),k.bIt("click",function(){k.eBV(_e);const we=k.XpG();return k.Njj(we.signOuter())}),k.j41(3,"ion-text",60),k.EFF(4,"SIGN OUT"),k.k0s()()()}if(2&Q){const _e=k.XpG();k.vxM(_e.email&&"mailer"==_e.email?0:-1)}}const Sn=[{path:"",component:(()=>{var Q;class se{constructor(){this.brands=[],this.loggedin=!1;var ce=(0,wn.xI)();this.db=(0,Mr.aU)(),ce.onAuthStateChanged(we=>{we?(this.loggedin=!0,this.email=we.email?"mailer":void 0):(this.loggedin=!1,this.email=void 0)}),this.getBrands()}getBrands(){var ce=this;return(0,Ae.A)(function*(){var we=[];(yield(0,Mr.GG)((0,Mr.rJ)(ce.db,"brands"))).forEach(b=>{var ye=b.data();ye.id=b.id,we.push(ye)}),ce.brands=we})()}signOuter(){var ce=(0,wn.xI)();(0,wn.CI)(ce).then(()=>{console.log("Sign-out successful")}).catch(we=>{console.log("An error happened")})}}return(Q=se).\u0275fac=function(ce){return new(ce||Q)},Q.\u0275cmp=k.VBU({type:Q,selectors:[["app-home"]],decls:106,vars:2,consts:[["mode","ios",2,"scrollbar-width","thin"],["slot","fixed","horizontal","end","vertical","bottom",1,"me-3","mb-3"],["href","tel:+254725603808",1,"hover-text"],["id","left",1,"tooltip-text"],[1,"pop"],["name","call-sharp"],[1,"wrapper"],["tabindex","-1","id","navbarSupportedContent",1,"offcanvas","offcanvas-start","primary-bg",2,"max-width","75%"],[1,"navbar-nav","me-0","mb-2","mb-lg-0","nav-underline"],["data-bs-toggle","offcanvas","data-bs-target","#navbarSupportedContent",1,"nav-item","m-2"],["href","/",1,"navbar-brand"],["src","../../assets/Logo.png","alt","Dev Motors Logo","height","140","onerror","this.onerror=null;this.src='assets/Logo.png';",1,"rounded","m-auto","w-100","object-fit-cover"],["data-bs-toggle","offcanvas","data-bs-target","#navbarSupportedContent",1,"nav-item","ps-3"],["routerLink","/home","routerLinkActive","active","aria-current","page","href","#",1,"nav-link","active","open-sans-simple"],["color","dark"],["routerLink","/show-room","routerLinkActive","active","aria-current","page",1,"nav-link","active","open-sans-simple"],["routerLink","/downloads","routerLinkActive","active","aria-current","page",1,"nav-link","active","open-sans-simple"],[1,"nav-item","ps-3","dropdown"],["role","button","data-bs-toggle","dropdown","aria-expanded","false",1,"nav-link","dropdown-toggle","open-sans-simple"],["data-bs-theme","dark",1,"dropdown-menu"],["data-bs-toggle","offcanvas","data-bs-target","#navbarSupportedContent"],[1,"dropdown-divider"],["href","/brand/Others","routerLink","/brand/Others","routerLinkActive","active",1,"dropdown-item","open-sans-simple"],["role","search",1,"d-flex"],[1,"position-relative","ps-3"],["size","small","type","submit","routerLink","/search","data-bs-toggle","offcanvas","data-bs-target","#navbarSupportedContent"],["name","search-outline"],[1,"navbar","navbar-expand-lg","sticky-top","pt-5","shadow-sm","primary-bg"],[1,"container-fluid","padder"],["src","../../assets/Logo.png","alt","Dev Motors Logo","width","90","height","40","onerror","this.onerror=null;this.src='assets/Logo.png';",1,"rounded"],["type","button","data-bs-toggle","offcanvas","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler","p-0","fs-3"],["fill","clear","size","large"],["name","menu-outline","color","light"],[1,"collapse","navbar-collapse"],[1,"navbar-nav","me-auto","mb-2","mb-lg-0","nav-underline"],[1,"nav-item"],[1,"nav-item","dropdown"],["routerLinkActive","active","href","#","role","button","data-bs-toggle","dropdown","aria-expanded","false",1,"nav-link","dropdown-toggle","open-sans-simple"],[1,"position-relative"],["size","small","type","submit","routerLink","/search"],[1,"offcanvas-body"],[1,"container-fluid","ps-5","pe-5","mt-2","pb-4","shadow-sm"],[1,"d-flex","flex-wrap","justify-content-between","align-items-center","py-3","my-4"],[1,"d-flex","flex-wrap","justify-content-between","align-items-center","w-100"],[1,"nav","col-md-4","justify-content-end","list-unstyled","d-flex","align-items-center","py-3","my-4","border-bottom","w-100"],[1,"ms-3"],["href","https://www.tiktok.com/@ferrari","target","_blank",1,"darker-txt"],[1,"bi","bi-tiktok"],["href","https://www.facebook.com/Ferrari","target","_blank",1,"text-primary"],[1,"bi","bi-facebook"],[1,"col-md-4","mb-0","darker-txt"],["href","/",1,"col-md-4","d-flex","align-items-center","justify-content-center","mb-3","mb-md-0","me-md-auto","link-body-emphasis","text-decoration-none"],["src","../../assets/Logo.png","alt","Dev Motors Logo","width","90","height","40","onerror","this.onerror=null;this.src='assets/Logo.png';",1,"rounded","pop"],[1,"nav","col-md-4","justify-content-end"],["href","/home",1,"nav-link","px-2","darker-txt"],[1,"nav-link","px-2","darker-txt"],[1,"bi","bi-geo-alt"],["routerLinkActive","active",1,"dropdown-item","open-sans-simple",3,"href","routerLink"],["routerLink","/login","routerLinkActive","active","aria-current","page",1,"nav-link","active","open-sans-simple"],["tappable","","routerLinkActive","active","aria-current","page",1,"nav-link","active","open-sans-simple",3,"click"],["color","danger"],["routerLink","/add-vehicle","routerLinkActive","active","aria-current","page",1,"nav-link","active","open-sans-simple"],["routerLink","/add-brand","routerLinkActive","active","aria-current","page",1,"nav-link","active","open-sans-simple"]],template:function(ce,we){1&ce&&(k.j41(0,"ion-content",0)(1,"ion-fab",1)(2,"a",2)(3,"span",3),k.EFF(4,"Call: +254-725-603808"),k.k0s(),k.j41(5,"ion-fab-button",4),k.nrm(6,"ion-icon",5),k.k0s()()(),k.j41(7,"div",6)(8,"div",7)(9,"ul",8)(10,"li",9)(11,"a",10),k.nrm(12,"img",11),k.k0s()(),k.j41(13,"li",12)(14,"a",13)(15,"ion-text",14),k.EFF(16,"HOME"),k.k0s()()(),k.j41(17,"li",12)(18,"a",15)(19,"ion-text",14),k.EFF(20,"SHOWROOM"),k.k0s()()(),k.j41(21,"li",12)(22,"a",16)(23,"ion-text",14),k.EFF(24,"DOWNLOADS"),k.k0s()()(),k.j41(25,"li",17)(26,"a",18)(27,"ion-text",14),k.EFF(28,"BRANDS"),k.k0s()(),k.j41(29,"ul",19),k.Z7z(30,so,3,5,"li",20,k.Vm6),k.j41(32,"li"),k.nrm(33,"hr",21),k.k0s(),k.j41(34,"li",20)(35,"a",22),k.EFF(36,"OTHERS"),k.k0s()()()(),k.DNE(37,Lr,4,0,"li",12)(38,ki,5,1,"li",12),k.k0s(),k.j41(39,"form",23)(40,"ion-fab",24)(41,"ion-fab-button",25),k.nrm(42,"ion-icon",26),k.k0s()()()(),k.j41(43,"nav",27)(44,"div",28)(45,"a",10),k.nrm(46,"img",29),k.k0s(),k.j41(47,"button",30)(48,"ion-button",31),k.nrm(49,"ion-icon",32),k.k0s()(),k.j41(50,"div",33)(51,"ul",34)(52,"li",35)(53,"a",13)(54,"ion-text",14),k.EFF(55,"HOME"),k.k0s()()(),k.j41(56,"li",35)(57,"a",15)(58,"ion-text",14),k.EFF(59,"SHOWROOM"),k.k0s()()(),k.j41(60,"li",35)(61,"a",16)(62,"ion-text",14),k.EFF(63,"DOWNLOADS"),k.k0s()()(),k.j41(64,"li",36)(65,"a",37)(66,"ion-text",14),k.EFF(67,"BRANDS"),k.k0s()(),k.j41(68,"ul",19),k.Z7z(69,Fr,3,5,"li",null,k.Vm6),k.j41(71,"li"),k.nrm(72,"hr",21),k.k0s(),k.j41(73,"li")(74,"a",22),k.EFF(75,"OTHERS"),k.k0s()()()(),k.DNE(76,Rn,4,0,"li",35)(77,Pn,5,1,"li",35),k.k0s(),k.j41(78,"form",23)(79,"ion-fab",38)(80,"ion-fab-button",39),k.nrm(81,"ion-icon",26),k.k0s()()()()()(),k.j41(82,"div",40),k.nrm(83,"router-outlet"),k.k0s(),k.j41(84,"div",41)(85,"footer",42)(86,"div",43)(87,"ul",44)(88,"li",45)(89,"a",46),k.nrm(90,"i",47),k.k0s()(),k.j41(91,"li",45)(92,"a",48),k.nrm(93,"i",49),k.k0s()()()(),k.j41(94,"p",50),k.EFF(95,"\xa9 2024 Dev Motors"),k.k0s(),k.j41(96,"a",51),k.nrm(97,"img",52),k.k0s(),k.j41(98,"ul",53)(99,"li",35)(100,"a",54),k.EFF(101,"Home"),k.k0s()(),k.j41(102,"li",35)(103,"ion-text",55),k.nrm(104,"i",56),k.EFF(105," Nairobi, Ke"),k.k0s()()()()()()()),2&ce&&(k.R7$(30),k.Dyx(we.brands),k.R7$(7),k.vxM(0==we.loggedin?37:38),k.R7$(32),k.Dyx(we.brands),k.R7$(7),k.vxM(0==we.loggedin?76:77))},dependencies:[K.qT,K.cb,K.cV,oe.Jm,oe.W9,oe.Q8,oe.YW,oe.iq,oe.IO,oe.N7,oe.oY,$e.n3,$e.Wk,$e.wQ],styles:[".padder[_ngcontent-%COMP%]{padding-left:20vw;padding-right:2vw}.navbar-bg[_ngcontent-%COMP%]{background-color:var(--ion-color-light)}.nav-link[_ngcontent-%COMP%]{color:var(--ion-color-dark)}.navbar-nav[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%], .navbar-nav[_ngcontent-%COMP%]   .nav-link.show[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.tooltip-text[_ngcontent-%COMP%]{visibility:hidden;position:absolute;z-index:1;width:160px;color:#fff;font-size:12px;background-color:#192733;border-radius:10px;padding:10px 15px}.hover-text[_ngcontent-%COMP%]:hover   .tooltip-text[_ngcontent-%COMP%]{visibility:visible}#left[_ngcontent-%COMP%]{top:-8px;right:120%}#right[_ngcontent-%COMP%]{top:-8px;left:120%}.pop[_ngcontent-%COMP%]:hover{transform:scale(1.02)}"]}),se})(),children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",loadChildren:()=>X.e(8647).then(X.bind(X,8647)).then(Q=>Q.HomePagePageModule)},{path:"brand/:name",loadChildren:()=>X.e(4016).then(X.bind(X,4016)).then(Q=>Q.BrandPageModule)},{path:"show-room",loadChildren:()=>X.e(4691).then(X.bind(X,4691)).then(Q=>Q.ShopPageModule)},{path:"single-car/:id",loadChildren:()=>Promise.all([X.e(2076),X.e(9340)]).then(X.bind(X,9340)).then(Q=>Q.SingleCarPageModule)},{path:"login",loadChildren:()=>X.e(4067).then(X.bind(X,4067)).then(Q=>Q.LoginPageModule)},{path:"add-vehicle",loadChildren:()=>Promise.all([X.e(2076),X.e(9987)]).then(X.bind(X,9987)).then(Q=>Q.AddCarPageModule)},{path:"add-brand",loadChildren:()=>Promise.all([X.e(2076),X.e(1695)]).then(X.bind(X,1695)).then(Q=>Q.AddBrandPageModule)},{path:"add-vehicle/:id",loadChildren:()=>Promise.all([X.e(2076),X.e(9987)]).then(X.bind(X,9987)).then(Q=>Q.AddCarPageModule)},{path:"search",loadChildren:()=>X.e(3677).then(X.bind(X,3677)).then(Q=>Q.SearchPageModule)},{path:"downloads",loadChildren:()=>X.e(6612).then(X.bind(X,6612)).then(Q=>Q.DownloadsPageModule)}]}];let Ni=(()=>{var Q;class se{}return(Q=se).\u0275fac=function(ce){return new(ce||Q)},Q.\u0275mod=k.$C({type:Q}),Q.\u0275inj=k.G2t({imports:[$e.iI.forChild(Sn),$e.iI]}),se})(),bn=(()=>{var Q;class se{}return(Q=se).\u0275fac=function(ce){return new(ce||Q)},Q.\u0275mod=k.$C({type:Q}),Q.\u0275inj=k.G2t({imports:[E.MD,K.YN,oe.bv,Ni]}),se})()},7231:(al,er,X)=>{X.d(er,{IX:()=>E.V,HF:()=>E.X,xI:()=>E.o,CI:()=>E.C});var E=X(4033);X(8742),X(1076),X(8041),X(1362)},3273:(al,er,X)=>{X.d(er,{gS:()=>pg,rJ:()=>Qm,kd:()=>fg,H9:()=>wf,x7:()=>lg,GG:()=>hg,aU:()=>Xm,P:()=>sg,O5:()=>Pg,BN:()=>dg,_M:()=>og});var k,so,E=X(467),oe=X(8742),K=X(1362),$e=X(8041),Ae=X(1076),wn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Mr={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(C,A,S){S||(S=0);var x=Array(16);if("string"==typeof A)for(var V=0;16>V;++V)x[V]=A.charCodeAt(S++)|A.charCodeAt(S++)<<8|A.charCodeAt(S++)<<16|A.charCodeAt(S++)<<24;else for(V=0;16>V;++V)x[V]=A[S++]|A[S++]<<8|A[S++]<<16|A[S++]<<24;var L=C.g[3],R=(A=C.g[0])+(L^(S=C.g[1])&((V=C.g[2])^L))+x[0]+3614090360&4294967295;R=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=(S=(V=(L=(A=S+(R<<7&4294967295|R>>>25))+((R=L+(V^A&(S^V))+x[1]+3905402710&4294967295)<<12&4294967295|R>>>20))+((R=V+(S^L&(A^S))+x[2]+606105819&4294967295)<<17&4294967295|R>>>15))+((R=S+(A^V&(L^A))+x[3]+3250441966&4294967295)<<22&4294967295|R>>>10))+((R=A+(L^S&(V^L))+x[4]+4118548399&4294967295)<<7&4294967295|R>>>25))+((R=L+(V^A&(S^V))+x[5]+1200080426&4294967295)<<12&4294967295|R>>>20))+((R=V+(S^L&(A^S))+x[6]+2821735955&4294967295)<<17&4294967295|R>>>15))+((R=S+(A^V&(L^A))+x[7]+4249261313&4294967295)<<22&4294967295|R>>>10))+((R=A+(L^S&(V^L))+x[8]+1770035416&4294967295)<<7&4294967295|R>>>25))+((R=L+(V^A&(S^V))+x[9]+2336552879&4294967295)<<12&4294967295|R>>>20))+((R=V+(S^L&(A^S))+x[10]+4294925233&4294967295)<<17&4294967295|R>>>15))+((R=S+(A^V&(L^A))+x[11]+2304563134&4294967295)<<22&4294967295|R>>>10))+((R=A+(L^S&(V^L))+x[12]+1804603682&4294967295)<<7&4294967295|R>>>25))+((R=L+(V^A&(S^V))+x[13]+4254626195&4294967295)<<12&4294967295|R>>>20))+((R=V+(S^L&(A^S))+x[14]+2792965006&4294967295)<<17&4294967295|R>>>15))+((R=S+(A^V&(L^A))+x[15]+1236535329&4294967295)<<22&4294967295|R>>>10))+((R=A+(V^L&(S^V))+x[1]+4129170786&4294967295)<<5&4294967295|R>>>27))+((R=L+(S^V&(A^S))+x[6]+3225465664&4294967295)<<9&4294967295|R>>>23))+((R=V+(A^S&(L^A))+x[11]+643717713&4294967295)<<14&4294967295|R>>>18))+((R=S+(L^A&(V^L))+x[0]+3921069994&4294967295)<<20&4294967295|R>>>12))+((R=A+(V^L&(S^V))+x[5]+3593408605&4294967295)<<5&4294967295|R>>>27))+((R=L+(S^V&(A^S))+x[10]+38016083&4294967295)<<9&4294967295|R>>>23))+((R=V+(A^S&(L^A))+x[15]+3634488961&4294967295)<<14&4294967295|R>>>18))+((R=S+(L^A&(V^L))+x[4]+3889429448&4294967295)<<20&4294967295|R>>>12))+((R=A+(V^L&(S^V))+x[9]+568446438&4294967295)<<5&4294967295|R>>>27))+((R=L+(S^V&(A^S))+x[14]+3275163606&4294967295)<<9&4294967295|R>>>23))+((R=V+(A^S&(L^A))+x[3]+4107603335&4294967295)<<14&4294967295|R>>>18))+((R=S+(L^A&(V^L))+x[8]+1163531501&4294967295)<<20&4294967295|R>>>12))+((R=A+(V^L&(S^V))+x[13]+2850285829&4294967295)<<5&4294967295|R>>>27))+((R=L+(S^V&(A^S))+x[2]+4243563512&4294967295)<<9&4294967295|R>>>23))+((R=V+(A^S&(L^A))+x[7]+1735328473&4294967295)<<14&4294967295|R>>>18))+((R=S+(L^A&(V^L))+x[12]+2368359562&4294967295)<<20&4294967295|R>>>12))+((R=A+(S^V^L)+x[5]+4294588738&4294967295)<<4&4294967295|R>>>28))+((R=L+(A^S^V)+x[8]+2272392833&4294967295)<<11&4294967295|R>>>21))+((R=V+(L^A^S)+x[11]+1839030562&4294967295)<<16&4294967295|R>>>16))+((R=S+(V^L^A)+x[14]+4259657740&4294967295)<<23&4294967295|R>>>9))+((R=A+(S^V^L)+x[1]+2763975236&4294967295)<<4&4294967295|R>>>28))+((R=L+(A^S^V)+x[4]+1272893353&4294967295)<<11&4294967295|R>>>21))+((R=V+(L^A^S)+x[7]+4139469664&4294967295)<<16&4294967295|R>>>16))+((R=S+(V^L^A)+x[10]+3200236656&4294967295)<<23&4294967295|R>>>9))+((R=A+(S^V^L)+x[13]+681279174&4294967295)<<4&4294967295|R>>>28))+((R=L+(A^S^V)+x[0]+3936430074&4294967295)<<11&4294967295|R>>>21))+((R=V+(L^A^S)+x[3]+3572445317&4294967295)<<16&4294967295|R>>>16))+((R=S+(V^L^A)+x[6]+76029189&4294967295)<<23&4294967295|R>>>9))+((R=A+(S^V^L)+x[9]+3654602809&4294967295)<<4&4294967295|R>>>28))+((R=L+(A^S^V)+x[12]+3873151461&4294967295)<<11&4294967295|R>>>21))+((R=V+(L^A^S)+x[15]+530742520&4294967295)<<16&4294967295|R>>>16))+((R=S+(V^L^A)+x[2]+3299628645&4294967295)<<23&4294967295|R>>>9))+((R=A+(V^(S|~L))+x[0]+4096336452&4294967295)<<6&4294967295|R>>>26))+((R=L+(S^(A|~V))+x[7]+1126891415&4294967295)<<10&4294967295|R>>>22))+((R=V+(A^(L|~S))+x[14]+2878612391&4294967295)<<15&4294967295|R>>>17))+((R=S+(L^(V|~A))+x[5]+4237533241&4294967295)<<21&4294967295|R>>>11))+((R=A+(V^(S|~L))+x[12]+1700485571&4294967295)<<6&4294967295|R>>>26))+((R=L+(S^(A|~V))+x[3]+2399980690&4294967295)<<10&4294967295|R>>>22))+((R=V+(A^(L|~S))+x[10]+4293915773&4294967295)<<15&4294967295|R>>>17))+((R=S+(L^(V|~A))+x[1]+2240044497&4294967295)<<21&4294967295|R>>>11))+((R=A+(V^(S|~L))+x[8]+1873313359&4294967295)<<6&4294967295|R>>>26))+((R=L+(S^(A|~V))+x[15]+4264355552&4294967295)<<10&4294967295|R>>>22))+((R=V+(A^(L|~S))+x[6]+2734768916&4294967295)<<15&4294967295|R>>>17))+((R=S+(L^(V|~A))+x[13]+1309151649&4294967295)<<21&4294967295|R>>>11))+((L=(A=S+((R=A+(V^(S|~L))+x[4]+4149444226&4294967295)<<6&4294967295|R>>>26))+((R=L+(S^(A|~V))+x[11]+3174756917&4294967295)<<10&4294967295|R>>>22))^((V=L+((R=V+(A^(L|~S))+x[2]+718787259&4294967295)<<15&4294967295|R>>>17))|~A))+x[9]+3951481745&4294967295,C.g[0]=C.g[0]+A&4294967295,C.g[1]=C.g[1]+(V+(R<<21&4294967295|R>>>11))&4294967295,C.g[2]=C.g[2]+V&4294967295,C.g[3]=C.g[3]+L&4294967295}function c(C,A){this.h=A;for(var S=[],x=!0,V=C.length-1;0<=V;V--){var L=0|C[V];x&&L==A||(S[V]=L,x=!1)}this.g=S}(function e(C,A){function S(){}S.prototype=A.prototype,C.D=A.prototype,C.prototype=new S,C.prototype.constructor=C,C.C=function(x,V,L){for(var R=Array(arguments.length-2),Yn=2;Yn<arguments.length;Yn++)R[Yn-2]=arguments[Yn];return A.prototype[V].apply(x,R)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(C,A){void 0===A&&(A=C.length);for(var S=A-this.blockSize,x=this.B,V=this.h,L=0;L<A;){if(0==V)for(;L<=S;)i(this,C,L),L+=this.blockSize;if("string"==typeof C){for(;L<A;)if(x[V++]=C.charCodeAt(L++),V==this.blockSize){i(this,x),V=0;break}}else for(;L<A;)if(x[V++]=C[L++],V==this.blockSize){i(this,x),V=0;break}}this.h=V,this.o+=A},n.prototype.v=function(){var C=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);C[0]=128;for(var A=1;A<C.length-8;++A)C[A]=0;var S=8*this.o;for(A=C.length-8;A<C.length;++A)C[A]=255&S,S/=256;for(this.u(C),C=Array(16),A=S=0;4>A;++A)for(var x=0;32>x;x+=8)C[S++]=this.g[A]>>>x&255;return C};var d={};function f(C){return-128<=C&&128>C?function o(C,A){var S=d;return Object.prototype.hasOwnProperty.call(S,C)?S[C]:S[C]=A(C)}(C,function(A){return new c([0|A],0>A?-1:0)}):new c([0|C],0>C?-1:0)}function m(C){if(isNaN(C)||!isFinite(C))return T;if(0>C)return j(m(-C));for(var A=[],S=1,x=0;C>=S;x++)A[x]=C/S|0,S*=4294967296;return new c(A,0)}var T=f(0),w=f(1),O=f(16777216);function B(C){if(0!=C.h)return!1;for(var A=0;A<C.g.length;A++)if(0!=C.g[A])return!1;return!0}function z(C){return-1==C.h}function j(C){for(var A=C.g.length,S=[],x=0;x<A;x++)S[x]=~C.g[x];return new c(S,~C.h).add(w)}function ee(C,A){return C.add(j(A))}function ie(C,A){for(;(65535&C[A])!=C[A];)C[A+1]+=C[A]>>>16,C[A]&=65535,A++}function ne(C,A){this.g=C,this.h=A}function le(C,A){if(B(A))throw Error("division by zero");if(B(C))return new ne(T,T);if(z(C))return A=le(j(C),A),new ne(j(A.g),j(A.h));if(z(A))return A=le(C,j(A)),new ne(j(A.g),A.h);if(30<C.g.length){if(z(C)||z(A))throw Error("slowDivide_ only works with positive integers.");for(var S=w,x=A;0>=x.l(C);)S=ve(S),x=ve(x);var V=de(S,1),L=de(x,1);for(x=de(x,2),S=de(S,2);!B(x);){var R=L.add(x);0>=R.l(C)&&(V=V.add(S),L=R),x=de(x,1),S=de(S,1)}return A=ee(C,V.j(A)),new ne(V,A)}for(V=T;0<=C.l(A);){for(S=Math.max(1,Math.floor(C.m()/A.m())),x=48>=(x=Math.ceil(Math.log(S)/Math.LN2))?1:Math.pow(2,x-48),R=(L=m(S)).j(A);z(R)||0<R.l(C);)R=(L=m(S-=x)).j(A);B(L)&&(L=w),V=V.add(L),C=ee(C,R)}return new ne(V,C)}function ve(C){for(var A=C.g.length+1,S=[],x=0;x<A;x++)S[x]=C.i(x)<<1|C.i(x-1)>>>31;return new c(S,C.h)}function de(C,A){var S=A>>5;A%=32;for(var x=C.g.length-S,V=[],L=0;L<x;L++)V[L]=0<A?C.i(L+S)>>>A|C.i(L+S+1)<<32-A:C.i(L+S);return new c(V,C.h)}(r=c.prototype).m=function(){if(z(this))return-j(this).m();for(var C=0,A=1,S=0;S<this.g.length;S++){var x=this.i(S);C+=(0<=x?x:4294967296+x)*A,A*=4294967296}return C},r.toString=function(C){if(2>(C=C||10)||36<C)throw Error("radix out of range: "+C);if(B(this))return"0";if(z(this))return"-"+j(this).toString(C);for(var A=m(Math.pow(C,6)),S=this,x="";;){var V=le(S,A).g,L=((0<(S=ee(S,V.j(A))).g.length?S.g[0]:S.h)>>>0).toString(C);if(B(S=V))return L+x;for(;6>L.length;)L="0"+L;x=L+x}},r.i=function(C){return 0>C?0:C<this.g.length?this.g[C]:this.h},r.l=function(C){return z(C=ee(this,C))?-1:B(C)?0:1},r.abs=function(){return z(this)?j(this):this},r.add=function(C){for(var A=Math.max(this.g.length,C.g.length),S=[],x=0,V=0;V<=A;V++){var L=x+(65535&this.i(V))+(65535&C.i(V)),R=(L>>>16)+(this.i(V)>>>16)+(C.i(V)>>>16);x=R>>>16,S[V]=(R&=65535)<<16|(L&=65535)}return new c(S,-2147483648&S[S.length-1]?-1:0)},r.j=function(C){if(B(this)||B(C))return T;if(z(this))return z(C)?j(this).j(j(C)):j(j(this).j(C));if(z(C))return j(this.j(j(C)));if(0>this.l(O)&&0>C.l(O))return m(this.m()*C.m());for(var A=this.g.length+C.g.length,S=[],x=0;x<2*A;x++)S[x]=0;for(x=0;x<this.g.length;x++)for(var V=0;V<C.g.length;V++){var L=this.i(x)>>>16,R=65535&this.i(x),Yn=C.i(V)>>>16,ba=65535&C.i(V);S[2*x+2*V]+=R*ba,ie(S,2*x+2*V),S[2*x+2*V+1]+=L*ba,ie(S,2*x+2*V+1),S[2*x+2*V+1]+=R*Yn,ie(S,2*x+2*V+1),S[2*x+2*V+2]+=L*Yn,ie(S,2*x+2*V+2)}for(x=0;x<A;x++)S[x]=S[2*x+1]<<16|S[2*x];for(x=A;x<2*A;x++)S[x]=0;return new c(S,0)},r.A=function(C){return le(this,C).h},r.and=function(C){for(var A=Math.max(this.g.length,C.g.length),S=[],x=0;x<A;x++)S[x]=this.i(x)&C.i(x);return new c(S,this.h&C.h)},r.or=function(C){for(var A=Math.max(this.g.length,C.g.length),S=[],x=0;x<A;x++)S[x]=this.i(x)|C.i(x);return new c(S,this.h|C.h)},r.xor=function(C){for(var A=Math.max(this.g.length,C.g.length),S=[],x=0;x<A;x++)S[x]=this.i(x)^C.i(x);return new c(S,this.h^C.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,so=Mr.Md5=n,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.A,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=m,c.fromString=function y(C,A){if(0==C.length)throw Error("number format error: empty string");if(2>(A=A||10)||36<A)throw Error("radix out of range: "+A);if("-"==C.charAt(0))return j(y(C.substring(1),A));if(0<=C.indexOf("-"))throw Error('number format error: interior "-" character');for(var S=m(Math.pow(A,8)),x=T,V=0;V<C.length;V+=8){var L=Math.min(8,C.length-V),R=parseInt(C.substring(V,V+L),A);8>L?(L=m(Math.pow(A,L)),x=x.j(L).add(m(R))):x=(x=x.j(S)).add(m(R))}return x},k=Mr.Integer=c}).apply(typeof wn<"u"?wn:typeof self<"u"?self:typeof window<"u"?window:{});var ki,Fr,Rn,Di,Pn,oo,Sn,Ni,bn,Lr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},It={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(u,p,_){return u==Array.prototype||u==Object.prototype||(u[p]=_.value),u},n=function t(u){u=["object"==typeof globalThis&&globalThis,u,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Lr&&Lr];for(var p=0;p<u.length;++p){var _=u[p];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}(this);!function i(u,p){if(p)e:{var _=n;u=u.split(".");for(var v=0;v<u.length-1;v++){var D=u[v];if(!(D in _))break e;_=_[D]}(p=p(v=_[u=u[u.length-1]]))!=v&&null!=p&&e(_,u,{configurable:!0,writable:!0,value:p})}}("Array.prototype.values",function(u){return u||function(){return function o(u,p){u instanceof String&&(u+="");var _=0,v=!1,D={next:function(){if(!v&&_<u.length){var U=_++;return{value:p(U,u[U]),done:!1}}return v=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D}(this,function(p,_){return _})}});var c=c||{},d=this||self;function f(u){var p=typeof u;return"array"==(p="object"!=p?p:u?Array.isArray(u)?"array":p:"null")||"object"==p&&"number"==typeof u.length}function m(u){var p=typeof u;return"object"==p&&null!=u||"function"==p}function y(u,p,_){return u.call.apply(u.bind,arguments)}function T(u,p,_){if(!u)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var D=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(D,v),u.apply(p,D)}}return function(){return u.apply(p,arguments)}}function w(u,p,_){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:T).apply(null,arguments)}function O(u,p){var _=Array.prototype.slice.call(arguments,1);return function(){var v=_.slice();return v.push.apply(v,arguments),u.apply(this,v)}}function B(u,p){function _(){}_.prototype=p.prototype,u.aa=p.prototype,u.prototype=new _,u.prototype.constructor=u,u.Qb=function(v,D,U){for(var $=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)$[ke-2]=arguments[ke];return p.prototype[D].apply(v,$)}}function z(u){const p=u.length;if(0<p){const _=Array(p);for(let v=0;v<p;v++)_[v]=u[v];return _}return[]}function j(u,p){for(let _=1;_<arguments.length;_++){const v=arguments[_];if(f(v)){const D=u.length||0,U=v.length||0;u.length=D+U;for(let $=0;$<U;$++)u[D+$]=v[$]}else u.push(v)}}function ie(u){return/^[\s\xa0]*$/.test(u)}function ne(){var u=d.navigator;return u&&(u=u.userAgent)?u:""}function le(u){return le[" "](u),u}le[" "]=function(){};var ve=!(-1==ne().indexOf("Gecko")||-1!=ne().toLowerCase().indexOf("webkit")&&-1==ne().indexOf("Edge")||-1!=ne().indexOf("Trident")||-1!=ne().indexOf("MSIE")||-1!=ne().indexOf("Edge"));function de(u,p,_){for(const v in u)p.call(_,u[v],v,u)}function A(u){const p={};for(const _ in u)p[_]=u[_];return p}const S="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function x(u,p){let _,v;for(let D=1;D<arguments.length;D++){for(_ in v=arguments[D],v)u[_]=v[_];for(let U=0;U<S.length;U++)_=S[U],Object.prototype.hasOwnProperty.call(v,_)&&(u[_]=v[_])}}function V(u){var p=1;u=u.split(":");const _=[];for(;0<p&&u.length;)_.push(u.shift()),p--;return u.length&&_.push(u.join(":")),_}function L(u){d.setTimeout(()=>{throw u},0)}function R(){var u=Id;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}var ba=new class ee{constructor(p,_){this.i=p,this.j=_,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}(()=>new bg,u=>u.reset());class bg{constructor(){this.next=this.g=this.h=null}set(p,_){this.h=p,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let Ca,xa=!1,Id=new class Yn{constructor(){this.h=this.g=null}add(p,_){const v=ba.get();v.set(p,_),this.h?this.h.next=v:this.g=v,this.h=v}},Wf=()=>{const u=d.Promise.resolve(void 0);Ca=()=>{u.then(Cg)}};var Cg=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(_){L(_)}var p=ba;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}xa=!1};function kr(){this.s=this.s,this.C=this.C}function ct(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}kr.prototype.s=!1,kr.prototype.ma=function(){this.s||(this.s=!0,this.N())},kr.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},ct.prototype.h=function(){this.defaultPrevented=!0};var xg=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const _=()=>{};d.addEventListener("test",_,p),d.removeEventListener("test",_,p)}catch{}return u}();function Va(u,p){if(ct.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var _=this.type=u.type,v=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(ve){e:{try{le(p.nodeName);var D=!0;break e}catch{}D=!1}D||(p=null)}}else"mouseover"==_?p=u.fromElement:"mouseout"==_&&(p=u.toElement);this.relatedTarget=p,v?(this.clientX=void 0!==v.clientX?v.clientX:v.pageX,this.clientY=void 0!==v.clientY?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=void 0!==u.clientX?u.clientX:u.pageX,this.clientY=void 0!==u.clientY?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType="string"==typeof u.pointerType?u.pointerType:Vg[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Va.aa.h.call(this)}}B(Va,ct);var Vg={2:"touch",3:"pen",4:"mouse"};Va.prototype.h=function(){Va.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var ka="closure_listenable_"+(1e6*Math.random()|0),kg=0;function Dg(u,p,_,v,D){this.listener=u,this.proxy=null,this.src=p,this.type=_,this.capture=!!v,this.ha=D,this.key=++kg,this.da=this.fa=!1}function zc(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Kc(u){this.src=u,this.g={},this.h=0}function vd(u,p){var _=p.type;if(_ in u.g){var U,v=u.g[_],D=Array.prototype.indexOf.call(v,p,void 0);(U=0<=D)&&Array.prototype.splice.call(v,D,1),U&&(zc(p),0==u.g[_].length&&(delete u.g[_],u.h--))}}function Td(u,p,_,v){for(var D=0;D<u.length;++D){var U=u[D];if(!U.da&&U.listener==p&&U.capture==!!_&&U.ha==v)return D}return-1}Kc.prototype.add=function(u,p,_,v,D){var U=u.toString();(u=this.g[U])||(u=this.g[U]=[],this.h++);var $=Td(u,p,v,D);return-1<$?(p=u[$],_||(p.fa=!1)):((p=new Dg(p,this.src,U,!!v,D)).fa=_,u.push(p)),p};var Ed="closure_lm_"+(1e6*Math.random()|0),Ad={};function $f(u,p,_,v,D){if(v&&v.once)return Qf(u,p,_,v,D);if(Array.isArray(p)){for(var U=0;U<p.length;U++)$f(u,p[U],_,v,D);return null}return _=Sd(_),u&&u[ka]?u.K(p,_,m(v)?!!v.capture:!!v,D):Hf(u,p,_,!1,v,D)}function Hf(u,p,_,v,D,U){if(!p)throw Error("Invalid event type");var $=m(D)?!!D.capture:!!D,ke=Rd(u);if(ke||(u[Ed]=ke=new Kc(u)),(_=ke.add(p,_,v,$,U)).proxy)return _;if(v=function Ng(){const p=Og;return function u(_){return p.call(u.src,u.listener,_)}}(),_.proxy=v,v.src=u,v.listener=_,u.addEventListener)xg||(D=$),void 0===D&&(D=!1),u.addEventListener(p.toString(),v,D);else if(u.attachEvent)u.attachEvent(Yf(p.toString()),v);else{if(!u.addListener||!u.removeListener)throw Error("addEventListener and attachEvent are unavailable.");u.addListener(v)}return _}function Qf(u,p,_,v,D){if(Array.isArray(p)){for(var U=0;U<p.length;U++)Qf(u,p[U],_,v,D);return null}return _=Sd(_),u&&u[ka]?u.L(p,_,m(v)?!!v.capture:!!v,D):Hf(u,p,_,!0,v,D)}function Jf(u,p,_,v,D){if(Array.isArray(p))for(var U=0;U<p.length;U++)Jf(u,p[U],_,v,D);else v=m(v)?!!v.capture:!!v,_=Sd(_),u&&u[ka]?(u=u.i,(p=String(p).toString())in u.g&&-1<(_=Td(U=u.g[p],_,v,D))&&(zc(U[_]),Array.prototype.splice.call(U,_,1),0==U.length&&(delete u.g[p],u.h--))):u&&(u=Rd(u))&&(p=u.g[p.toString()],u=-1,p&&(u=Td(p,_,v,D)),(_=-1<u?p[u]:null)&&wd(_))}function wd(u){if("number"!=typeof u&&u&&!u.da){var p=u.src;if(p&&p[ka])vd(p.i,u);else{var _=u.type,v=u.proxy;p.removeEventListener?p.removeEventListener(_,v,u.capture):p.detachEvent?p.detachEvent(Yf(_),v):p.addListener&&p.removeListener&&p.removeListener(v),(_=Rd(p))?(vd(_,u),0==_.h&&(_.src=null,p[Ed]=null)):zc(u)}}}function Yf(u){return u in Ad?Ad[u]:Ad[u]="on"+u}function Og(u,p){if(u.da)u=!0;else{p=new Va(p,this);var _=u.listener,v=u.ha||u.src;u.fa&&wd(u),u=_.call(v,p)}return u}function Rd(u){return(u=u[Ed])instanceof Kc?u:null}var Pd="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sd(u){return"function"==typeof u?u:(u[Pd]||(u[Pd]=function(p){return u.handleEvent(p)}),u[Pd])}function lt(){kr.call(this),this.i=new Kc(this),this.M=this,this.F=null}function mt(u,p){var _,v=u.F;if(v)for(_=[];v;v=v.F)_.push(v);if(u=u.M,v=p.type||p,"string"==typeof p)p=new ct(p,u);else if(p instanceof ct)p.target=p.target||u;else{var D=p;x(p=new ct(v,u),D)}if(D=!0,_)for(var U=_.length-1;0<=U;U--){var $=p.g=_[U];D=Wc($,v,!0,p)&&D}if(D=Wc($=p.g=u,v,!0,p)&&D,D=Wc($,v,!1,p)&&D,_)for(U=0;U<_.length;U++)D=Wc($=p.g=_[U],v,!1,p)&&D}function Wc(u,p,_,v){if(!(p=u.i.g[String(p)]))return!0;p=p.concat();for(var D=!0,U=0;U<p.length;++U){var $=p[U];if($&&!$.da&&$.capture==_){var ke=$.listener,ot=$.ha||$.src;$.fa&&vd(u.i,$),D=!1!==ke.call(ot,v)&&D}}return D&&!v.defaultPrevented}function Xf(u,p,_){if("function"==typeof u)_&&(u=w(u,_));else{if(!u||"function"!=typeof u.handleEvent)throw Error("Invalid listener argument");u=w(u.handleEvent,u)}return 2147483647<Number(p)?-1:d.setTimeout(u,p||0)}function Zf(u){u.g=Xf(()=>{u.g=null,u.i&&(u.i=!1,Zf(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}B(lt,kr),lt.prototype[ka]=!0,lt.prototype.removeEventListener=function(u,p,_,v){Jf(this,u,p,_,v)},lt.prototype.N=function(){if(lt.aa.N.call(this),this.i){var p,u=this.i;for(p in u.g){for(var _=u.g[p],v=0;v<_.length;v++)zc(_[v]);delete u.g[p],u.h--}}this.F=null},lt.prototype.K=function(u,p,_,v){return this.i.add(String(u),p,!1,_,v)},lt.prototype.L=function(u,p,_,v){return this.i.add(String(u),p,!0,_,v)};class Mg extends kr{constructor(p,_){super(),this.m=p,this.l=_,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Zf(this)}N(){super.N(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Da(u){kr.call(this),this.h=u,this.g={}}B(Da,kr);var ep=[];function tp(u){de(u.g,function(p,_){this.g.hasOwnProperty(_)&&wd(p)},u),u.g={}}Da.prototype.N=function(){Da.aa.N.call(this),tp(this)},Da.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var bd=d.JSON.stringify,Lg=d.JSON.parse,Fg=class{stringify(u){return d.JSON.stringify(u,void 0)}parse(u){return d.JSON.parse(u,void 0)}};function Cd(){}function rp(){}Cd.prototype.h=null;var Na={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function xd(){ct.call(this,"d")}function Vd(){ct.call(this,"c")}B(xd,ct),B(Vd,ct);var bi={},ip=null;function $c(){return ip=ip||new lt}function sp(u){ct.call(this,bi.La,u)}function Oa(u){const p=$c();mt(p,new sp(p))}function op(u,p){ct.call(this,bi.STAT_EVENT,u),this.stat=p}function gt(u){const p=$c();mt(p,new op(p,u))}function ap(u,p){ct.call(this,bi.Ma,u),this.size=p}function Ma(u,p){if("function"!=typeof u)throw Error("Fn must not be null and must be a function");return d.setTimeout(function(){u()},p)}function La(){this.g=!0}function to(u,p,_,v){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+function Gg(u,p){if(!u.g)return p;if(!p)return null;try{var _=JSON.parse(p);if(_)for(u=0;u<_.length;u++)if(Array.isArray(_[u])){var v=_[u];if(!(2>v.length)){var D=v[1];if(Array.isArray(D)&&!(1>D.length)){var U=D[0];if("noop"!=U&&"stop"!=U&&"close"!=U)for(var $=1;$<D.length;$++)D[$]=""}}}return bd(_)}catch{return p}}(u,_)+(v?" "+v:"")})}bi.La="serverreachability",B(sp,ct),bi.STAT_EVENT="statevent",B(op,ct),bi.Ma="timingevent",B(ap,ct),La.prototype.xa=function(){this.g=!1},La.prototype.info=function(){};var kd,Hc={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},up={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Qc(){}function Dr(u,p,_,v){this.j=u,this.i=p,this.l=_,this.R=v||1,this.U=new Da(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new cp}function cp(){this.i=null,this.g="",this.h=!1}B(Qc,Cd),Qc.prototype.g=function(){return new XMLHttpRequest},Qc.prototype.i=function(){return{}},kd=new Qc;var lp={},Dd={};function Nd(u,p,_){u.L=1,u.v=Zc(Xn(p)),u.m=_,u.P=!0,hp(u,null)}function hp(u,p){u.F=Date.now(),Jc(u),u.A=Xn(u.v);var _=u.A,v=u.R;Array.isArray(v)||(v=[String(v)]),Rp(_.i,"t",v),u.C=0,_=u.j.J,u.h=new cp,u.g=jp(u.j,_?p:null,!u.m),0<u.O&&(u.M=new Mg(w(u.Y,u,u.g),u.O)),p=u.U,_=u.g,v=u.ca;var D="readystatechange";Array.isArray(D)||(D&&(ep[0]=D.toString()),D=ep);for(var U=0;U<D.length;U++){var $=$f(_,D[U],v||p.handleEvent,!1,p.h||p);if(!$)break;p.g[$.key]=$}p=u.H?A(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Oa(),function Ug(u,p,_,v,D,U){u.info(function(){if(u.g)if(U)for(var $="",ke=U.split("&"),ot=0;ot<ke.length;ot++){var Te=ke[ot].split("=");if(1<Te.length){var ht=Te[0];Te=Te[1];var dt=ht.split("_");$=2<=dt.length&&"type"==dt[1]?$+(ht+"=")+Te+"&":$+(ht+"=redacted&")}}else $=null;else $=U;return"XMLHTTP REQ ("+v+") [attempt "+D+"]: "+p+"\n"+_+"\n"+$})}(u.i,u.u,u.A,u.l,u.R,u.m)}function dp(u){return!!u.g&&"GET"==u.u&&2!=u.L&&u.j.Ca}function jg(u,p){var _=u.C,v=p.indexOf("\n",_);return-1==v?Dd:(_=Number(p.substring(_,v)),isNaN(_)?lp:(v+=1)+_>p.length?Dd:(p=p.slice(v,v+_),u.C=v+_,p))}function Jc(u){u.S=Date.now()+u.I,fp(u,u.I)}function fp(u,p){if(null!=u.B)throw Error("WatchDog timer not null");u.B=Ma(w(u.ba,u),p)}function Od(u){u.B&&(d.clearTimeout(u.B),u.B=null)}function Fa(u){0==u.j.G||u.J||Up(u.j,u)}function Ci(u){Od(u);var p=u.M;p&&"function"==typeof p.ma&&p.ma(),u.M=null,tp(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Md(u,p){try{var _=u.j;if(0!=_.G&&(_.g==u||Ld(_.h,u)))if(!u.K&&Ld(_.h,u)&&3==_.G){try{var v=_.Da.g.parse(p)}catch{v=null}if(Array.isArray(v)&&3==v.length){var D=v;if(0==D[0]){e:if(!_.u){if(_.g){if(!(_.g.F+3e3<u.F))break e;il(_),nl(_)}qd(_),gt(18)}}else _.za=D[1],0<_.za-_.T&&37500>D[2]&&_.F&&0==_.v&&!_.C&&(_.C=Ma(w(_.Za,_),6e3));if(1>=gp(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else Vi(_,11)}else if((u.K||_.g==u)&&il(_),!ie(p))for(D=_.Da.g.parse(p),p=0;p<D.length;p++){let Te=D[p];if(_.T=Te[0],Te=Te[1],2==_.G)if("c"==Te[0]){_.K=Te[1],_.ia=Te[2];const ht=Te[3];null!=ht&&(_.la=ht,_.j.info("VER="+_.la));const dt=Te[4];null!=dt&&(_.Aa=dt,_.j.info("SVER="+_.Aa));const io=Te[5];null!=io&&"number"==typeof io&&0<io&&(_.L=v=1.5*io,_.j.info("backChannelRequestTimeoutMs_="+v)),v=_;const Jt=u.g;if(Jt){const ol=Jt.g?Jt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ol){var U=v.h;U.g||-1==ol.indexOf("spdy")&&-1==ol.indexOf("quic")&&-1==ol.indexOf("h2")||(U.j=U.l,U.g=new Set,U.h&&(Fd(U,U.h),U.h=null))}if(v.D){const jd=Jt.g?Jt.g.getResponseHeader("X-HTTP-Session-Id"):null;jd&&(v.ya=jd,Me(v.I,v.D,jd))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-u.F,_.j.info("Handshake RTT: "+_.R+"ms"));var $=u;if((v=_).qa=Gp(v,v.J?v.ia:null,v.W),$.K){_p(v.h,$);var ke=$,ot=v.L;ot&&(ke.I=ot),ke.B&&(Od(ke),Jc(ke)),v.g=$}else Lp(v);0<_.i.length&&rl(_)}else"stop"!=Te[0]&&"close"!=Te[0]||Vi(_,7);else 3==_.G&&("stop"==Te[0]||"close"==Te[0]?"stop"==Te[0]?Vi(_,7):Bd(_):"noop"!=Te[0]&&_.l&&_.l.ta(Te),_.v=0)}Oa()}catch{}}Dr.prototype.ca=function(u){u=u.target;const p=this.M;p&&3==Zn(u)?p.j():this.Y(u)},Dr.prototype.Y=function(u){try{if(u==this.g)e:{const dt=Zn(this.g);var p=this.g.Ba();if(this.g.Z(),!(3>dt)&&(3!=dt||this.g&&(this.h.h||this.g.oa()||kp(this.g)))){this.J||4!=dt||7==p||Oa(),Od(this);var _=this.g.Z();this.X=_;t:if(dp(this)){var v=kp(this.g);u="";var D=v.length,U=4==Zn(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Ci(this),Fa(this);var $="";break t}this.h.i=new d.TextDecoder}for(p=0;p<D;p++)this.h.h=!0,u+=this.h.i.decode(v[p],{stream:!(U&&p==D-1)});v.length=0,this.h.g+=u,this.C=0,$=this.h.g}else $=this.g.oa();if(this.o=200==_,function Bg(u,p,_,v,D,U,$){u.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+D+"]: "+p+"\n"+_+"\n"+U+" "+$})}(this.i,this.u,this.A,this.l,this.R,dt,_),this.o){if(this.T&&!this.K){t:{if(this.g){var ke,ot=this.g;if((ke=ot.g?ot.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ie(ke)){var Te=ke;break t}}Te=null}if(!(_=Te)){this.o=!1,this.s=3,gt(12),Ci(this),Fa(this);break e}to(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Md(this,_)}if(this.P){let Jt;for(_=!0;!this.J&&this.C<$.length;){if(Jt=jg(this,$),Jt==Dd){4==dt&&(this.s=4,gt(14),_=!1),to(this.i,this.l,null,"[Incomplete Response]");break}if(Jt==lp){this.s=4,gt(15),to(this.i,this.l,$,"[Invalid Chunk]"),_=!1;break}to(this.i,this.l,Jt,null),Md(this,Jt)}if(dp(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=dt||0!=$.length||this.h.h||(this.s=1,gt(16),_=!1),this.o=this.o&&_,_){if(0<$.length&&!this.W){this.W=!0;var ht=this.j;ht.g==this&&ht.ba&&!ht.M&&(ht.j.info("Great, no buffering proxy detected. Bytes received: "+$.length),Gd(ht),ht.M=!0,gt(11))}}else to(this.i,this.l,$,"[Invalid Chunked Response]"),Ci(this),Fa(this)}else to(this.i,this.l,$,null),Md(this,$);4==dt&&Ci(this),this.o&&!this.J&&(4==dt?Up(this.j,this):(this.o=!1,Jc(this)))}else(function o_(u){const p={};u=(u.g&&2<=Zn(u)&&u.g.getAllResponseHeaders()||"").split("\r\n");for(let v=0;v<u.length;v++){if(ie(u[v]))continue;var _=V(u[v]);const D=_[0];if("string"!=typeof(_=_[1]))continue;_=_.trim();const U=p[D]||[];p[D]=U,U.push(_)}!function C(u,p){for(const _ in u)p.call(void 0,u[_],_,u)}(p,function(v){return v.join(", ")})})(this.g),400==_&&0<$.indexOf("Unknown SID")?(this.s=3,gt(12)):(this.s=0,gt(13)),Ci(this),Fa(this)}}}catch{}},Dr.prototype.cancel=function(){this.J=!0,Ci(this)},Dr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(function qg(u,p){u.info(function(){return"TIMEOUT: "+p})}(this.i,this.A),2!=this.L&&(Oa(),gt(17)),Ci(this),this.s=2,Fa(this)):fp(this,this.S-u)};var zg=class{constructor(u,p){this.g=u,this.map=p}};function pp(u){this.l=u||10,u=d.PerformanceNavigationTiming?0<(u=d.performance.getEntriesByType("navigation")).length&&("hq"==u[0].nextHopProtocol||"h2"==u[0].nextHopProtocol):!!(d.chrome&&d.chrome.loadTimes&&d.chrome.loadTimes()&&d.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function mp(u){return!!u.h||!!u.g&&u.g.size>=u.j}function gp(u){return u.h?1:u.g?u.g.size:0}function Ld(u,p){return u.h?u.h==p:!!u.g&&u.g.has(p)}function Fd(u,p){u.g?u.g.add(p):u.h=p}function _p(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}function yp(u){if(null!=u.h)return u.i.concat(u.h.D);if(null!=u.g&&0!==u.g.size){let p=u.i;for(const _ of u.g.values())p=p.concat(_.D);return p}return z(u.i)}function Ip(u,p){if(u.forEach&&"function"==typeof u.forEach)u.forEach(p,void 0);else if(f(u)||"string"==typeof u)Array.prototype.forEach.call(u,p,void 0);else for(var _=function Wg(u){if(u.na&&"function"==typeof u.na)return u.na();if(!u.V||"function"!=typeof u.V){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(f(u)||"string"==typeof u){var p=[];u=u.length;for(var _=0;_<u;_++)p.push(_);return p}p=[],_=0;for(const v in u)p[_++]=v;return p}}}(u),v=function Kg(u){if(u.V&&"function"==typeof u.V)return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if("string"==typeof u)return u.split("");if(f(u)){for(var p=[],_=u.length,v=0;v<_;v++)p.push(u[v]);return p}for(v in p=[],_=0,u)p[_++]=u[v];return p}(u),D=v.length,U=0;U<D;U++)p.call(void 0,v[U],_&&_[U],u)}pp.prototype.cancel=function(){if(this.i=yp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const u of this.g.values())u.cancel();this.g.clear()}};var vp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xi(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof xi){this.h=u.h,Yc(this,u.j),this.o=u.o,this.g=u.g,Xc(this,u.s),this.l=u.l;var p=u.i,_=new qa;_.i=p.i,p.g&&(_.g=new Map(p.g),_.h=p.h),Tp(this,_),this.m=u.m}else u&&(p=String(u).match(vp))?(this.h=!1,Yc(this,p[1]||"",!0),this.o=Ua(p[2]||""),this.g=Ua(p[3]||"",!0),Xc(this,p[4]),this.l=Ua(p[5]||"",!0),Tp(this,p[6]||"",!0),this.m=Ua(p[7]||"")):(this.h=!1,this.i=new qa(null,this.h))}function Xn(u){return new xi(u)}function Yc(u,p,_){u.j=_?Ua(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function Xc(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Tp(u,p,_){p instanceof qa?(u.i=p,function Zg(u,p){p&&!u.j&&(Nr(u),u.i=null,u.g.forEach(function(_,v){var D=v.toLowerCase();v!=D&&(Ap(this,v),Rp(this,D,_))},u)),u.j=p}(u.i,u.h)):(_||(p=Ba(p,Yg)),u.i=new qa(p,u.h))}function Me(u,p,_){u.i.set(p,_)}function Zc(u){return Me(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Ua(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Ba(u,p,_){return"string"==typeof u?(u=encodeURI(u).replace(p,Hg),_&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Hg(u){return"%"+((u=u.charCodeAt(0))>>4&15).toString(16)+(15&u).toString(16)}xi.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Ba(p,Ep,!0),":");var _=this.g;return(_||"file"==p)&&(u.push("//"),(p=this.o)&&u.push(Ba(p,Ep,!0),"@"),u.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(_=this.s)&&u.push(":",String(_))),(_=this.l)&&(this.g&&"/"!=_.charAt(0)&&u.push("/"),u.push(Ba(_,"/"==_.charAt(0)?Jg:Qg,!0))),(_=this.i.toString())&&u.push("?",_),(_=this.m)&&u.push("#",Ba(_,Xg)),u.join("")};var Ep=/[#\/\?@]/g,Qg=/[#\?:]/g,Jg=/[#\?]/g,Yg=/[#\?@]/g,Xg=/#/g;function qa(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Nr(u){u.g||(u.g=new Map,u.h=0,u.i&&function $g(u,p){if(u){u=u.split("&");for(var _=0;_<u.length;_++){var v=u[_].indexOf("="),D=null;if(0<=v){var U=u[_].substring(0,v);D=u[_].substring(v+1)}else U=u[_];p(U,D?decodeURIComponent(D.replace(/\+/g," ")):"")}}}(u.i,function(p,_){u.add(decodeURIComponent(p.replace(/\+/g," ")),_)}))}function Ap(u,p){Nr(u),p=no(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function wp(u,p){return Nr(u),p=no(u,p),u.g.has(p)}function Rp(u,p,_){Ap(u,p),0<_.length&&(u.i=null,u.g.set(no(u,p),z(_)),u.h+=_.length)}function no(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Or(u,p,_,v,D){try{D&&(D.onload=null,D.onerror=null,D.onabort=null,D.ontimeout=null),v(_)}catch{}}function n_(){this.g=new Fg}function r_(u,p,_){const v=_||"";try{Ip(u,function(D,U){let $=D;m(D)&&($=bd(D)),p.push(v+U+"="+encodeURIComponent($))})}catch(D){throw p.push(v+"type="+encodeURIComponent("_badmap")),D}}function Ga(u){this.l=u.Ub||null,this.j=u.eb||!1}function el(u,p){lt.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Pp(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}function ja(u){u.readyState=4,u.l=null,u.j=null,u.v=null,za(u)}function za(u){u.onreadystatechange&&u.onreadystatechange.call(u)}function Sp(u){let p="";return de(u,function(_,v){p+=v,p+=":",p+=_,p+="\r\n"}),p}function Ud(u,p,_){e:{for(v in _){var v=!1;break e}v=!0}v||(_=Sp(_),"string"==typeof u?null!=_&&encodeURIComponent(String(_)):Me(u,p,_))}function We(u){lt.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=qa.prototype).add=function(u,p){Nr(this),this.i=null,u=no(this,u);var _=this.g.get(u);return _||this.g.set(u,_=[]),_.push(p),this.h+=1,this},r.forEach=function(u,p){Nr(this),this.g.forEach(function(_,v){_.forEach(function(D){u.call(p,D,v,this)},this)},this)},r.na=function(){Nr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),_=[];for(let v=0;v<p.length;v++){const D=u[v];for(let U=0;U<D.length;U++)_.push(p[v])}return _},r.V=function(u){Nr(this);let p=[];if("string"==typeof u)wp(this,u)&&(p=p.concat(this.g.get(no(this,u))));else{u=Array.from(this.g.values());for(let _=0;_<u.length;_++)p=p.concat(u[_])}return p},r.set=function(u,p){return Nr(this),this.i=null,wp(this,u=no(this,u))&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},r.get=function(u,p){return u&&0<(u=this.V(u)).length?String(u[0]):p},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var _=0;_<p.length;_++){var v=p[_];const U=encodeURIComponent(String(v)),$=this.V(v);for(v=0;v<$.length;v++){var D=U;""!==$[v]&&(D+="="+encodeURIComponent(String($[v]))),u.push(D)}}return this.i=u.join("&")},B(Ga,Cd),Ga.prototype.g=function(){return new el(this.l,this.j)},Ga.prototype.i=function(u){return function(){return u}}({}),B(el,lt),(r=el.prototype).open=function(u,p){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,za(this)},r.send=function(u){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||d).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ja(this)),this.readyState=0},r.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,za(this)),this.g&&(this.readyState=3,za(this),this.g)))if("arraybuffer"===this.responseType)u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof d.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Pp(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?ja(this):za(this),3==this.readyState&&Pp(this)}},r.Ra=function(u){this.g&&(this.response=this.responseText=u,ja(this))},r.Qa=function(u){this.g&&(this.response=u,ja(this))},r.ga=function(){this.g&&ja(this)},r.setRequestHeader=function(u,p){this.u.append(u,p)},r.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var _=p.next();!_.done;)u.push((_=_.value)[0]+": "+_[1]),_=p.next();return u.join("\r\n")},Object.defineProperty(el.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(u){this.m=u?"include":"same-origin"}}),B(We,lt);var i_=/^https?$/i,s_=["POST","PUT"];function bp(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,Cp(u),tl(u)}function Cp(u){u.A||(u.A=!0,mt(u,"complete"),mt(u,"error"))}function xp(u){if(u.h&&typeof c<"u"&&(!u.v[1]||4!=Zn(u)||2!=u.Z()))if(u.u&&4==Zn(u))Xf(u.Ea,0,u);else if(mt(u,"readystatechange"),4==Zn(u)){u.h=!1;try{const $=u.Z();e:switch($){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var _;if(!(_=p)){var v;if(v=0===$){var D=String(u.D).match(vp)[1]||null;!D&&d.self&&d.self.location&&(D=d.self.location.protocol.slice(0,-1)),v=!i_.test(D?D.toLowerCase():"")}_=v}if(_)mt(u,"complete"),mt(u,"success");else{u.m=6;try{var U=2<Zn(u)?u.g.statusText:""}catch{U=""}u.l=U+" ["+u.Z()+"]",Cp(u)}}finally{tl(u)}}}function tl(u,p){if(u.g){Vp(u);const _=u.g,v=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||mt(u,"ready");try{_.onreadystatechange=v}catch{}}}function Vp(u){u.I&&(d.clearTimeout(u.I),u.I=null)}function Zn(u){return u.g?u.g.readyState:0}function kp(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Ka(u,p,_){return _&&_.internalChannelParams&&_.internalChannelParams[u]||p}function Dp(u){this.Aa=0,this.i=[],this.j=new La,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ka("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ka("baseRetryDelayMs",5e3,u),this.cb=Ka("retryDelaySeedMs",1e4,u),this.Wa=Ka("forwardChannelMaxRetries",2,u),this.wa=Ka("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new pp(u&&u.concurrentRequestLimit),this.Da=new n_,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Bd(u){if(Np(u),3==u.G){var p=u.U++,_=Xn(u.I);if(Me(_,"SID",u.K),Me(_,"RID",p),Me(_,"TYPE","terminate"),Wa(u,_),(p=new Dr(u,u.j,p)).L=2,p.v=Zc(Xn(_)),_=!1,d.navigator&&d.navigator.sendBeacon)try{_=d.navigator.sendBeacon(p.v.toString(),"")}catch{}!_&&d.Image&&((new Image).src=p.v,_=!0),_||(p.g=jp(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Jc(p)}qp(u)}function nl(u){u.g&&(Gd(u),u.g.cancel(),u.g=null)}function Np(u){nl(u),u.u&&(d.clearTimeout(u.u),u.u=null),il(u),u.h.cancel(),u.s&&("number"==typeof u.s&&d.clearTimeout(u.s),u.s=null)}function rl(u){if(!mp(u.h)&&!u.s){u.s=!0;var p=u.Ga;Ca||Wf(),xa||(Ca(),xa=!0),Id.add(p,u),u.B=0}}function Op(u,p){var _;_=p?p.l:u.U++;const v=Xn(u.I);Me(v,"SID",u.K),Me(v,"RID",_),Me(v,"AID",u.T),Wa(u,v),u.m&&u.o&&Ud(v,u.m,u.o),_=new Dr(u,u.j,_,u.B+1),null===u.m&&(_.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Mp(u,_,1e3),_.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Fd(u.h,_),Nd(_,v,p)}function Wa(u,p){u.H&&de(u.H,function(_,v){Me(p,v,_)}),u.l&&Ip({},function(_,v){Me(p,v,_)})}function Mp(u,p,_){_=Math.min(u.i.length,_);var v=u.l?w(u.l.Na,u.l,u):null;e:{var D=u.i;let U=-1;for(;;){const $=["count="+_];-1==U?0<_?(U=D[0].g,$.push("ofs="+U)):U=0:$.push("ofs="+U);let ke=!0;for(let ot=0;ot<_;ot++){let Te=D[ot].g;const ht=D[ot].map;if(Te-=U,0>Te)U=Math.max(0,D[ot].g-100),ke=!1;else try{r_(ht,$,"req"+Te+"_")}catch{v&&v(ht)}}if(ke){v=$.join("&");break e}}}return u=u.i.splice(0,_),p.D=u,v}function Lp(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;Ca||Wf(),xa||(Ca(),xa=!0),Id.add(p,u),u.v=0}}function qd(u){return!(u.g||u.u||3<=u.v||(u.Y++,u.u=Ma(w(u.Fa,u),Bp(u,u.v)),u.v++,0))}function Gd(u){null!=u.A&&(d.clearTimeout(u.A),u.A=null)}function Fp(u){u.g=new Dr(u,u.j,"rpc",u.Y),null===u.m&&(u.g.H=u.o),u.g.O=0;var p=Xn(u.qa);Me(p,"RID","rpc"),Me(p,"SID",u.K),Me(p,"AID",u.T),Me(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Me(p,"TO",u.ja),Me(p,"TYPE","xmlhttp"),Wa(u,p),u.m&&u.o&&Ud(p,u.m,u.o),u.L&&(u.g.I=u.L);var _=u.g;u=u.ia,_.L=1,_.v=Zc(Xn(p)),_.m=null,_.P=!0,hp(_,u)}function il(u){null!=u.C&&(d.clearTimeout(u.C),u.C=null)}function Up(u,p){var _=null;if(u.g==p){il(u),Gd(u),u.g=null;var v=2}else{if(!Ld(u.h,p))return;_=p.D,_p(u.h,p),v=1}if(0!=u.G)if(p.o)if(1==v){_=p.m?p.m.length:0,p=Date.now()-p.F;var D=u.B;mt(v=$c(),new ap(v,_)),rl(u)}else Lp(u);else if(3==(D=p.s)||0==D&&0<p.X||!(1==v&&function a_(u,p){return!(gp(u.h)>=u.h.j-(u.s?1:0)||(u.s?(u.i=p.D.concat(u.i),0):1==u.G||2==u.G||u.B>=(u.Va?0:u.Wa)||(u.s=Ma(w(u.Ga,u,p),Bp(u,u.B)),u.B++,0)))}(u,p)||2==v&&qd(u)))switch(_&&0<_.length&&(p=u.h,p.i=p.i.concat(_)),D){case 1:Vi(u,5);break;case 4:Vi(u,10);break;case 3:Vi(u,6);break;default:Vi(u,2)}}function Bp(u,p){let _=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(_*=2),_*p}function Vi(u,p){if(u.j.info("Error code "+p),2==p){var _=w(u.fb,u),v=u.Xa;const D=!v;v=new xi(v||"//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||Yc(v,"https"),Zc(v),D?function e_(u,p){const _=new La;if(d.Image){const v=new Image;v.onload=O(Or,_,"TestLoadImage: loaded",!0,p,v),v.onerror=O(Or,_,"TestLoadImage: error",!1,p,v),v.onabort=O(Or,_,"TestLoadImage: abort",!1,p,v),v.ontimeout=O(Or,_,"TestLoadImage: timeout",!1,p,v),d.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=u}else p(!1)}(v.toString(),_):function t_(u,p){new La;const v=new AbortController,D=setTimeout(()=>{v.abort(),Or(0,0,!1,p)},1e4);fetch(u,{signal:v.signal}).then(U=>{clearTimeout(D),Or(0,0,!!U.ok,p)}).catch(()=>{clearTimeout(D),Or(0,0,!1,p)})}(v.toString(),_)}else gt(2);u.G=0,u.l&&u.l.sa(p),qp(u),Np(u)}function qp(u){if(u.G=0,u.ka=[],u.l){const p=yp(u.h);(0!=p.length||0!=u.i.length)&&(j(u.ka,p),j(u.ka,u.i),u.h.i.length=0,z(u.i),u.i.length=0),u.l.ra()}}function Gp(u,p,_){var v=_ instanceof xi?Xn(_):new xi(_);if(""!=v.g)p&&(v.g=p+"."+v.g),Xc(v,v.s);else{var D=d.location;v=D.protocol,p=p?p+"."+D.hostname:D.hostname,D=+D.port;var U=new xi(null);v&&Yc(U,v),p&&(U.g=p),D&&Xc(U,D),_&&(U.l=_),v=U}return p=u.ya,(_=u.D)&&p&&Me(v,_,p),Me(v,"VER",u.la),Wa(u,v),v}function jp(u,p,_){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return(p=new We(u.Ca&&!u.pa?new Ga({eb:_}):u.pa)).Ha(u.J),p}function zp(){}function sl(){}function wt(u,p){lt.call(this),this.g=new Dp(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!ie(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!ie(p)&&(this.g.D=p,null!==(u=this.h)&&p in u&&p in(u=this.h)&&delete u[p]),this.j=new ro(this)}function Kp(u){xd.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const _ in p){u=_;break e}u=void 0}(this.i=u)&&(u=this.i,p=null!==p&&u in p?p[u]:void 0),this.data=p}else this.data=u}function Wp(){Vd.call(this),this.status=1}function ro(u){this.g=u}(r=We.prototype).Ha=function(u){this.J=u},r.ea=function(u,p,_,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():kd.g(),this.v=function np(u){return u.h||(u.h=u.i())}(this.o?this.o:kd),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(U){return void bp(this,U)}if(u=_||"",_=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var D in v)_.set(D,v[D]);else{if("function"!=typeof v.keys||"function"!=typeof v.get)throw Error("Unknown input type for opt_headers: "+String(v));for(const U of v.keys())_.set(U,v.get(U))}v=Array.from(_.keys()).find(U=>"content-type"==U.toLowerCase()),D=d.FormData&&u instanceof d.FormData,!(0<=Array.prototype.indexOf.call(s_,p,void 0))||v||D||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,$]of _)this.g.setRequestHeader(U,$);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Vp(this),this.u=!0,this.g.send(u),this.u=!1}catch(U){bp(this,U)}},r.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,mt(this,"complete"),mt(this,"abort"),tl(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tl(this,!0)),We.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?xp(this):this.bb())},r.bb=function(){xp(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Zn(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&0==p.indexOf(u)&&(p=p.substring(u.length)),Lg(p)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=Dp.prototype).la=8,r.G=1,r.connect=function(u,p,_,v){gt(0),this.W=u,this.H=p||{},_&&void 0!==v&&(this.H.OSID=_,this.H.OAID=v),this.F=this.X,this.I=Gp(this,null,this.W),rl(this)},r.Ga=function(u){if(this.s)if(this.s=null,1==this.G){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const D=new Dr(this,this.j,u);let U=this.o;if(this.S&&(U?(U=A(U),x(U,this.S)):U=this.S),null!==this.m||this.O||(D.H=U,U=null),this.P)e:{for(var p=0,_=0;_<this.i.length;_++){var v=this.i[_];if(void 0===(v="__data__"in v.map&&"string"==typeof(v=v.map.__data__)?v.length:void 0))break;if(4096<(p+=v)){p=_;break e}if(4096===p||_===this.i.length-1){p=_+1;break e}}p=1e3}else p=1e3;p=Mp(this,D,p),Me(_=Xn(this.I),"RID",u),Me(_,"CVER",22),this.D&&Me(_,"X-HTTP-Session-Id",this.D),Wa(this,_),U&&(this.O?p="headers="+encodeURIComponent(String(Sp(U)))+"&"+p:this.m&&Ud(_,this.m,U)),Fd(this.h,D),this.Ua&&Me(_,"TYPE","init"),this.P?(Me(_,"$req",p),Me(_,"SID","null"),D.T=!0,Nd(D,_,null)):Nd(D,_,p),this.G=2}}else 3==this.G&&(u?Op(this,u):0==this.i.length||mp(this.h)||Op(this))},r.Fa=function(){if(this.u=null,Fp(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Ma(w(this.ab,this),u)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,gt(10),nl(this),Fp(this))},r.Za=function(){null!=this.C&&(this.C=null,nl(this),qd(this),gt(19))},r.fb=function(u){u?(this.j.info("Successfully pinged google.com"),gt(2)):(this.j.info("Failed to ping google.com"),gt(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=zp.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},sl.prototype.g=function(u,p){return new wt(u,p)},B(wt,lt),wt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},wt.prototype.close=function(){Bd(this.g)},wt.prototype.o=function(u){var p=this.g;if("string"==typeof u){var _={};_.__data__=u,u=_}else this.u&&((_={}).__data__=bd(u),u=_);p.i.push(new zg(p.Ya++,u)),3==p.G&&rl(p)},wt.prototype.N=function(){this.g.l=null,delete this.j,Bd(this.g),delete this.g,wt.aa.N.call(this)},B(Kp,xd),B(Wp,Vd),B(ro,zp),ro.prototype.ua=function(){mt(this.g,"a")},ro.prototype.ta=function(u){mt(this.g,new Kp(u))},ro.prototype.sa=function(u){mt(this.g,new Wp)},ro.prototype.ra=function(){mt(this.g,"b")},sl.prototype.createWebChannel=sl.prototype.g,wt.prototype.send=wt.prototype.o,wt.prototype.open=wt.prototype.m,wt.prototype.close=wt.prototype.close,bn=It.createWebChannelTransport=function(){return new sl},Ni=It.getStatEventTarget=function(){return $c()},Sn=It.Event=bi,oo=It.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Hc.NO_ERROR=0,Hc.TIMEOUT=8,Hc.HTTP_ERROR=6,Pn=It.ErrorCode=Hc,up.COMPLETE="complete",Di=It.EventType=up,rp.EventType=Na,Na.OPEN="a",Na.CLOSE="b",Na.ERROR="c",Na.MESSAGE="d",lt.prototype.listen=lt.prototype.K,Rn=It.WebChannel=rp,Fr=It.FetchXmlHttpFactory=Ga,We.prototype.listenOnce=We.prototype.L,We.prototype.getLastError=We.prototype.Ka,We.prototype.getLastErrorCode=We.prototype.Ba,We.prototype.getStatus=We.prototype.Z,We.prototype.getResponseJson=We.prototype.Oa,We.prototype.getResponseText=We.prototype.oa,We.prototype.send=We.prototype.ea,We.prototype.setWithCredentials=We.prototype.Ha,ki=It.XhrIo=We}).apply(typeof Lr<"u"?Lr:typeof self<"u"?self:typeof window<"u"?window:{});const Q="@firebase/firestore";class se{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}se.UNAUTHENTICATED=new se(null),se.GOOGLE_CREDENTIALS=new se("google-credentials-uid"),se.FIRST_PARTY=new se("first-party-uid"),se.MOCK_USER=new se("mock-user");let _e="10.12.1";const ce=new $e.Vy("@firebase/firestore");function we(){return ce.logLevel}function b(r,...e){if(ce.logLevel<=$e.$b.DEBUG){const t=e.map(Cn);ce.debug(`Firestore (${_e}): ${r}`,...t)}}function ye(r,...e){if(ce.logLevel<=$e.$b.ERROR){const t=e.map(Cn);ce.error(`Firestore (${_e}): ${r}`,...t)}}function Le(r,...e){if(ce.logLevel<=$e.$b.WARN){const t=e.map(Cn);ce.warn(`Firestore (${_e}): ${r}`,...t)}}function Cn(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function J(r="Unexpected state"){const e=`FIRESTORE (${_e}) INTERNAL ASSERTION FAILED: `+r;throw ye(e),new Error(e)}function Z(r,e){r||J()}function W(r,e){return r}const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class G extends Ae.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class qe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class $a{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ul{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(se.UNAUTHENTICATED))}shutdown(){}}class xe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ve{constructor(e){this.t=e,this.currentUser=se.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const o=m=>this.i!==i?(i=this.i,t(m)):Promise.resolve();let c=new qe;this.o=()=>{this.i++,this.currentUser=this.u(),c.resolve(),c=new qe,e.enqueueRetryable(()=>o(this.currentUser))};const d=()=>{const m=c;e.enqueueRetryable((0,E.A)(function*(){yield m.promise,yield o(n.currentUser)}))},f=m=>{b("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(m=>f(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?f(m):(b("FirebaseAuthCredentialsProvider","Auth not yet detected"),c.resolve(),c=new qe)}},0),d()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(b("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Z("string"==typeof n.accessToken),new $a(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Z(null===e||"string"==typeof e),new se(e)}}class uo{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=se.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ha{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new uo(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(se.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Oi{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ft{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=o=>{null!=o.error&&b("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const c=o.token!==this.R;return this.R=o.token,b("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>n(o))};const i=o=>{b("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.A.getImmediate({optional:!0});o?i(o):b("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Z("string"==typeof t.token),this.R=t.token,new Oi(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ja(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class Ya{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=Ja(40);for(let o=0;o<i.length;++o)n.length<20&&i[o]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[o]%62))}return n}}function ae(r,e){return r<e?-1:r>e?1:0}function Rt(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}class De{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new G(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new G(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new G(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new G(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return De.fromMillis(Date.now())}static fromDate(e){return De.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new De(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ae(this.nanoseconds,e.nanoseconds):ae(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class te{constructor(e){this.timestamp=e}static fromTimestamp(e){return new te(e)}static min(){return new te(new De(0,0))}static max(){return new te(new De(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ur{constructor(e,t,n){void 0===t?t=0:t>e.length&&J(),void 0===n?n=e.length-t:n>e.length-t&&J(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ur.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ur?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const o=e.get(i),c=t.get(i);if(o<c)return-1;if(o>c)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class he extends Ur{construct(e,t,n){return new he(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new G(F.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new he(t)}static emptyPath(){return new he([])}}const Xa=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Pe extends Ur{construct(e,t,n){return new Pe(e,t,n)}static isValidIdentifier(e){return Xa.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Pe.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Pe(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const o=()=>{if(0===n.length)throw new G(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let c=!1;for(;i<e.length;){const d=e[i];if("\\"===d){if(i+1===e.length)throw new G(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[i+1];if("\\"!==f&&"."!==f&&"`"!==f)throw new G(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=f,i+=2}else"`"===d?(c=!c,i++):"."!==d||c?(n+=d,i++):(o(),i++)}if(o(),c)throw new G(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Pe(t)}static emptyPath(){return new Pe([])}}class H{constructor(e){this.path=e}static fromPath(e){return new H(he.fromString(e))}static fromName(e){return new H(he.fromString(e).popFirst(5))}static empty(){return new H(he.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===he.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return he.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new H(new he(e.slice()))}}class nt{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new nt(te.min(),H.empty(),-1)}static max(){return new nt(te.max(),H.empty(),-1)}}function tr(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=H.comparator(r.documentKey,e.documentKey),0!==t?t:ae(r.largestBatchId,e.largestBatchId))}const ho="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Pt{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function St(r){return fo.apply(this,arguments)}function fo(){return(fo=(0,E.A)(function*(r){if(r.code!==F.FAILED_PRECONDITION||r.message!==ho)throw r;b("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class N{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&J(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new N((n,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(n,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof N?t:N.resolve(t)}catch(t){return N.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):N.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):N.reject(t)}static resolve(e){return new N((t,n)=>{t(e)})}static reject(e){return new N((t,n)=>{n(e)})}static waitFor(e){return new N((t,n)=>{let i=0,o=0,c=!1;e.forEach(d=>{++i,d.next(()=>{++o,c&&o===i&&t()},f=>n(f))}),c=!0,o===i&&t()})}static or(e){let t=N.resolve(!1);for(const n of e)t=t.next(i=>i?N.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,o)=>{n.push(t.call(this,i,o))}),this.waitFor(n)}static mapArray(e,t){return new N((n,i)=>{const o=e.length,c=new Array(o);let d=0;for(let f=0;f<o;f++){const m=f;t(e[m]).next(y=>{c[m]=y,++d,d===o&&n(c)},y=>i(y))}})}static doWhile(e,t){return new N((n,i)=>{const o=()=>{!0===e()?t().next(()=>{o()},i):n()};o()})}}function Xt(r){return"IndexedDbTransactionError"===r.name}let Ge=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function ft(r){return null==r}function ir(r){return 0===r&&1/r==-1/0}function lu(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Zt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Eo(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Se{constructor(e,t){this.comparator=e,this.root=t||Je.EMPTY}insert(e,t){return new Se(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Je.BLACK,null,null))}remove(e){return new Se(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Je.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bi(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bi(this.root,e,this.comparator,!0)}}class Bi{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(0===o){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Je{constructor(e,t,n,i,o){this.key=e,this.value=t,this.color=null!=n?n:Je.RED,this.left=null!=i?i:Je.EMPTY,this.right=null!=o?o:Je.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,o){return new Je(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=o?o:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const o=n(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===o?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Je.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Je.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Je.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Je.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw J();const e=this.left.check();if(e!==this.right.check())throw J();return e+(this.isRed()?0:1)}}Je.EMPTY=null,Je.RED=!0,Je.BLACK=!1,Je.EMPTY=new class{constructor(){this.size=0}get key(){throw J()}get value(){throw J()}get color(){throw J()}get left(){throw J()}get right(){throw J()}copy(e,t,n,i,o){return this}insert(e,t,n){return new Je(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ee{constructor(e){this.comparator=e,this.data=new Se(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new qi(this.data.getIterator())}getIteratorFrom(e){return new qi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Ee)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=n.getNext().key;if(0!==this.comparator(i,o))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ee(this.comparator);return t.data=e,t}}class qi{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class et{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new et([])}unionWith(e){let t=new Ee(Pe.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new et(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Rt(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class du extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class He{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new du("Invalid base64 string: "+o):o}}(e);return new He(t)}static fromUint8Array(e){const t=function(i){let o="";for(let c=0;c<i.length;++c)o+=String.fromCharCode(i[c]);return o}(e);return new He(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ae(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}He.EMPTY_BYTE_STRING=new He("");const _l=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ct(r){if(Z(!!r),"string"==typeof r){let e=0;const t=_l.exec(r);if(Z(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Oe(r.seconds),nanos:Oe(r.nanos)}}function Oe(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function qt(r){return"string"==typeof r?He.fromBase64String(r):He.fromUint8Array(r)}function Kr(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Gi(r){const e=r.mapValue.fields.__previous_value__;return Kr(e)?Gi(e):e}function xt(r){const e=Ct(r.mapValue.fields.__local_write_time__.timestampValue);return new De(e.seconds,e.nanos)}class pu{constructor(e,t,n,i,o,c,d,f,m){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=o,this.forceLongPolling=c,this.autoDetectLongPolling=d,this.longPollingOptions=f,this.useFetchStreams=m}}class Gt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Gt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Gt&&e.projectId===this.projectId&&e.database===this.database}}const en={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function tn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Kr(r)?4:zi(r)?9007199254740991:10:J()}function _t(r,e){if(r===e)return!0;const t=tn(r);if(t!==tn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return xt(r).isEqual(xt(e));case 3:return function(i,o){if("string"==typeof i.timestampValue&&"string"==typeof o.timestampValue&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const c=Ct(i.timestampValue),d=Ct(o.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return o=e,qt(r.bytesValue).isEqual(qt(o.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,o){return Oe(i.geoPointValue.latitude)===Oe(o.geoPointValue.latitude)&&Oe(i.geoPointValue.longitude)===Oe(o.geoPointValue.longitude)}(r,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return Oe(i.integerValue)===Oe(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const c=Oe(i.doubleValue),d=Oe(o.doubleValue);return c===d?ir(c)===ir(d):isNaN(c)&&isNaN(d)}return!1}(r,e);case 9:return Rt(r.arrayValue.values||[],e.arrayValue.values||[],_t);case 10:return function(i,o){const c=i.mapValue.fields||{},d=o.mapValue.fields||{};if(lu(c)!==lu(d))return!1;for(const f in c)if(c.hasOwnProperty(f)&&(void 0===d[f]||!_t(c[f],d[f])))return!1;return!0}(r,e);default:return J()}var o}function Wr(r,e){return void 0!==(r.values||[]).find(t=>_t(t,e))}function Vt(r,e){if(r===e)return 0;const t=tn(r),n=tn(e);if(t!==n)return ae(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ae(r.booleanValue,e.booleanValue);case 2:return function(o,c){const d=Oe(o.integerValue||o.doubleValue),f=Oe(c.integerValue||c.doubleValue);return d<f?-1:d>f?1:d===f?0:isNaN(d)?isNaN(f)?0:-1:1}(r,e);case 3:return mu(r.timestampValue,e.timestampValue);case 4:return mu(xt(r),xt(e));case 5:return ae(r.stringValue,e.stringValue);case 6:return function(o,c){const d=qt(o),f=qt(c);return d.compareTo(f)}(r.bytesValue,e.bytesValue);case 7:return function(o,c){const d=o.split("/"),f=c.split("/");for(let m=0;m<d.length&&m<f.length;m++){const y=ae(d[m],f[m]);if(0!==y)return y}return ae(d.length,f.length)}(r.referenceValue,e.referenceValue);case 8:return function(o,c){const d=ae(Oe(o.latitude),Oe(c.latitude));return 0!==d?d:ae(Oe(o.longitude),Oe(c.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(o,c){const d=o.values||[],f=c.values||[];for(let m=0;m<d.length&&m<f.length;++m){const y=Vt(d[m],f[m]);if(y)return y}return ae(d.length,f.length)}(r.arrayValue,e.arrayValue);case 10:return function(o,c){if(o===en.mapValue&&c===en.mapValue)return 0;if(o===en.mapValue)return 1;if(c===en.mapValue)return-1;const d=o.fields||{},f=Object.keys(d),m=c.fields||{},y=Object.keys(m);f.sort(),y.sort();for(let T=0;T<f.length&&T<y.length;++T){const w=ae(f[T],y[T]);if(0!==w)return w;const O=Vt(d[f[T]],m[y[T]]);if(0!==O)return O}return ae(f.length,y.length)}(r.mapValue,e.mapValue);default:throw J()}}function mu(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return ae(r,e);const t=Ct(r),n=Ct(e),i=ae(t.seconds,n.seconds);return 0!==i?i:ae(t.nanos,n.nanos)}function nn(r){return ar(r)}function ar(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Ct(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?qt(r.bytesValue).toBase64():"referenceValue"in r?H.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const o of t.values||[])i?i=!1:n+=",",n+=ar(o);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",o=!0;for(const c of n)o?o=!1:i+=",",i+=`${c}:${ar(t.fields[c])}`;return i+"}"}(r.mapValue):J()}function kn(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function $r(r){return!!r&&"integerValue"in r}function Hr(r){return!!r&&"arrayValue"in r}function ji(r){return!!r&&"nullValue"in r}function gu(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function cr(r){return!!r&&"mapValue"in r}function Qr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Zt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Qr(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Qr(r.arrayValue.values[t]);return e}return Object.assign({},r)}function zi(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}class Ue{constructor(e){this.value=e}static empty(){return new Ue({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!cr(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qr(t)}setAll(e){let t=Pe.emptyPath(),n={},i=[];e.forEach((c,d)=>{if(!t.isImmediateParentOf(d)){const f=this.getFieldsMap(t);this.applyChanges(f,n,i),n={},i=[],t=d.popLast()}c?n[d.lastSegment()]=Qr(c):i.push(d.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,n,i)}delete(e){const t=this.field(e.popLast());cr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return _t(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];cr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Zt(t,(i,o)=>e[i]=o);for(const i of n)delete e[i]}clone(){return new Ue(Qr(this.value))}}function kt(r){const e=[];return Zt(r.fields,(t,n)=>{const i=new Pe([t]);if(cr(n)){const o=kt(n.mapValue).fields;if(0===o.length)e.push(i);else for(const c of o)e.push(i.child(c))}else e.push(i)}),new et(e)}class Re{constructor(e,t,n,i,o,c,d){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=o,this.data=c,this.documentState=d}static newInvalidDocument(e){return new Re(e,0,te.min(),te.min(),te.min(),Ue.empty(),0)}static newFoundDocument(e,t,n,i){return new Re(e,1,t,te.min(),n,i,0)}static newNoDocument(e,t){return new Re(e,2,t,te.min(),te.min(),Ue.empty(),0)}static newUnknownDocument(e,t){return new Re(e,3,t,te.min(),te.min(),Ue.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(te.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ue.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Re&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Re(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rn{constructor(e,t){this.position=e,this.inclusive=t}}function Tt(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const o=e[i],c=r.position[i];if(n=o.field.isKeyField()?H.comparator(H.fromName(c.referenceValue),t.key):Vt(c,t.data.field(o.field)),"desc"===o.dir&&(n*=-1),0!==n)break}return n}function yu(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!_t(r.position[t],e.position[t]))return!1;return!0}class Dn{constructor(e,t="asc"){this.field=e,this.dir=t}}function Il(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Wi{}class pe extends Wi{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Po(e,t,n):"array-contains"===t?new Tl(e,n):"in"===t?new vu(e,n):"not-in"===t?new El(e,n):"array-contains-any"===t?new Al(e,n):new pe(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new jt(e,n):new dr(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Vt(t,this.value)):null!==t&&tn(this.value)===tn(t)&&this.matchesComparison(Vt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return J()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ie extends Wi{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ie(e,t)}matches(e){return lr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function lr(r){return"and"===r.op}function Jr(r){return function sn(r){for(const e of r.filters)if(e instanceof Ie)return!1;return!0}(r)&&lr(r)}function Ro(r){if(r instanceof pe)return r.field.canonicalString()+r.op.toString()+nn(r.value);if(Jr(r))return r.filters.map(e=>Ro(e)).join(",");{const e=r.filters.map(t=>Ro(t)).join(",");return`${r.op}(${e})`}}function Iu(r,e){return r instanceof pe?(n=r,(i=e)instanceof pe&&n.op===i.op&&n.field.isEqual(i.field)&&_t(n.value,i.value)):r instanceof Ie?function(n,i){return i instanceof Ie&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((o,c,d)=>o&&Iu(c,i.filters[d]),!0)}(r,e):void J();var n,i}function vl(r){return r instanceof pe?`${(t=r).field.canonicalString()} ${t.op} ${nn(t.value)}`:r instanceof Ie?function(t){return t.op.toString()+" {"+t.getFilters().map(vl).join(" ,")+"}"}(r):"Filter";var t}class Po extends pe{constructor(e,t,n){super(e,t,n),this.key=H.fromName(n.referenceValue)}matches(e){const t=H.comparator(e.key,this.key);return this.matchesComparison(t)}}class jt extends pe{constructor(e,t){super(e,"in",t),this.keys=fr(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class dr extends pe{constructor(e,t){super(e,"not-in",t),this.keys=fr(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function fr(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>H.fromName(n.referenceValue))}class Tl extends pe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Hr(t)&&Wr(t.arrayValue,this.value)}}class vu extends pe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Wr(this.value.arrayValue,t)}}class El extends pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Wr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Wr(this.value.arrayValue,t)}}class Al extends pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Hr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Wr(this.value.arrayValue,n))}}class pr{constructor(e,t=null,n=[],i=[],o=null,c=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=o,this.startAt=c,this.endAt=d,this.ue=null}}function So(r,e=null,t=[],n=[],i=null,o=null,c=null){return new pr(r,e,t,n,i,o,c)}function Dt(r){const e=W(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Ro(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(o=n).field.canonicalString()+o.dir;var o}).join(","),ft(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>nn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>nn(n)).join(",")),e.ue=t}return e.ue}function Yr(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Il(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Iu(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!yu(r.startAt,e.startAt)&&yu(r.endAt,e.endAt)}function Xr(r){return H.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class zt{constructor(e,t=null,n=[],i=[],o=null,c="F",d=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=o,this.limitType=c,this.startAt=d,this.endAt=f,this.ce=null,this.le=null,this.he=null}}function Kt(r){return new zt(r)}function Co(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Hi(r){return null!==r.collectionGroup}function gr(r){const e=W(r);if(null===e.ce){e.ce=[];const t=new Set;for(const o of e.explicitOrderBy)e.ce.push(o),t.add(o.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let d=new Ee(Pe.comparator);return c.filters.forEach(f=>{f.getFlattenedFilters().forEach(m=>{m.isInequality()&&(d=d.add(m.field))})}),d})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.ce.push(new Dn(o,n))}),t.has(Pe.keyField().canonicalString())||e.ce.push(new Dn(Pe.keyField(),n))}return e.ce}function Ye(r){const e=W(r);return e.le||(e.le=function Ji(r,e){if("F"===r.limitType)return So(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new Dn(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new rn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new rn(r.startAt.position,r.startAt.inclusive):null;return So(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,gr(r))),e.le}function _r(r,e){const t=r.filters.concat([e]);return new zt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function yr(r,e,t){return new zt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Ir(r,e){return Yr(Ye(r),Ye(e))&&r.limitType===e.limitType}function Yi(r){return`${Dt(Ye(r))}|lt:${r.limitType}`}function Nn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>vl(i)).join(", ")}]`),ft(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(c=i).field.canonicalString()} (${c.dir})`;var c}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>nn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>nn(i)).join(",")),`Target(${n})`}(Ye(r))}; limitType=${r.limitType})`}function On(r,e){return e.isFoundDocument()&&function(n,i){const o=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):H.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)}(r,e)&&function(n,i){for(const o of gr(n))if(!o.field.isKeyField()&&null===i.data.field(o.field))return!1;return!0}(r,e)&&function(n,i){for(const o of n.filters)if(!o.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(c,d,f){const m=Tt(c,d,f);return c.inclusive?m<=0:m<0}(n.startAt,gr(n),i)||n.endAt&&!function(c,d,f){const m=Tt(c,d,f);return c.inclusive?m>=0:m>0}(n.endAt,gr(n),i)));var n,i}function Xi(r){return(e,t)=>{let n=!1;for(const i of gr(r)){const o=Tu(i,e,t);if(0!==o)return o;n=n||i.field.isKeyField()}return 0}}function Tu(r,e,t){const n=r.field.isKeyField()?H.comparator(e.key,t.key):function(o,c,d){const f=c.data.field(o),m=d.data.field(o);return null!==f&&null!==m?Vt(f,m):J()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return J()}}class Et{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,o]of n)if(this.equalsFn(i,e))return o}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Zt(this.inner,(t,n)=>{for(const[i,o]of n)e(i,o)})}isEmpty(){return Eo(this.inner)}size(){return this.innerSize}}const Eu=new Se(H.comparator);function tt(){return Eu}const Au=new Se(H.comparator);function Mn(...r){let e=Au;for(const t of r)e=e.insert(t.key,t);return e}function wu(r){let e=Au;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function yt(){return Ln()}function vr(){return Ln()}function Ln(){return new Et(r=>r.toString(),(r,e)=>r.isEqual(e))}const xo=new Se(H.comparator),Zi=new Ee(H.comparator);function ue(...r){let e=Zi;for(const t of r)e=e.add(t);return e}const Vo=new Ee(ae);function es(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ir(e)?"-0":e}}function Ru(r){return{integerValue:""+r}}function ts(r,e){return function vt(r){return"number"==typeof r&&Number.isInteger(r)&&!ir(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?Ru(e):es(r,e)}class ns{constructor(){this._=void 0}}function Do(r,e,t){return r instanceof Tr?function(i,o){const c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&Kr(o)&&(o=Gi(o)),o&&(c.fields.__previous_value__=o),{mapValue:c}}(t,e):r instanceof Wt?Su(r,e):r instanceof $t?bu(r,e):function(i,o){const c=rs(i,o),d=is(c)+is(i.Pe);return $r(c)&&$r(i.Pe)?Ru(d):es(i.serializer,d)}(r,e)}function Pu(r,e,t){return r instanceof Wt?Su(r,e):r instanceof $t?bu(r,e):t}function rs(r,e){return r instanceof Er?$r(n=e)||(o=n)&&"doubleValue"in o?e:{integerValue:0}:null;var n,o}class Tr extends ns{}class Wt extends ns{constructor(e){super(),this.elements=e}}function Su(r,e){const t=Cu(e);for(const n of r.elements)t.some(i=>_t(i,n))||t.push(n);return{arrayValue:{values:t}}}class $t extends ns{constructor(e){super(),this.elements=e}}function bu(r,e){let t=Cu(e);for(const n of r.elements)t=t.filter(i=>!_t(i,n));return{arrayValue:{values:t}}}class Er extends ns{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function is(r){return Oe(r.integerValue||r.doubleValue)}function Cu(r){return Hr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class ei{constructor(e,t){this.field=e,this.transform=t}}class wl{constructor(e,t){this.version=e,this.transformResults=t}}class be{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new be}static exists(e){return new be(void 0,e)}static updateTime(e){return new be(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ss(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Ar{}function xu(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Fn(r.key,be.none()):new on(r.key,r.data,be.none());{const t=r.data,n=Ue.empty();let i=new Ee(Pe.comparator);for(let o of e.fields)if(!i.has(o)){let c=t.field(o);null===c&&o.length>1&&(o=o.popLast(),c=t.field(o)),null===c?n.delete(o):n.set(o,c),i=i.add(o)}return new Ht(r.key,n,new et(i.toArray()),be.none())}}function Oo(r,e,t){r instanceof on?function(i,o,c){const d=i.value.clone(),f=ku(i.fieldTransforms,o,c.transformResults);d.setAll(f),o.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(r,e,t):r instanceof Ht?function(i,o,c){if(!ss(i.precondition,o))return void o.convertToUnknownDocument(c.version);const d=ku(i.fieldTransforms,o,c.transformResults),f=o.data;f.setAll(os(i)),f.setAll(d),o.convertToFoundDocument(c.version,f).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function ti(r,e,t,n){return r instanceof on?function(o,c,d,f){if(!ss(o.precondition,c))return d;const m=o.value.clone(),y=Du(o.fieldTransforms,f,c);return m.setAll(y),c.convertToFoundDocument(c.version,m).setHasLocalMutations(),null}(r,e,t,n):r instanceof Ht?function(o,c,d,f){if(!ss(o.precondition,c))return d;const m=Du(o.fieldTransforms,f,c),y=c.data;return y.setAll(os(o)),y.setAll(m),c.convertToFoundDocument(c.version,y).setHasLocalMutations(),null===d?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(T=>T.field))}(r,e,t,n):(d=t,ss(r.precondition,c=e)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):d);var c,d}function Mo(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),o=rs(n.transform,i||null);null!=o&&(null===t&&(t=Ue.empty()),t.set(n.field,o))}return t||null}function Vu(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&Rt(n,i,(o,c)=>function No(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Wt&&i instanceof Wt||n instanceof $t&&i instanceof $t?Rt(n.elements,i.elements,_t):n instanceof Er&&i instanceof Er?_t(n.Pe,i.Pe):n instanceof Tr&&i instanceof Tr);var n,i}(o,c))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class on extends Ar{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ht extends Ar{constructor(e,t,n,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function os(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function ku(r,e,t){const n=new Map;Z(r.length===t.length);for(let i=0;i<t.length;i++){const o=r[i],c=o.transform,d=e.data.field(o.field);n.set(o.field,Pu(c,d,t[i]))}return n}function Du(r,e,t){const n=new Map;for(const i of r){const o=i.transform,c=t.data.field(i.field);n.set(i.field,Do(o,c,e))}return n}class Fn extends Ar{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ni extends Ar{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Lo{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&Oo(o,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ti(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ti(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=vr();return this.mutations.forEach(i=>{const o=e.get(i.key),c=o.overlayedDocument;let d=this.applyToLocalView(c,o.mutatedFields);d=t.has(i.key)?null:d;const f=xu(c,d);null!==f&&n.set(i.key,f),c.isValidDocument()||c.convertToNoDocument(te.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ue())}isEqual(e){return this.batchId===e.batchId&&Rt(this.mutations,e.mutations,(t,n)=>Vu(t,n))&&Rt(this.baseMutations,e.baseMutations,(t,n)=>Vu(t,n))}}class an{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){Z(e.mutations.length===n.length);let i=function(){return xo}();const o=e.mutations;for(let c=0;c<o.length;c++)i=i.insert(o[c].key,n[c].version);return new an(e,t,n,i)}}class as{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Rl{constructor(e,t){this.count=e,this.unchangedNames=t}}var ze,ge;function Pl(r){if(void 0===r)return ye("GRPC error has no .code"),F.UNKNOWN;switch(r){case ze.OK:return F.OK;case ze.CANCELLED:return F.CANCELLED;case ze.UNKNOWN:return F.UNKNOWN;case ze.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case ze.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case ze.INTERNAL:return F.INTERNAL;case ze.UNAVAILABLE:return F.UNAVAILABLE;case ze.UNAUTHENTICATED:return F.UNAUTHENTICATED;case ze.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case ze.NOT_FOUND:return F.NOT_FOUND;case ze.ALREADY_EXISTS:return F.ALREADY_EXISTS;case ze.PERMISSION_DENIED:return F.PERMISSION_DENIED;case ze.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case ze.ABORTED:return F.ABORTED;case ze.OUT_OF_RANGE:return F.OUT_OF_RANGE;case ze.UNIMPLEMENTED:return F.UNIMPLEMENTED;case ze.DATA_LOSS:return F.DATA_LOSS;default:return J()}}(ge=ze||(ze={}))[ge.OK=0]="OK",ge[ge.CANCELLED=1]="CANCELLED",ge[ge.UNKNOWN=2]="UNKNOWN",ge[ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ge[ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ge[ge.NOT_FOUND=5]="NOT_FOUND",ge[ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",ge[ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",ge[ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",ge[ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ge[ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ge[ge.ABORTED=10]="ABORTED",ge[ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",ge[ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",ge[ge.INTERNAL=13]="INTERNAL",ge[ge.UNAVAILABLE=14]="UNAVAILABLE",ge[ge.DATA_LOSS=15]="DATA_LOSS";const Uo=new k([4294967295,4294967295],0);function Mu(r){const e=function Sl(){return new TextEncoder}().encode(r),t=new so;return t.update(e),new Uint8Array(t.digest())}function Lu(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new k([t,n],0),new k([i,o],0)]}class Fu{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new us(`Invalid padding: ${t}`);if(n<0)throw new us(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new us(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new us(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=k.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(k.fromNumber(n)));return 1===i.compare(Uo)&&(i=new k([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Mu(e),[n,i]=Lu(t);for(let o=0;o<this.hashCount;o++){const c=this.Ee(n,i,o);if(!this.de(c))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),c=new Fu(o,i,t);return n.forEach(d=>c.insert(d)),c}insert(e){if(0===this.Ie)return;const t=Mu(e),[n,i]=Lu(t);for(let o=0;o<this.hashCount;o++){const c=this.Ee(n,i,o);this.Ae(c)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class us extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class cs{constructor(e,t,n,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,ri.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new cs(te.min(),i,new Se(ae),tt(),ue())}}class ri{constructor(e,t,n,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ri(n,t,ue(),ue(),ue())}}class Bo{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class bl{constructor(e,t){this.targetId=e,this.me=t}}class ls{constructor(e,t,n=He.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class un{constructor(){this.fe=0,this.ge=Bu(),this.pe=He.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=ue(),t=ue(),n=ue();return this.ge.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:J()}}),new ri(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=Bu()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Z(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class qo{constructor(e){this.Le=e,this.Be=new Map,this.ke=tt(),this.qe=Uu(),this.Qe=new Se(ae)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:J()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const o=i.target;if(Xr(o))if(0===n){const c=new H(o.path);this.Ue(t,c,Re.newNoDocument(c,te.min()))}else Z(1===n);else{const c=this.Ye(t);if(c!==n){const d=this.Ze(e),f=d?this.Xe(d,e,c):1;0!==f&&(this.je(t),this.Qe=this.Qe.insert(t,2===f?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:o=0}=t;let c,d;try{c=qt(n).toUint8Array()}catch(f){if(f instanceof du)return Le("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{d=new Fu(c,i,o)}catch(f){return Le(f instanceof us?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return 0===d.Ie?null:d}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(o=>{const c=this.Le.tt(),d=`projects/${c.projectId}/databases/${c.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.Ue(t,o,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((o,c)=>{const d=this.Je(c);if(d){if(o.current&&Xr(d.target)){const f=new H(d.target.path);null!==this.ke.get(f)||this.it(c,f)||this.Ue(c,f,Re.newNoDocument(f,e))}o.be&&(t.set(c,o.Ce()),o.ve())}});let n=ue();this.qe.forEach((o,c)=>{let d=!0;c.forEachWhile(f=>{const m=this.Je(f);return!m||"TargetPurposeLimboResolution"===m.purpose||(d=!1,!1)}),d&&(n=n.add(o))}),this.ke.forEach((o,c)=>c.setReadTime(e));const i=new cs(e,t,this.Qe,this.ke,n);return this.ke=tt(),this.qe=Uu(),this.Qe=new Se(ae),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new un,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ee(ae),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||b("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new un),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Uu(){return new Se(H.comparator)}function Bu(){return new Se(H.comparator)}const Cl={asc:"ASCENDING",desc:"DESCENDING"},Kd={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xl={and:"AND",or:"OR"};class Vl{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ii(r,e){return r.useProto3Json||ft(e)?e:{value:e}}function cn(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qu(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function hs(r,e){return cn(r,e.toTimestamp())}function Fe(r){return Z(!!r),te.fromTimestamp(function(t){const n=Ct(t);return new De(n.seconds,n.nanos)}(r))}function Go(r,e){return jo(r,e).canonicalString()}function jo(r,e){const t=(i=r,new he(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Gu(r){const e=he.fromString(r);return Z(ys(e)),e}function ds(r,e){return Go(r.databaseId,e.path)}function At(r,e){const t=Gu(e);if(t.get(1)!==r.databaseId.projectId)throw new G(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new G(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new H(ju(t))}function kl(r,e){return Go(r.databaseId,e)}function zo(r){return new he(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function ju(r){return Z(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function wr(r,e,t){return{name:ds(r,e),fields:t.value.mapValue.fields}}function Ku(r,e){return{documents:[kl(r,e.path)]}}function ps(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=kl(r,i);const o=function(m){if(0!==m.length)return _s(Ie.create(m,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const c=function(m){if(0!==m.length)return m.map(y=>{return{field:Nt((w=y).field),direction:si(w.dir)};var w})}(e.orderBy);c&&(t.structuredQuery.orderBy=c);const d=ii(r,e.limit);return null!==d&&(t.structuredQuery.limit=d),e.startAt&&(t.structuredQuery.startAt={before:(m=e.startAt).inclusive,values:m.position}),e.endAt&&(t.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{_t:t,parent:i};var m}function Wu(r){let e=function fs(r){const e=Gu(r);return 4===e.length?he.emptyPath():ju(e)}(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){Z(1===n);const y=t.from[0];y.allDescendants?i=y.collectionId:e=e.child(y.collectionId)}let o=[];t.where&&(o=function(T){const w=Ho(T);return w instanceof Ie&&Jr(w)?w.getFilters():[w]}(t.where));let c=[];t.orderBy&&(c=t.orderBy.map(w=>{return new Dn(Bn((B=w).field),function(j){switch(j){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(B.direction));var B}));let d=null;t.limit&&(d=function(T){let w;return w="object"==typeof T?T.value:T,ft(w)?null:w}(t.limit));let f=null;var T;t.startAt&&(f=new rn((T=t.startAt).values||[],!!T.before));let m=null;return t.endAt&&(m=function(T){return new rn(T.values||[],!T.before)}(t.endAt)),function $i(r,e,t,n,i,o,c,d){return new zt(r,e,t,n,i,o,c,d)}(e,i,c,o,d,"F",f,m)}function Ho(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Bn(t.unaryFilter.field);return pe.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Bn(t.unaryFilter.field);return pe.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Bn(t.unaryFilter.field);return pe.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=Bn(t.unaryFilter.field);return pe.create(c,"!=",{nullValue:"NULL_VALUE"});default:return J()}}(r):void 0!==r.fieldFilter?pe.create(Bn((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return J()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return Ie.create(t.compositeFilter.filters.map(n=>Ho(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return J()}}(t.compositeFilter.op))}(r):J();var t}function si(r){return Cl[r]}function gs(r){return Kd[r]}function Nl(r){return xl[r]}function Nt(r){return{fieldPath:r.canonicalString()}}function Bn(r){return Pe.fromServerFormat(r.fieldPath)}function _s(r){return r instanceof pe?function(t){if("=="===t.op){if(gu(t.value))return{unaryFilter:{field:Nt(t.field),op:"IS_NAN"}};if(ji(t.value))return{unaryFilter:{field:Nt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(gu(t.value))return{unaryFilter:{field:Nt(t.field),op:"IS_NOT_NAN"}};if(ji(t.value))return{unaryFilter:{field:Nt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Nt(t.field),op:gs(t.op),value:t.value}}}(r):r instanceof Ie?function(t){const n=t.getFilters().map(i=>_s(i));return 1===n.length?n[0]:{compositeFilter:{op:Nl(t.op),filters:n}}}(r):J()}function Ol(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ys(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class Ot{constructor(e,t,n,i,o=te.min(),c=te.min(),d=He.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=d,this.expectedCount=f}withSequenceNumber(e){return new Ot(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ot(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ot(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ot(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class $u{constructor(e){this.ct=e}}function Rr(r){const e=Wu({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?yr(e,e.limit,"L"):e}class ln{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Oe(e.integerValue));else if("doubleValue"in e){const n=Oe(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),ir(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n&&(n=Ct(n)),t.At(`${n.seconds||""}`),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(qt(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?zi(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):J()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const i of Object.keys(n))this.Rt(i,t),this.It(n[i],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const i of n)this.It(i,t)}gt(e,t){this.Et(t,37),H.fromName(e).path.forEach(n=>{this.Et(t,60),this.St(n,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}ln.bt=new ln;class ql{constructor(){this._n=new di}addToCollectionParentIndex(e,t){return this._n.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(nt.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(nt.min())}updateCollectionGroup(e,t,n){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}}class di{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Ee(he.comparator),o=!i.has(n);return this.index[t]=i.add(n),o}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Ee(he.comparator)).toArray()}}new Uint8Array(0);class Xe{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Xe(e,Xe.DEFAULT_COLLECTION_PERCENTILE,Xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Xe.DEFAULT_COLLECTION_PERCENTILE=10,Xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xe.DEFAULT=new Xe(41943040,Xe.DEFAULT_COLLECTION_PERCENTILE,Xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xe.DISABLED=new Xe(-1,0,0);class Wn{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Wn(0)}static Ln(){return new Wn(-1)}}class Ss{constructor(){this.changes=new Et(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?N.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class hc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ia{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&ti(n.mutation,i,et.empty(),De.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,ue()).next(()=>n))}getLocalViewOfDocuments(e,t,n=ue()){const i=yt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(o=>{let c=Mn();return o.forEach((d,f)=>{c=c.insert(d,f.overlayedDocument)}),c}))}getOverlayedDocuments(e,t){const n=yt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ue()))}populateOverlays(e,t,n){const i=[];return n.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((c,d)=>{t.set(c,d)})})}computeViews(e,t,n,i){let o=tt();const c=Ln(),d=Ln();return t.forEach((f,m)=>{const y=n.get(m.key);i.has(m.key)&&(void 0===y||y.mutation instanceof Ht)?o=o.insert(m.key,m):void 0!==y?(c.set(m.key,y.mutation.getFieldMask()),ti(y.mutation,m,y.mutation.getFieldMask(),De.now())):c.set(m.key,et.empty())}),this.recalculateAndSaveOverlays(e,o).next(f=>(f.forEach((m,y)=>c.set(m,y)),t.forEach((m,y)=>{var T;return d.set(m,new hc(y,null!==(T=c.get(m))&&void 0!==T?T:null))}),d))}recalculateAndSaveOverlays(e,t){const n=Ln();let i=new Se((c,d)=>c-d),o=ue();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(c=>{for(const d of c)d.keys().forEach(f=>{const m=t.get(f);if(null===m)return;let y=n.get(f)||et.empty();y=d.applyToLocalView(m,y),n.set(f,y);const T=(i.get(d.batchId)||ue()).add(f);i=i.insert(d.batchId,T)})}).next(()=>{const c=[],d=i.getReverseIterator();for(;d.hasNext();){const f=d.getNext(),m=f.key,y=f.value,T=vr();y.forEach(w=>{if(!o.has(w)){const O=xu(t.get(w),n.get(w));null!==O&&T.set(w,O),o=o.add(w)}}),c.push(this.documentOverlayCache.saveOverlays(e,m,T))}return N.waitFor(c)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return H.isDocumentKey((c=t).path)&&null===c.collectionGroup&&0===c.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Hi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var c}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(o=>{const c=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-o.size):N.resolve(yt());let d=-1,f=o;return c.next(m=>N.forEach(m,(y,T)=>(d<T.largestBatchId&&(d=T.largestBatchId),o.get(y)?N.resolve():this.remoteDocumentCache.getEntry(e,y).next(w=>{f=f.insert(y,w)}))).next(()=>this.populateOverlays(e,m,o)).next(()=>this.computeViews(e,f,m,ue())).next(y=>({batchId:d,changes:wu(y)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new H(t)).next(n=>{let i=Mn();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const o=t.collectionGroup;let c=Mn();return this.indexManager.getCollectionParents(e,o).next(d=>N.forEach(d,f=>{const m=(T=t,w=f.child(o),new zt(w,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt));var T,w;return this.getDocumentsMatchingCollectionQuery(e,m,n,i).next(y=>{y.forEach((T,w)=>{c=c.insert(T,w)})})}).next(()=>c))}getDocumentsMatchingCollectionQuery(e,t,n,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(c=>(o=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,o,i))).next(c=>{o.forEach((f,m)=>{const y=m.getKey();null===c.get(y)&&(c=c.insert(y,Re.newInvalidDocument(y)))});let d=Mn();return c.forEach((f,m)=>{const y=o.get(f);void 0!==y&&ti(y.mutation,m,et.empty(),De.now()),On(t,m)&&(d=d.insert(f,m))}),d})}}class Wl{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return N.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:(i=t).id,version:i.version,createTime:Fe(i.createTime)}),N.resolve();var i}getNamedQuery(e,t){return N.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:(i=t).name,query:Rr(i.bundledQuery),readTime:Fe(i.readTime)}),N.resolve();var i}}class dc{constructor(){this.overlays=new Se(H.comparator),this.hr=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){const n=yt();return N.forEach(t,i=>this.getOverlay(e,i).next(o=>{null!==o&&n.set(i,o)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,o)=>{this.ht(e,t,o)}),N.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.hr.get(n);return void 0!==i&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.hr.delete(n)),N.resolve()}getOverlaysForCollection(e,t,n){const i=yt(),o=t.length+1,c=new H(t.child("")),d=this.overlays.getIteratorFrom(c);for(;d.hasNext();){const f=d.getNext().value,m=f.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===o&&f.largestBatchId>n&&i.set(f.getKey(),f)}return N.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let o=new Se((m,y)=>m-y);const c=this.overlays.getIterator();for(;c.hasNext();){const m=c.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>n){let y=o.get(m.largestBatchId);null===y&&(y=yt(),o=o.insert(m.largestBatchId,y)),y.set(m.getKey(),m)}}const d=yt(),f=o.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((m,y)=>d.set(m,y)),!(d.size()>=i)););return N.resolve(d)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const c=this.hr.get(i.largestBatchId).delete(n.key);this.hr.set(i.largestBatchId,c)}this.overlays=this.overlays.insert(n.key,new as(t,n));let o=this.hr.get(t);void 0===o&&(o=ue(),this.hr.set(t,o)),this.hr.set(t,o.add(n.key))}}class mi{constructor(){this.Pr=new Ee(Ze.Ir),this.Tr=new Ee(Ze.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new Ze(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Ar(new Ze(e,t))}Rr(e,t){e.forEach(n=>this.removeReference(n,t))}Vr(e){const t=new H(new he([])),n=new Ze(t,e),i=new Ze(t,e+1),o=[];return this.Tr.forEachInRange([n,i],c=>{this.Ar(c),o.push(c.key)}),o}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new H(new he([])),n=new Ze(t,e),i=new Ze(t,e+1);let o=ue();return this.Tr.forEachInRange([n,i],c=>{o=o.add(c.key)}),o}containsKey(e){const t=new Ze(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Ze{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return H.comparator(e.key,t.key)||ae(e.pr,t.pr)}static Er(e,t){return ae(e.pr,t.pr)||H.comparator(e.key,t.key)}}class $l{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Ee(Ze.Ir)}checkEmpty(e){return N.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const o=this.yr;this.yr++;const c=new Lo(o,t,n,i);this.mutationQueue.push(c);for(const d of i)this.wr=this.wr.add(new Ze(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return N.resolve(c)}lookupMutationBatch(e,t){return N.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.br(t+1),o=i<0?0:i;return N.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Ze(t,0),i=new Ze(t,Number.POSITIVE_INFINITY),o=[];return this.wr.forEachInRange([n,i],c=>{const d=this.Sr(c.pr);o.push(d)}),N.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ee(ae);return t.forEach(i=>{const o=new Ze(i,0),c=new Ze(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([o,c],d=>{n=n.add(d.pr)})}),N.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let o=n;H.isDocumentKey(o)||(o=o.child(""));const c=new Ze(new H(o),0);let d=new Ee(ae);return this.wr.forEachWhile(f=>{const m=f.key.path;return!!n.isPrefixOf(m)&&(m.length===i&&(d=d.add(f.pr)),!0)},c),N.resolve(this.Dr(d))}Dr(e){const t=[];return e.forEach(n=>{const i=this.Sr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){Z(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return N.forEach(t.mutations,i=>{const o=new Ze(i.key,t.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){const n=new Ze(t,0),i=this.wr.firstAfterOrEqual(n);return N.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return N.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Hl{constructor(e){this.vr=e,this.docs=new Se(H.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),o=i?i.size:0,c=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:c}),this.size+=c-o,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return N.resolve(n?n.document.mutableCopy():Re.newInvalidDocument(t))}getEntries(e,t){let n=tt();return t.forEach(i=>{const o=this.docs.get(i);n=n.insert(i,o?o.document.mutableCopy():Re.newInvalidDocument(i))}),N.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let o=tt();const c=t.path,d=new H(c.child("")),f=this.docs.getIteratorFrom(d);for(;f.hasNext();){const{key:m,value:{document:y}}=f.getNext();if(!c.isPrefixOf(m.path))break;m.path.length>c.length+1||tr(new nt((r=y).readTime,r.key,-1),n)<=0||(i.has(y.key)||On(t,y))&&(o=o.insert(y.key,y.mutableCopy()))}var r;return N.resolve(o)}getAllFromCollectionGroup(e,t,n,i){J()}Fr(e,t){return N.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new sa(this)}getSize(e){return N.resolve(this.size)}}class sa extends Ss{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(n)}),N.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Ql{constructor(e){this.persistence=e,this.Mr=new Et(t=>Dt(t),Yr),this.lastRemoteSnapshotVersion=te.min(),this.highestTargetId=0,this.Or=0,this.Nr=new mi,this.targetCount=0,this.Lr=Wn.Nn()}forEachTarget(e,t){return this.Mr.forEach((n,i)=>t(i)),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),N.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new Wn(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.qn(t),N.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,n){let i=0;const o=[];return this.Mr.forEach((c,d)=>{d.sequenceNumber<=t&&null===n.get(d.targetId)&&(this.Mr.delete(c),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)}),N.waitFor(o).next(()=>i)}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return N.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),N.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(c=>{o.push(i.markPotentiallyOrphaned(e,c))}),N.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),N.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return N.resolve(n)}containsKey(e,t){return N.resolve(this.Nr.containsKey(t))}}class oa{constructor(e,t){this.Br={},this.overlays={},this.kr=new Ge(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Ql(this),this.indexManager=new ql,this.remoteDocumentCache=new Hl(n=>this.referenceDelegate.Kr(n)),this.serializer=new $u(t),this.$r=new Wl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new $l(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){b("MemoryPersistence","Starting transaction:",e);const i=new fc(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(o=>this.referenceDelegate.Wr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Gr(e,t){return N.or(Object.values(this.Br).map(n=>()=>n.containsKey(e,t)))}}class fc extends Pt{constructor(e){super(),this.currentSequenceNumber=e}}class xs{constructor(e){this.persistence=e,this.zr=new mi,this.jr=null}static Hr(e){return new xs(e)}get Jr(){if(this.jr)return this.jr;throw J()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),N.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),N.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.Jr.add(o.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.Jr,n=>{const i=H.fromPath(n);return this.Yr(e,i).next(o=>{o||t.removeEntry(i,te.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(n=>{n?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return N.or([()=>N.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class la{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=i}static Ki(e,t){let n=ue(),i=ue();for(const o of t.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new la(e,t.fromCache,n,i)}}class ha{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class mc{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,Ae.nr)()?8:function Li(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}((0,Ae.ZQ)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,i){const o={result:null};return this.ji(e,t).next(c=>{o.result=c}).next(()=>{if(!o.result)return this.Hi(e,t,i,n).next(c=>{o.result=c})}).next(()=>{if(o.result)return;const c=new ha;return this.Ji(e,t,c).next(d=>{if(o.result=d,this.Ui)return this.Yi(e,t,c,d.size)})}).next(()=>o.result)}Yi(e,t,n,i){return n.documentReadCount<this.Wi?(we()<=$e.$b.DEBUG&&b("QueryEngine","SDK will not create cache indexes for query:",Nn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),N.resolve()):(we()<=$e.$b.DEBUG&&b("QueryEngine","Query:",Nn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Gi*i?(we()<=$e.$b.DEBUG&&b("QueryEngine","The SDK decides to create cache indexes for query:",Nn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ye(t))):N.resolve())}ji(e,t){if(Co(t))return N.resolve(null);let n=Ye(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=yr(t,null,"F"),n=Ye(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(o=>{const c=ue(...o);return this.zi.getDocuments(e,c).next(d=>this.indexManager.getMinOffset(e,n).next(f=>{const m=this.Zi(t,d);return this.Xi(t,m,c,f.readTime)?this.ji(e,yr(t,null,"F")):this.es(e,m,t,f)}))})))}Hi(e,t,n,i){return Co(t)||i.isEqual(te.min())?N.resolve(null):this.zi.getDocuments(e,n).next(o=>{const c=this.Zi(t,o);return this.Xi(t,c,n,i)?N.resolve(null):(we()<=$e.$b.DEBUG&&b("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Nn(t)),this.es(e,c,t,function eu(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=te.fromTimestamp(1e9===n?new De(t+1,0):new De(t,n));return new nt(i,H.empty(),e)}(i,-1)).next(d=>d))})}Zi(e,t){let n=new Ee(Xi(e));return t.forEach((i,o)=>{On(e,o)&&(n=n.add(o))}),n}Xi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const o="F"===e.limitType?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ji(e,t,n){return we()<=$e.$b.DEBUG&&b("QueryEngine","Using full collection scan to execute query:",Nn(t)),this.zi.getDocumentsMatchingQuery(e,t,nt.min(),n)}es(e,t,n,i){return this.zi.getDocumentsMatchingQuery(e,n,i).next(o=>(t.forEach(c=>{o=o.insert(c.key,c)}),o))}}class Yl{constructor(e,t,n,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new Se(ae),this.rs=new Et(o=>Dt(o),Yr),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ia(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function _c(r,e){return da.apply(this,arguments)}function da(){return(da=(0,E.A)(function*(r,e){const t=W(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(o=>(i=o,t._s(e),t.mutationQueue.getAllMutationBatches(n))).next(o=>{const c=[],d=[];let f=ue();for(const m of i){c.push(m.batchId);for(const y of m.mutations)f=f.add(y.key)}for(const m of o){d.push(m.batchId);for(const y of m.mutations)f=f.add(y.key)}return t.localDocuments.getDocuments(n,f).next(m=>({us:m,removedBatchIds:c,addedBatchIds:d}))})})})).apply(this,arguments)}function Ic(r){const e=W(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function Zl(r,e){const t=W(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function _n(r,e,t){return _i.apply(this,arguments)}function _i(){return(_i=(0,E.A)(function*(r,e,t){const n=W(r),i=n.ns.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",o,c=>n.persistence.referenceDelegate.removeTarget(c,i)))}catch(c){if(!Xt(c))throw c;b("LocalStore",`Failed to update sequence numbers for target ${e}: ${c}`)}n.ns=n.ns.remove(e),n.rs.delete(i.target)})).apply(this,arguments)}function ks(r,e,t){const n=W(r);let i=te.min(),o=ue();return n.persistence.runTransaction("Execute query","readwrite",c=>function(f,m,y){const T=W(f),w=T.rs.get(y);return void 0!==w?N.resolve(T.ns.get(w)):T.Qr.getTargetData(m,y)}(n,c,Ye(e)).next(d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,n.Qr.getMatchingKeysForTargetId(c,d.targetId).next(f=>{o=f})}).next(()=>n.ts.getDocumentsMatchingQuery(c,e,t?i:te.min(),t?o:ue())).next(d=>(function fa(r,e,t){let n=r.ss.get(e)||te.min();t.forEach((i,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)}),r.ss.set(e,n)}(n,function Zr(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(e),d),{documents:d,hs:o})))}class ga{constructor(){this.activeTargetIds=function ko(){return Vo}()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class wc{constructor(){this.no=new ga,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new ga,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Rc{io(e){}shutdown(){}}class Pc{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){b("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){b("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ms=null;function ya(){return null===Ms?Ms=268435456+Math.round(2147483648*Math.random()):Ms++,"0x"+Ms.toString(16)}const l={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class s{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}const a="WebChannelConnection";class h extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.wo=n+"://"+t.host,this.So=`projects/${i}/databases/${o}`,this.bo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${o}`}get Do(){return!1}Co(t,n,i,o,c){const d=ya(),f=this.vo(t,n.toUriEncodedString());b("RestConnection",`Sending RPC '${t}' ${d}:`,f,i);const m={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(m,o,c),this.Mo(t,f,m,i).then(y=>(b("RestConnection",`Received RPC '${t}' ${d}: `,y),y),y=>{throw Le("RestConnection",`RPC '${t}' ${d} failed with error: `,y,"url: ",f,"request:",i),y})}xo(t,n,i,o,c,d){return this.Co(t,n,i,o,c)}Fo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+_e,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((o,c)=>t[c]=o),i&&i.headers.forEach((o,c)=>t[c]=o)}vo(t,n){return`${this.wo}/v1/${n}:${l[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,i){const o=ya();return new Promise((c,d)=>{const f=new ki;f.setWithCredentials(!0),f.listenOnce(Di.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case Pn.NO_ERROR:const y=f.getResponseJson();b(a,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(y)),c(y);break;case Pn.TIMEOUT:b(a,`RPC '${e}' ${o} timed out`),d(new G(F.DEADLINE_EXCEEDED,"Request time out"));break;case Pn.HTTP_ERROR:const T=f.getStatus();if(b(a,`RPC '${e}' ${o} failed with status:`,T,"response text:",f.getResponseText()),T>0){let w=f.getResponseJson();Array.isArray(w)&&(w=w[0]);const O=null==w?void 0:w.error;if(O&&O.status&&O.message){const B=function(j){const ee=j.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(ee)>=0?ee:F.UNKNOWN}(O.status);d(new G(B,O.message))}else d(new G(F.UNKNOWN,"Server responded with status "+f.getStatus()))}else d(new G(F.UNAVAILABLE,"Connection failed."));break;default:J()}}finally{b(a,`RPC '${e}' ${o} completed.`)}});const m=JSON.stringify(i);b(a,`RPC '${e}' ${o} sending request:`,i),f.send(t,"POST",m,n,15)})}Oo(e,t,n){const i=ya(),o=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=bn(),d=Ni(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;void 0!==m&&(f.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(f.xmlHttpFactory=new Fr({})),this.Fo(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;const y=o.join("");b(a,`Creating RPC '${e}' stream ${i}: ${y}`,f);const T=c.createWebChannel(y,f);let w=!1,O=!1;const B=new s({lo:j=>{O?b(a,`Not sending because RPC '${e}' stream ${i} is closed:`,j):(w||(b(a,`Opening RPC '${e}' stream ${i} transport.`),T.open(),w=!0),b(a,`RPC '${e}' stream ${i} sending:`,j),T.send(j))},ho:()=>T.close()}),z=(j,ee,ie)=>{j.listen(ee,ne=>{try{ie(ne)}catch(le){setTimeout(()=>{throw le},0)}})};return z(T,Rn.EventType.OPEN,()=>{O||(b(a,`RPC '${e}' stream ${i} transport opened.`),B.mo())}),z(T,Rn.EventType.CLOSE,()=>{O||(O=!0,b(a,`RPC '${e}' stream ${i} transport closed`),B.po())}),z(T,Rn.EventType.ERROR,j=>{O||(O=!0,Le(a,`RPC '${e}' stream ${i} transport errored:`,j),B.po(new G(F.UNAVAILABLE,"The operation could not be completed")))}),z(T,Rn.EventType.MESSAGE,j=>{var ee;if(!O){const ie=j.data[0];Z(!!ie);const le=ie.error||(null===(ee=ie[0])||void 0===ee?void 0:ee.error);if(le){b(a,`RPC '${e}' stream ${i} received error:`,le);const ve=le.status;let de=function(S){const x=ze[S];if(void 0!==x)return Pl(x)}(ve),C=le.message;void 0===de&&(de=F.INTERNAL,C="Unknown error status: "+ve+" with message "+le.message),O=!0,B.po(new G(de,C)),T.close()}else b(a,`RPC '${e}' stream ${i} received:`,ie),B.yo(ie)}}),z(d,Sn.STAT_EVENT,j=>{j.stat===oo.PROXY?b(a,`RPC '${e}' stream ${i} detected buffering proxy`):j.stat===oo.NOPROXY&&b(a,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{B.fo()},0),B}}function I(){return typeof document<"u"?document:null}function P(r){return new Vl(r,!0)}class M{constructor(e,t,n=1e3,i=1.5,o=6e4){this.oi=e,this.timerId=t,this.No=n,this.Lo=i,this.Bo=o,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-n);i>0&&b("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class q{constructor(e,t,n,i,o,c,d,f){this.oi=e,this.Go=n,this.zo=i,this.connection=o,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=d,this.listener=f,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new M(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}stop(){var e=this;return(0,E.A)(function*(){e.Zo()&&(yield e.close(0))})()}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){var e=this;return(0,E.A)(function*(){if(e.Xo())return e.close(0)})()}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){var n=this;return(0,E.A)(function*(){n.s_(),n.o_(),n.Yo.cancel(),n.jo++,4!==e?n.Yo.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),n.Yo.Ko()):t&&t.code===F.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.__(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Ao(t)})()}__(){}auth(){this.state=1;const e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.jo===t&&this.u_(n,i)},n=>{e(()=>{const i=new G(F.UNKNOWN,"Fetching auth token failed: "+n.message);return this.c_(i)})})}u_(e,t){const n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{n(()=>this.c_(i))}),this.stream.onMessage(i=>{n(()=>this.onMessage(i))})}e_(){var e=this;this.state=5,this.Yo.$o((0,E.A)(function*(){e.state=0,e.start()}))}c_(e){return b("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(b("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Y extends q{constructor(e,t,n,i,o,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,c),this.serializer=o}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();const t=function Dl(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(m=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===m?1:"REMOVE"===m?2:"CURRENT"===m?3:"RESET"===m?4:J(),i=e.targetChange.targetIds||[],o=function(m,y){return m.useProto3Json?(Z(void 0===y||"string"==typeof y),He.fromBase64String(y||"")):(Z(void 0===y||y instanceof Buffer||y instanceof Uint8Array),He.fromUint8Array(y||new Uint8Array))}(r,e.targetChange.resumeToken),c=e.targetChange.cause,d=c&&function(m){const y=void 0===m.code?F.UNKNOWN:Pl(m.code);return new G(y,m.message||"")}(c);t=new ls(n,i,o,d||null)}else if("documentChange"in e){const n=e.documentChange,i=At(r,n.document.name),o=Fe(n.document.updateTime),c=n.document.createTime?Fe(n.document.createTime):te.min(),d=new Ue({mapValue:{fields:n.document.fields}}),f=Re.newFoundDocument(i,o,c,d);t=new Bo(n.targetIds||[],n.removedTargetIds||[],f.key,f)}else if("documentDelete"in e){const n=e.documentDelete,i=At(r,n.document),o=n.readTime?Fe(n.readTime):te.min(),c=Re.newNoDocument(i,o);t=new Bo([],n.removedTargetIds||[],c.key,c)}else if("documentRemove"in e){const n=e.documentRemove,i=At(r,n.document);t=new Bo([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return J();{const n=e.filter,{count:i=0,unchangedNames:o}=n,c=new Rl(i,o);t=new bl(n.targetId,c)}}var m;return t}(this.serializer,e),n=function(o){if(!("targetChange"in o))return te.min();const c=o.targetChange;return c.targetIds&&c.targetIds.length?te.min():c.readTime?Fe(c.readTime):te.min()}(e);return this.listener.h_(t,n)}P_(e){const t={};t.database=zo(this.serializer),t.addTarget=function(o,c){let d;const f=c.target;if(d=Xr(f)?{documents:Ku(o,f)}:{query:ps(o,f)._t},d.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){d.resumeToken=qu(o,c.resumeToken);const m=ii(o,c.expectedCount);null!==m&&(d.expectedCount=m)}else if(c.snapshotVersion.compareTo(te.min())>0){d.readTime=cn(o,c.snapshotVersion.toTimestamp());const m=ii(o,c.expectedCount);null!==m&&(d.expectedCount=m)}return d}(this.serializer,e);const n=function ms(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return J()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.i_(t)}I_(e){const t={};t.database=zo(this.serializer),t.removeTarget=e,this.i_(t)}}class re extends q{constructor(e,t,n,i,o,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,c),this.serializer=o,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(Z(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const t=function Wo(r,e){return r&&r.length>0?(Z(void 0!==e),r.map(t=>function(i,o){let c=Fe(i.updateTime?i.updateTime:o);return c.isEqual(te.min())&&(c=Fe(o)),new wl(c,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Fe(e.commitTime);return this.listener.A_(n,t)}return Z(!e.writeResults||0===e.writeResults.length),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=zo(this.serializer),this.i_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function Un(r,e){let t;if(e instanceof on)t={update:wr(r,e.key,e.value)};else if(e instanceof Fn)t={delete:ds(r,e.key)};else if(e instanceof Ht)t={update:wr(r,e.key,e.data),updateMask:Ol(e.fieldMask)};else{if(!(e instanceof ni))return J();t={verify:ds(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(o,c){const d=c.transform;if(d instanceof Tr)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Wt)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof $t)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Er)return{fieldPath:c.field.canonicalString(),increment:d.Pe};throw J()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(o=e.precondition).updateTime?{updateTime:hs(r,o.updateTime)}:void 0!==o.exists?{exists:o.exists}:J()),t;var o}(this.serializer,n))};this.i_(t)}}class fe extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new G(F.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Co(e,jo(t,n),i,o,c)).catch(o=>{throw"FirebaseError"===o.name?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new G(F.UNKNOWN,o.toString())})}xo(e,t,n,i,o){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,d])=>this.connection.xo(e,jo(t,n),i,c,d,o)).catch(c=>{throw"FirebaseError"===c.name?(c.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new G(F.UNKNOWN,c.toString())})}terminate(){this.m_=!0,this.connection.terminate()}}class ut{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(ye(t),this.y_=!1):b("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class yn{constructor(e,t,n,i,o){var c=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=o,this.O_.io(d=>{n.enqueueAndForget((0,E.A)(function*(){var f;En(c)&&(b("RemoteStore","Restarting streams for network reachability change."),yield(f=(0,E.A)(function*(y){const T=W(y);T.M_.add(4),yield vn(T),T.N_.set("Unknown"),T.M_.delete(4),yield In(T)}),function m(y){return f.apply(this,arguments)})(c))}))}),this.N_=new ut(n,i)}}function In(r){return Ls.apply(this,arguments)}function Ls(){return(Ls=(0,E.A)(function*(r){if(En(r))for(const e of r.x_)yield e(!0)})).apply(this,arguments)}function vn(r){return Fs.apply(this,arguments)}function Fs(){return(Fs=(0,E.A)(function*(r){for(const e of r.x_)yield e(!1)})).apply(this,arguments)}function vi(r,e){const t=W(r);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),Bs(t)?Ti(t):js(t).Xo()&&Us(t,e))}function Tn(r,e){const t=W(r),n=js(t);t.F_.delete(e),n.Xo()&&Ia(t,e),0===t.F_.size&&(n.Xo()?n.n_():En(t)&&t.N_.set("Unknown"))}function Us(r,e){if(r.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(te.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}js(r).P_(e)}function Ia(r,e){r.L_.xe(e),js(r).I_(e)}function Ti(r){r.L_=new qo({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.F_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),js(r).start(),r.N_.w_()}function Bs(r){return En(r)&&!js(r).Zo()&&r.F_.size>0}function En(r){return 0===W(r).M_.size}function qs(r){r.L_=void 0}function th(r){return nh.apply(this,arguments)}function nh(){return(nh=(0,E.A)(function*(r){r.N_.set("Online")})).apply(this,arguments)}function $p(r){return rh.apply(this,arguments)}function rh(){return(rh=(0,E.A)(function*(r){r.F_.forEach((e,t)=>{Us(r,e)})})).apply(this,arguments)}function Hp(r,e){return ih.apply(this,arguments)}function ih(){return(ih=(0,E.A)(function*(r,e){qs(r),Bs(r)?(r.N_.D_(e),Ti(r)):r.N_.set("Unknown")})).apply(this,arguments)}function Qp(r,e,t){return sh.apply(this,arguments)}function sh(){return sh=(0,E.A)(function*(r,e,t){if(r.N_.set("Online"),e instanceof ls&&2===e.state&&e.cause)try{yield(n=(0,E.A)(function*(o,c){const d=c.cause;for(const f of c.targetIds)o.F_.has(f)&&(yield o.remoteSyncer.rejectListen(f,d),o.F_.delete(f),o.L_.removeTarget(f))}),function i(o,c){return n.apply(this,arguments)})(r,e)}catch(n){b("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Sc(r,n)}else if(e instanceof Bo?r.L_.Ke(e):e instanceof bl?r.L_.He(e):r.L_.We(e),!t.isEqual(te.min()))try{const n=yield Ic(r.localStore);t.compareTo(n)>=0&&(yield function(o,c){const d=o.L_.rt(c);return d.targetChanges.forEach((f,m)=>{if(f.resumeToken.approximateByteSize()>0){const y=o.F_.get(m);y&&o.F_.set(m,y.withResumeToken(f.resumeToken,c))}}),d.targetMismatches.forEach((f,m)=>{const y=o.F_.get(f);if(!y)return;o.F_.set(f,y.withResumeToken(He.EMPTY_BYTE_STRING,y.snapshotVersion)),Ia(o,f);const T=new Ot(y.target,f,m,y.sequenceNumber);Us(o,T)}),o.remoteSyncer.applyRemoteEvent(d)}(r,t))}catch(n){b("RemoteStore","Failed to raise snapshot:",n),yield Sc(r,n)}var n}),sh.apply(this,arguments)}function Sc(r,e,t){return oh.apply(this,arguments)}function oh(){return(oh=(0,E.A)(function*(r,e,t){if(!Xt(e))throw e;r.M_.add(1),yield vn(r),r.N_.set("Offline"),t||(t=()=>Ic(r.localStore)),r.asyncQueue.enqueueRetryable((0,E.A)(function*(){b("RemoteStore","Retrying IndexedDB access"),yield t(),r.M_.delete(1),yield In(r)}))})).apply(this,arguments)}function Wd(r,e){return e().catch(t=>Sc(r,t,e))}function Gs(r){return ah.apply(this,arguments)}function ah(){return(ah=(0,E.A)(function*(r){const e=W(r),t=Cr(e);let n=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;Jp(e);)try{const i=yield Zl(e.localStore,n);if(null===i){0===e.v_.length&&t.n_();break}n=i.batchId,Yp(e,i)}catch(i){yield Sc(e,i)}$d(e)&&Hd(e)})).apply(this,arguments)}function Jp(r){return En(r)&&r.v_.length<10}function Yp(r,e){r.v_.push(e);const t=Cr(r);t.Xo()&&t.E_&&t.d_(e.mutations)}function $d(r){return En(r)&&!Cr(r).Zo()&&r.v_.length>0}function Hd(r){Cr(r).start()}function Xp(r){return uh.apply(this,arguments)}function uh(){return(uh=(0,E.A)(function*(r){Cr(r).V_()})).apply(this,arguments)}function Zp(r){return ch.apply(this,arguments)}function ch(){return(ch=(0,E.A)(function*(r){const e=Cr(r);for(const t of r.v_)e.d_(t.mutations)})).apply(this,arguments)}function em(r,e,t){return lh.apply(this,arguments)}function lh(){return(lh=(0,E.A)(function*(r,e,t){const n=r.v_.shift(),i=an.from(n,e,t);yield Wd(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Gs(r)})).apply(this,arguments)}function tm(r,e){return hh.apply(this,arguments)}function hh(){return hh=(0,E.A)(function*(r,e){var t;e&&Cr(r).E_&&(yield(t=(0,E.A)(function*(i,o){if(function Ou(r){switch(r){default:return J();case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0}}(d=o.code)&&d!==F.ABORTED){const c=i.v_.shift();Cr(i).t_(),yield Wd(i,()=>i.remoteSyncer.rejectFailedWrite(c.batchId,o)),yield Gs(i)}var d}),function n(i,o){return t.apply(this,arguments)})(r,e)),$d(r)&&Hd(r)}),hh.apply(this,arguments)}function Qd(r,e){return dh.apply(this,arguments)}function dh(){return(dh=(0,E.A)(function*(r,e){const t=W(r);t.asyncQueue.verifyOperationInProgress(),b("RemoteStore","RemoteStore received new credentials");const n=En(t);t.M_.add(3),yield vn(t),n&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield In(t)})).apply(this,arguments)}function fh(r,e){return ph.apply(this,arguments)}function ph(){return(ph=(0,E.A)(function*(r,e){const t=W(r);e?(t.M_.delete(2),yield In(t)):e||(t.M_.add(2),yield vn(t),t.N_.set("Unknown"))})).apply(this,arguments)}function js(r){return r.B_||(r.B_=function(t,n,i){const o=W(t);return o.f_(),new Y(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(r.datastore,r.asyncQueue,{Po:th.bind(null,r),To:$p.bind(null,r),Ao:Hp.bind(null,r),h_:Qp.bind(null,r)}),r.x_.push(function(){var e=(0,E.A)(function*(t){t?(r.B_.t_(),Bs(r)?Ti(r):r.N_.set("Unknown")):(yield r.B_.stop(),qs(r))});return function(t){return e.apply(this,arguments)}}())),r.B_}function Cr(r){return r.k_||(r.k_=function(t,n,i){const o=W(t);return o.f_(),new re(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(r.datastore,r.asyncQueue,{Po:()=>Promise.resolve(),To:Xp.bind(null,r),Ao:tm.bind(null,r),R_:Zp.bind(null,r),A_:em.bind(null,r)}),r.x_.push(function(){var e=(0,E.A)(function*(t){t?(r.k_.t_(),yield Gs(r)):(yield r.k_.stop(),r.v_.length>0&&(b("RemoteStore",`Stopping write stream with ${r.v_.length} pending writes`),r.v_=[]))});return function(t){return e.apply(this,arguments)}}())),r.k_}class mh{constructor(e,t,n,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=o,this.deferred=new qe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(c=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,o){const c=Date.now()+n,d=new mh(e,t,c,i,o);return d.start(n),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new G(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zs(r,e){if(ye("AsyncQueue",`${e}: ${r}`),Xt(r))return new G(F.UNAVAILABLE,`${e}: ${r}`);throw r}class Ks{constructor(e){this.comparator=e?(t,n)=>e(t,n)||H.comparator(t.key,n.key):(t,n)=>H.comparator(t.key,n.key),this.keyedMap=Mn(),this.sortedSet=new Se(this.comparator)}static emptySet(e){return new Ks(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ks)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=n.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ks;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Jd{constructor(){this.q_=new Se(H.comparator)}track(e){const t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):J():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Ws{constructor(e,t,n,i,o,c,d,f,m){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=o,this.fromCache=c,this.syncStateChanged=d,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,t,n,i,o){const c=[];return t.forEach(d=>{c.push({type:0,doc:d})}),new Ws(e,t,Ks.emptySet(t),c,n,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ir(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class nm{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class rm{constructor(){this.queries=new Et(e=>Yi(e),Ir),this.onlineState="Unknown",this.z_=new Set}}function gh(r,e){return _h.apply(this,arguments)}function _h(){return(_h=(0,E.A)(function*(r,e){const t=W(r);let n=3;const i=e.query;let o=t.queries.get(i);o?!o.W_()&&e.G_()&&(n=2):(o=new nm,n=e.G_()?0:1);try{switch(n){case 0:o.K_=yield t.onListen(i,!0);break;case 1:o.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(c){const d=zs(c,`Initialization of query '${Nn(e.query)}' failed`);return void e.onError(d)}t.queries.set(i,o),o.U_.push(e),e.j_(t.onlineState),o.K_&&e.H_(o.K_)&&vh(t)})).apply(this,arguments)}function yh(r,e){return Ih.apply(this,arguments)}function Ih(){return(Ih=(0,E.A)(function*(r,e){const t=W(r),n=e.query;let i=3;const o=t.queries.get(n);if(o){const c=o.U_.indexOf(e);c>=0&&(o.U_.splice(c,1),0===o.U_.length?i=e.G_()?0:1:!o.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function im(r,e){const t=W(r);let n=!1;for(const i of e){const c=t.queries.get(i.query);if(c){for(const d of c.U_)d.H_(i)&&(n=!0);c.K_=i}}n&&vh(t)}function sm(r,e,t){const n=W(r),i=n.queries.get(e);if(i)for(const o of i.U_)o.onError(t);n.queries.delete(e)}function vh(r){r.z_.forEach(e=>{e.next()})}var Th,Yd;(Yd=Th||(Th={})).J_="default",Yd.Cache="cache";class Eh{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new Ws(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){return!e.fromCache||!this.G_()||(!this.options.ra||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}na(e){e=Ws.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==Th.Cache}}class ef{constructor(e){this.key=e}}class tf{constructor(e){this.key=e}}class nf{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=ue(),this.mutatedKeys=ue(),this.Ia=Xi(e),this.Ta=new Ks(this.Ia)}get Ea(){return this.la}da(e,t){const n=t?t.Aa:new Jd,i=t?t.Ta:this.Ta;let o=t?t.mutatedKeys:this.mutatedKeys,c=i,d=!1;const f="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,m="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((y,T)=>{const w=i.get(y),O=On(this.query,T)?T:null,B=!!w&&this.mutatedKeys.has(w.key),z=!!O&&(O.hasLocalMutations||this.mutatedKeys.has(O.key)&&O.hasCommittedMutations);let j=!1;w&&O?w.data.isEqual(O.data)?B!==z&&(n.track({type:3,doc:O}),j=!0):this.Ra(w,O)||(n.track({type:2,doc:O}),j=!0,(f&&this.Ia(O,f)>0||m&&this.Ia(O,m)<0)&&(d=!0)):!w&&O?(n.track({type:0,doc:O}),j=!0):w&&!O&&(n.track({type:1,doc:w}),j=!0,(f||m)&&(d=!0)),j&&(O?(c=c.add(O),o=z?o.add(y):o.delete(y)):(c=c.delete(y),o=o.delete(y)))}),null!==this.query.limit)for(;c.size>this.query.limit;){const y="F"===this.query.limitType?c.last():c.first();c=c.delete(y.key),o=o.delete(y.key),n.track({type:1,doc:y})}return{Ta:c,Aa:n,Xi:d,mutatedKeys:o}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const o=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const c=e.Aa.Q_();c.sort((y,T)=>function(O,B){const z=j=>{switch(j){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return J()}};return z(O)-z(B)}(y.type,T.type)||this.Ia(y.doc,T.doc)),this.Va(n),i=null!=i&&i;const d=t&&!i?this.ma():[],f=0===this.Pa.size&&this.current&&!i?1:0,m=f!==this.ha;return this.ha=f,0!==c.length||m?{snapshot:new Ws(this.query,e.Ta,o,c,e.mutatedKeys,0===f,m,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:d}:{fa:d}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Jd,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=ue(),this.Ta.forEach(n=>{this.ga(n.key)&&(this.Pa=this.Pa.add(n.key))});const t=[];return e.forEach(n=>{this.Pa.has(n)||t.push(new tf(n))}),this.Pa.forEach(n=>{e.has(n)||t.push(new ef(n))}),t}pa(e){this.la=e.hs,this.Pa=ue();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Ws.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class um{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class cm{constructor(e){this.key=e,this.wa=!1}}class lm{constructor(e,t,n,i,o,c){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=c,this.Sa={},this.ba=new Et(d=>Yi(d),Ir),this.Da=new Map,this.Ca=new Set,this.va=new Se(H.comparator),this.Fa=new Map,this.Ma=new mi,this.xa={},this.Oa=new Map,this.Na=Wn.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}function hm(r,e){return Ah.apply(this,arguments)}function Ah(){return(Ah=(0,E.A)(function*(r,e,t=!0){const n=bc(r);let i;const o=n.ba.get(e);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.ya()):i=yield rf(n,e,t,!0),i})).apply(this,arguments)}function dm(r,e){return wh.apply(this,arguments)}function wh(){return(wh=(0,E.A)(function*(r,e){const t=bc(r);yield rf(t,e,!0,!1)})).apply(this,arguments)}function rf(r,e,t,n){return Rh.apply(this,arguments)}function Rh(){return(Rh=(0,E.A)(function*(r,e,t,n){const i=yield function Pr(r,e){const t=W(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Qr.getTargetData(n,e).next(o=>o?(i=o,N.resolve(i)):t.Qr.allocateTargetId(n).next(c=>(i=new Ot(e,c,"TargetPurposeListen",n.currentSequenceNumber),t.Qr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.ns.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(n.targetId,n),t.rs.set(e,n.targetId)),n})}(r.localStore,Ye(e)),o=i.targetId,c=t?r.sharedClientState.addLocalQueryTarget(o):"not-current";let d;return n&&(d=yield function Ph(r,e,t,n,i){return Sh.apply(this,arguments)}(r,e,o,"current"===c,i.resumeToken)),r.isPrimaryClient&&t&&vi(r.remoteStore,i),d})).apply(this,arguments)}function Sh(){return Sh=(0,E.A)(function*(r,e,t,n,i){r.Ba=(T,w,O)=>{return(B=(0,E.A)(function*(j,ee,ie,ne){let le=ee.view.da(ie);le.Xi&&(le=yield ks(j.localStore,ee.query,!1).then(({documents:A})=>ee.view.da(A,le)));const ve=ne&&ne.targetChanges.get(ee.targetId),de=ne&&null!=ne.targetMismatches.get(ee.targetId),C=ee.view.applyChanges(le,j.isPrimaryClient,ve,de);return Fh(j,ee.targetId,C.fa),C.snapshot}),function z(j,ee,ie,ne){return B.apply(this,arguments)})(r,T,w,O);var B};const o=yield ks(r.localStore,e,!0),c=new nf(e,o.hs),d=c.da(o.documents),f=ri.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),m=c.applyChanges(d,r.isPrimaryClient,f);Fh(r,t,m.fa);const y=new um(e,t,c);return r.ba.set(e,y),r.Da.has(t)?r.Da.get(t).push(e):r.Da.set(t,[e]),m.snapshot}),Sh.apply(this,arguments)}function fm(r,e,t){return bh.apply(this,arguments)}function bh(){return(bh=(0,E.A)(function*(r,e,t){const n=W(r),i=n.ba.get(e),o=n.Da.get(i.targetId);if(o.length>1)return n.Da.set(i.targetId,o.filter(c=>!Ir(c,e))),void n.ba.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield _n(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Tn(n.remoteStore,i.targetId),$s(n,i.targetId)}).catch(St))):($s(n,i.targetId),yield _n(n.localStore,i.targetId,!0))})).apply(this,arguments)}function pm(r,e){return Ch.apply(this,arguments)}function Ch(){return(Ch=(0,E.A)(function*(r,e){const t=W(r),n=t.ba.get(e),i=t.Da.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Tn(t.remoteStore,n.targetId))})).apply(this,arguments)}function xh(){return(xh=(0,E.A)(function*(r,e,t){const n=function Qh(r){const e=W(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_m.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ym.bind(null,e),e}(r);try{const i=yield function(c,d){const f=W(c),m=De.now(),y=d.reduce((O,B)=>O.add(B.key),ue());let T,w;return f.persistence.runTransaction("Locally write mutations","readwrite",O=>{let B=tt(),z=ue();return f.os.getEntries(O,y).next(j=>{B=j,B.forEach((ee,ie)=>{ie.isValidDocument()||(z=z.add(ee))})}).next(()=>f.localDocuments.getOverlayedDocuments(O,B)).next(j=>{T=j;const ee=[];for(const ie of d){const ne=Mo(ie,T.get(ie.key).overlayedDocument);null!=ne&&ee.push(new Ht(ie.key,ne,kt(ne.value.mapValue),be.exists(!0)))}return f.mutationQueue.addMutationBatch(O,m,ee,d)}).next(j=>{w=j;const ee=j.applyToLocalDocumentSet(T,z);return f.documentOverlayCache.saveOverlays(O,j.batchId,ee)})}).then(()=>({batchId:w.batchId,changes:wu(T)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(c,d,f){let m=c.xa[c.currentUser.toKey()];m||(m=new Se(ae)),m=m.insert(d,f),c.xa[c.currentUser.toKey()]=m}(n,i.batchId,t),yield Jn(n,i.changes),yield Gs(n.remoteStore)}catch(i){const o=zs(i,"Failed to persist write");t.reject(o)}})).apply(this,arguments)}function sf(r,e){return Vh.apply(this,arguments)}function Vh(){return(Vh=(0,E.A)(function*(r,e){const t=W(r);try{const n=yield function Xl(r,e){const t=W(r),n=e.snapshotVersion;let i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const c=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;const d=[];e.targetChanges.forEach((y,T)=>{const w=i.get(T);if(!w)return;d.push(t.Qr.removeMatchingKeys(o,y.removedDocuments,T).next(()=>t.Qr.addMatchingKeys(o,y.addedDocuments,T)));let O=w.withSequenceNumber(o.currentSequenceNumber);var z,j,ee;null!==e.targetMismatches.get(T)?O=O.withResumeToken(He.EMPTY_BYTE_STRING,te.min()).withLastLimboFreeSnapshotVersion(te.min()):y.resumeToken.approximateByteSize()>0&&(O=O.withResumeToken(y.resumeToken,n)),i=i.insert(T,O),j=O,ee=y,(0===(z=w).resumeToken.approximateByteSize()||j.snapshotVersion.toMicroseconds()-z.snapshotVersion.toMicroseconds()>=3e8||ee.addedDocuments.size+ee.modifiedDocuments.size+ee.removedDocuments.size>0)&&d.push(t.Qr.updateTargetData(o,O))});let f=tt(),m=ue();if(e.documentUpdates.forEach(y=>{e.resolvedLimboDocuments.has(y)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(o,y))}),d.push(function vc(r,e,t){let n=ue(),i=ue();return t.forEach(o=>n=n.add(o)),e.getEntries(r,n).next(o=>{let c=tt();return t.forEach((d,f)=>{const m=o.get(d);f.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(d)),f.isNoDocument()&&f.version.isEqual(te.min())?(e.removeEntry(d,f.readTime),c=c.insert(d,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||0===f.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(f),c=c.insert(d,f)):b("LocalStore","Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",f.version)}),{cs:c,ls:i}})}(o,c,e.documentUpdates).next(y=>{f=y.cs,m=y.ls})),!n.isEqual(te.min())){const y=t.Qr.getLastRemoteSnapshotVersion(o).next(T=>t.Qr.setTargetsMetadata(o,o.currentSequenceNumber,n));d.push(y)}return N.waitFor(d).next(()=>c.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,f,m)).next(()=>f)}).then(o=>(t.ns=i,o))}(t.localStore,e);e.targetChanges.forEach((i,o)=>{const c=t.Fa.get(o);c&&(Z(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?c.wa=!0:i.modifiedDocuments.size>0?Z(c.wa):i.removedDocuments.size>0&&(Z(c.wa),c.wa=!1))}),yield Jn(t,n,e)}catch(n){yield St(n)}})).apply(this,arguments)}function of(r,e,t){const n=W(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.ba.forEach((o,c)=>{const d=c.view.j_(e);d.snapshot&&i.push(d.snapshot)}),function(c,d){const f=W(c);f.onlineState=d;let m=!1;f.queries.forEach((y,T)=>{for(const w of T.U_)w.j_(d)&&(m=!0)}),m&&vh(f)}(n.eventManager,e),i.length&&n.Sa.h_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function gm(r,e,t){return kh.apply(this,arguments)}function kh(){return(kh=(0,E.A)(function*(r,e,t){const n=W(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Fa.get(e),o=i&&i.key;if(o){let c=new Se(H.comparator);c=c.insert(o,Re.newNoDocument(o,te.min()));const d=ue().add(o),f=new cs(te.min(),new Map,new Se(ae),c,d);yield sf(n,f),n.va=n.va.remove(o),n.Fa.delete(e),Uh(n)}else yield _n(n.localStore,e,!1).then(()=>$s(n,e,t)).catch(St)})).apply(this,arguments)}function _m(r,e){return Dh.apply(this,arguments)}function Dh(){return(Dh=(0,E.A)(function*(r,e){const t=W(r),n=e.batch.batchId;try{const i=yield function yc(r,e){const t=W(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),o=t.os.newChangeBuffer({trackRemovals:!0});return function(d,f,m,y){const T=m.batch,w=T.keys();let O=N.resolve();return w.forEach(B=>{O=O.next(()=>y.getEntry(f,B)).next(z=>{const j=m.docVersions.get(B);Z(null!==j),z.version.compareTo(j)<0&&(T.applyToRemoteDocument(z,m),z.isValidDocument()&&(z.setReadTime(m.commitVersion),y.addEntry(z)))})}),O.next(()=>d.mutationQueue.removeMutationBatch(f,T))}(t,n,e,o).next(()=>o.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(d){let f=ue();for(let m=0;m<d.mutationResults.length;++m)d.mutationResults[m].transformResults.length>0&&(f=f.add(d.batch.mutations[m].key));return f}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);Lh(t,n,null),Mh(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Jn(t,i)}catch(i){yield St(i)}})).apply(this,arguments)}function ym(r,e,t){return Nh.apply(this,arguments)}function Nh(){return(Nh=(0,E.A)(function*(r,e,t){const n=W(r);try{const i=yield function(c,d){const f=W(c);return f.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let y;return f.mutationQueue.lookupMutationBatch(m,d).next(T=>(Z(null!==T),y=T.keys(),f.mutationQueue.removeMutationBatch(m,T))).next(()=>f.mutationQueue.performConsistencyCheck(m)).next(()=>f.documentOverlayCache.removeOverlaysForBatchId(m,y,d)).next(()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,y)).next(()=>f.localDocuments.getDocuments(m,y))})}(n.localStore,e);Lh(n,e,t),Mh(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Jn(n,i)}catch(i){yield St(i)}})).apply(this,arguments)}function Mh(r,e){(r.Oa.get(e)||[]).forEach(t=>{t.resolve()}),r.Oa.delete(e)}function Lh(r,e,t){const n=W(r);let i=n.xa[n.currentUser.toKey()];if(i){const o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),n.xa[n.currentUser.toKey()]=i}}function $s(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Da.get(e))r.ba.delete(n),t&&r.Sa.ka(n,t);r.Da.delete(e),r.isPrimaryClient&&r.Ma.Vr(e).forEach(n=>{r.Ma.containsKey(n)||af(r,n)})}function af(r,e){r.Ca.delete(e.path.canonicalString());const t=r.va.get(e);null!==t&&(Tn(r.remoteStore,t),r.va=r.va.remove(e),r.Fa.delete(t),Uh(r))}function Fh(r,e,t){for(const n of t)n instanceof ef?(r.Ma.addReference(n.key,e),vm(r,n)):n instanceof tf?(b("SyncEngine","Document no longer in limbo: "+n.key),r.Ma.removeReference(n.key,e),r.Ma.containsKey(n.key)||af(r,n.key)):J()}function vm(r,e){const t=e.key,n=t.path.canonicalString();r.va.get(t)||r.Ca.has(n)||(b("SyncEngine","New document in limbo: "+t),r.Ca.add(n),Uh(r))}function Uh(r){for(;r.Ca.size>0&&r.va.size<r.maxConcurrentLimboResolutions;){const e=r.Ca.values().next().value;r.Ca.delete(e);const t=new H(he.fromString(e)),n=r.Na.next();r.Fa.set(n,new cm(t)),r.va=r.va.insert(t,n),vi(r.remoteStore,new Ot(Ye(Kt(t.path)),n,"TargetPurposeLimboResolution",Ge.oe))}}function Jn(r,e,t){return Bh.apply(this,arguments)}function Bh(){return Bh=(0,E.A)(function*(r,e,t){const n=W(r),i=[],o=[],c=[];var d;n.ba.isEmpty()||(n.ba.forEach((d,f)=>{c.push(n.Ba(f,e,t).then(m=>{if((m||t)&&n.isPrimaryClient&&n.sharedClientState.updateQueryState(f.targetId,m&&!m.fromCache?"current":"not-current"),m){i.push(m);const y=la.Ki(f.targetId,m);o.push(y)}}))}),yield Promise.all(c),n.Sa.h_(i),yield(d=(0,E.A)(function*(m,y){const T=W(m);try{yield T.persistence.runTransaction("notifyLocalViewChanges","readwrite",w=>N.forEach(y,O=>N.forEach(O.qi,B=>T.persistence.referenceDelegate.addReference(w,O.targetId,B)).next(()=>N.forEach(O.Qi,B=>T.persistence.referenceDelegate.removeReference(w,O.targetId,B)))))}catch(w){if(!Xt(w))throw w;b("LocalStore","Failed to update sequence numbers: "+w)}for(const w of y){const O=w.targetId;if(!w.fromCache){const B=T.ns.get(O),j=B.withLastLimboFreeSnapshotVersion(B.snapshotVersion);T.ns=T.ns.insert(O,j)}}}),function f(m,y){return d.apply(this,arguments)})(n.localStore,o))}),Bh.apply(this,arguments)}function Tm(r,e){return qh.apply(this,arguments)}function qh(){return(qh=(0,E.A)(function*(r,e){const t=W(r);if(!t.currentUser.isEqual(e)){b("SyncEngine","User change. New user:",e.toKey());const n=yield _c(t.localStore,e);t.currentUser=e,(o=t).Oa.forEach(d=>{d.forEach(f=>{f.reject(new G(F.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.Oa.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Jn(t,n.us)}var o})).apply(this,arguments)}function Em(r,e){const t=W(r),n=t.Fa.get(e);if(n&&n.wa)return ue().add(n.key);{let i=ue();const o=t.Da.get(e);if(!o)return i;for(const c of o){const d=t.ba.get(c);i=i.unionWith(d.view.Ea)}return i}}function bc(r){const e=W(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=sf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Em.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gm.bind(null,e),e.Sa.h_=im.bind(null,e.eventManager),e.Sa.ka=sm.bind(null,e.eventManager),e}class Hs{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,E.A)(function*(){t.serializer=P(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function gc(r,e,t,n){return new Yl(r,e,t,n)}(this.persistence,new mc,e.initialUser,this.serializer)}createPersistence(e){return new oa(xs.Hr,this.serializer)}createSharedClientState(e){return new wc}terminate(){var e=this;return(0,E.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Qs{initialize(e,t){var n=this;return(0,E.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>of(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=Tm.bind(null,n.syncEngine),yield fh(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new rm}createDatastore(e){const t=P(e.databaseInfo.databaseId),n=new h(e.databaseInfo);return new fe(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,o=e.asyncQueue,c=t=>of(this.syncEngine,t,0),d=Pc.D()?new Pc:new Rc,new yn(n,i,o,c,d);var n,i,o,c,d}createSyncEngine(e,t){return function(i,o,c,d,f,m,y){const T=new lm(i,o,c,d,f,m);return y&&(T.La=!0),T}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,E.A)(function*(){var t,n;yield(n=(0,E.A)(function*(o){const c=W(o);b("RemoteStore","RemoteStore shutting down."),c.M_.add(5),yield vn(c),c.O_.shutdown(),c.N_.set("Unknown")}),function i(o){return n.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}class Cc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Om{constructor(e,t,n,i){var o=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=se.UNAUTHENTICATED,this.clientId=Ya.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var c=(0,E.A)(function*(d){b("FirestoreClient","Received user=",d.uid),yield o.authCredentialListener(d),o.user=d});return function(d){return c.apply(this,arguments)}}()),this.appCheckCredentials.start(n,c=>(b("FirestoreClient","Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new G(F.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new qe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,E.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=zs(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function xc(r,e){return Yh.apply(this,arguments)}function Yh(){return Yh=(0,E.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),b("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,E.A)(function*(o){n.isEqual(o)||(yield _c(e.localStore,o),n=o)});return function(o){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Yh.apply(this,arguments)}function Xh(r,e){return Zh.apply(this,arguments)}function Zh(){return(Zh=(0,E.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function ed(r){return td.apply(this,arguments)}(r);b("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Qd(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Qd(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function td(){return(td=(0,E.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){b("FirestoreClient","Using user provided OfflineComponentProvider");try{yield xc(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function df(r){return"FirebaseError"===r.name?r.code===F.FAILED_PRECONDITION||r.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}(t))throw t;Le("Error using user provided cache. Falling back to memory cache: "+t),yield xc(r,new Hs)}}else b("FirestoreClient","Using default OfflineComponentProvider"),yield xc(r,new Hs);return r._offlineComponents})).apply(this,arguments)}function Vc(r){return nd.apply(this,arguments)}function nd(){return(nd=(0,E.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(b("FirestoreClient","Using user provided OnlineComponentProvider"),yield Xh(r,r._uninitializedComponentsProvider._online)):(b("FirestoreClient","Using default OnlineComponentProvider"),yield Xh(r,new Qs))),r._onlineComponents})).apply(this,arguments)}function Ys(r){return id.apply(this,arguments)}function id(){return(id=(0,E.A)(function*(r){const e=yield Vc(r),t=e.eventManager;return t.onListen=hm.bind(null,e.syncEngine),t.onUnlisten=fm.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=dm.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=pm.bind(null,e.syncEngine),t})).apply(this,arguments)}function yf(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const If=new Map;function sd(r,e,t){if(!t)throw new G(F.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function vf(r){if(!H.isDocumentKey(r))throw new G(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Tf(r){if(H.isDocumentKey(r))throw new G(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function kc(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":J()}function me(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new G(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=kc(r);throw new G(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class Af{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new G(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new G(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function $m(r,e,t,n){if(!0===e&&!0===n)throw new G(F.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=yf(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(o){if(void 0!==o.timeoutSeconds){if(isNaN(o.timeoutSeconds))throw new G(F.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new G(F.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new G(F.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class va{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Af({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new G(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new G(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Af(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new ul;switch(n.type){case"firstParty":return new Ha(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new G(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=If.get(t);n&&(b("ComponentProvider","Removing Datastore"),If.delete(t),n.terminate())}(this),Promise.resolve()}}class st{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new st(this.firestore,e,this._query)}}class Qe{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new An(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Qe(this.firestore,e,this._key)}}class An extends st{constructor(e,t,n){super(e,t,Kt(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Qe(this.firestore,null,new H(e))}withConverter(e){return new An(this.firestore,e,this._path)}}function Qm(r,e,...t){if(r=(0,Ae.Ku)(r),sd("collection","path",e),r instanceof va){const n=he.fromString(e,...t);return Tf(n),new An(r,null,n)}{if(!(r instanceof Qe||r instanceof An))throw new G(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(he.fromString(e,...t));return Tf(n),new An(r.firestore,null,n)}}function wf(r,e,...t){if(r=(0,Ae.Ku)(r),1===arguments.length&&(e=Ya.newId()),sd("doc","path",e),r instanceof va){const n=he.fromString(e,...t);return vf(n),new Qe(r,null,new H(n))}{if(!(r instanceof Qe||r instanceof An))throw new G(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(he.fromString(e,...t));return vf(n),new Qe(r.firestore,r instanceof An?r.converter:null,new H(n))}}class Jm{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new M(this,"async_queue_retry"),this.hu=()=>{const t=I();t&&b("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};const e=I();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=I();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new qe;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){var e=this;return(0,E.A)(function*(){if(0!==e.su.length){try{yield e.su[0](),e.su.shift(),e.Yo.reset()}catch(t){if(!Xt(t))throw t;b("AsyncQueue","Operation failed with retryable error: "+t)}e.su.length>0&&e.Yo.$o(()=>e.Tu())}})()}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(n=>{throw this.au=n,this.uu=!1,ye("INTERNAL UNHANDLED ERROR: ",function(c){let d=c.message||"";return c.stack&&(d=c.stack.includes(c.message)?c.stack:c.message+"\n"+c.stack),d}(n)),n}).then(n=>(this.uu=!1,n))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const i=mh.createAndSchedule(this,e,t,n,o=>this.Eu(o));return this._u.push(i),i}Pu(){this.au&&J()}verifyOperationInProgress(){}du(){var e=this;return(0,E.A)(function*(){let t;do{t=e.iu,yield t}while(t!==e.iu)})()}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}class Ce extends va{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Jm,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Pf(this),this._firestoreClient.terminate()}}function Xm(r,e){const t="object"==typeof r?r:(0,oe.getApp)(),n="string"==typeof r?r:e||"(default)",i=(0,oe._getProvider)(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const o=(0,Ae.yU)("firestore");o&&function Hm(r,e,t,n={}){var i;const o=(r=me(r,va))._getSettings(),c=`${e}:${t}`;if("firestore.googleapis.com"!==o.host&&o.host!==c&&Le("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},o),{host:c,ssl:!1})),n.mockUserToken){let d,f;if("string"==typeof n.mockUserToken)d=n.mockUserToken,f=se.MOCK_USER;else{d=(0,Ae.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const m=n.mockUserToken.sub||n.mockUserToken.user_id;if(!m)throw new G(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new se(m)}r._authCredentials=new xe(new $a(d,f))}}(i,...o)}return i}function Be(r){return r._firestoreClient||Pf(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Pf(r){var e,t,n;const i=r._freezeSettings(),o=(f=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new pu(r._databaseId,f,r._persistenceKey,(y=i).host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,yf(y.experimentalLongPollingOptions),y.useFetchStreams));var f,y;r._firestoreClient=new Om(r._authCredentials,r._appCheckCredentials,r._queue,o),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Ei{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ei(He.fromBase64String(e))}catch(t){throw new G(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ei(He.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ai{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new G(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class wi{constructor(e){this._methodName=e}}class ad{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new G(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new G(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ae(this._lat,e._lat)||ae(this._long,e._long)}}const eg=/^__.*__$/;class tg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ht(e,this.data,this.fieldMask,t,this.fieldTransforms):new on(e,this.data,t,this.fieldTransforms)}}function xf(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw J()}}class Dc{constructor(e,t,n,i,o,c){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===o&&this.mu(),this.fieldTransforms=o||[],this.fieldMask=c||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new Dc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.wu(e),i}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return Mc(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(xf(this.fu)&&eg.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class ng{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||P(e)}Fu(e,t,n,i=!1){return new Dc({fu:e,methodName:t,vu:n,path:Pe.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ri(r){const e=r._freezeSettings(),t=P(r._databaseId);return new ng(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Nc(r,e,t,n,i,o={}){const c=r.Fu(o.merge||o.mergeFields?2:0,e,t,i);pd("Data must be an object, but it was:",c,n);const d=Df(n,c);let f,m;if(o.merge)f=new et(c.fieldMask),m=c.fieldTransforms;else if(o.mergeFields){const y=[];for(const T of o.mergeFields){const w=Aa(e,T,t);if(!c.contains(w))throw new G(F.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);Of(y,w)||y.push(w)}f=new et(y),m=c.fieldTransforms.filter(T=>f.covers(T.field))}else f=null,m=c.fieldTransforms;return new tg(new Ue(d),f,m)}class ud extends wi{_toFieldTransform(e){return new ei(e.path,new Tr)}isEqual(e){return e instanceof ud}}function Pi(r,e){if(Nf(r=(0,Ae.Ku)(r)))return pd("Unsupported field value:",e,r),Df(r,e);if(r instanceof wi)return function(n,i){if(!xf(i.fu))throw i.Du(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${n._methodName}() is not currently supported inside arrays`);const o=n._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(n,i){const o=[];let c=0;for(const d of n){let f=Pi(d,i.bu(c));null==f&&(f={nullValue:"NULL_VALUE"}),o.push(f),c++}return{arrayValue:{values:o}}}(r,e)}return function(n,i){if(null===(n=(0,Ae.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return ts(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const o=De.fromDate(n);return{timestampValue:cn(i.serializer,o)}}if(n instanceof De){const o=new De(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:cn(i.serializer,o)}}if(n instanceof ad)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ei)return{bytesValue:qu(i.serializer,n._byteString)};if(n instanceof Qe){const o=i.databaseId,c=n.firestore._databaseId;if(!c.isEqual(o))throw i.Du(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Go(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Du(`Unsupported field value: ${kc(n)}`)}(r,e)}function Df(r,e){const t={};return Eo(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zt(r,(n,i)=>{const o=Pi(i,e.pu(n));null!=o&&(t[n]=o)}),{mapValue:{fields:t}}}function Nf(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof De||r instanceof ad||r instanceof Ei||r instanceof Qe||r instanceof wi)}function pd(r,e,t){if(!Nf(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=kc(t);throw e.Du("an object"===n?r+" a custom object":r+" "+n)}var i}function Aa(r,e,t){if((e=(0,Ae.Ku)(e))instanceof Ai)return e._internalPath;if("string"==typeof e)return Oc(r,e);throw Mc("Field path arguments must be of type string or ",r,!1,void 0,t)}const rg=new RegExp("[~\\*/\\[\\]]");function Oc(r,e,t){if(e.search(rg)>=0)throw Mc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Ai(...e.split("."))._internalPath}catch{throw Mc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Mc(r,e,t,n,i){const o=n&&!n.isEmpty(),c=void 0!==i;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let f="";return(o||c)&&(f+=" (found",o&&(f+=` in field ${n}`),c&&(f+=` in document ${i}`),f+=")"),new G(F.INVALID_ARGUMENT,d+r+f)}function Of(r,e){return r.some(t=>t.isEqual(e))}class wa{constructor(e,t,n,i,o){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Qe(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new ig(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Lc("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ig extends wa{data(){return super.data()}}function Lc(r,e){return"string"==typeof e?Oc(r,e):e instanceof Ai?e._internalPath:e._delegate._internalPath}class md{}class Ra extends md{}function sg(r,e,...t){let n=[];e instanceof md&&n.push(e),n=n.concat(t),function(o){const c=o.filter(f=>f instanceof Xs).length,d=o.filter(f=>f instanceof Pa).length;if(c>1||c>0&&d>0)throw new G(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class Pa extends Ra{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Pa(e,t,n)}_apply(e){const t=this._parse(e);return Bf(e._query,t),new st(e.firestore,e.converter,_r(e._query,t))}_parse(e){const t=Ri(e.firestore);return function(o,c,d,f,m,y,T){let w;if(m.isKeyField()){if("array-contains"===y||"array-contains-any"===y)throw new G(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${y}' queries on documentId().`);if("in"===y||"not-in"===y){Uf(T,y);const O=[];for(const B of T)O.push(Ff(f,o,B));w={arrayValue:{values:O}}}else w=Ff(f,o,T)}else"in"!==y&&"not-in"!==y&&"array-contains-any"!==y||Uf(T,y),w=function kf(r,e,t,n=!1){return Pi(t,r.Fu(n?4:3,e))}(d,"where",T,"in"===y||"not-in"===y);return pe.create(m,y,w)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function og(r,e,t){const n=e,i=Lc("where",r);return Pa._create(i,n,t)}class Xs extends md{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Xs(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:Ie.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,o){let c=i;const d=o.getFlattenedFilters();for(const f of d)Bf(c,f),c=_r(c,f)}(e._query,t),new st(e.firestore,e.converter,_r(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Ff(r,e,t){if("string"==typeof(t=(0,Ae.Ku)(t))){if(""===t)throw new G(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Hi(e)&&-1!==t.indexOf("/"))throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(he.fromString(t));if(!H.isDocumentKey(n))throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return kn(r,new H(n))}if(t instanceof Qe)return kn(r,t._key);throw new G(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${kc(t)}.`)}function Uf(r,e){if(!Array.isArray(r)||0===r.length)throw new G(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Bf(r,e){const t=function(i,o){for(const c of i)for(const d of c.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new G(F.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Gf{convertValue(e,t="none"){switch(tn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Oe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(qt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw J()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Zt(e,(i,o)=>{n[i]=this.convertValue(o,t)}),n}convertGeoPoint(e){return new ad(Oe(e.latitude),Oe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Gi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(xt(e));default:return null}}convertTimestamp(e){const t=Ct(e);return new De(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=he.fromString(e);Z(ys(n));const i=new Gt(n.get(1),n.get(3)),o=new H(n.popFirst(5));return i.isEqual(t)||ye(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}function qc(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class Si{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Zs extends wa{constructor(e,t,n,i,o,c){super(e,t,n,i,c),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Gc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Lc("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Gc extends Zs{data(e={}){return super.data(e)}}class eo{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Si(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Gc(this._firestore,this._userDataWriter,n.key,n,new Si(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new G(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let c=0;return i._snapshot.docChanges.map(d=>({type:"added",doc:new Gc(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Si(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:c++}))}{let c=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(d=>o||3!==d.type).map(d=>{const f=new Gc(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Si(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,y=-1;return 0!==d.type&&(m=c.indexOf(d.doc.key),c=c.delete(d.doc.key)),1!==d.type&&(c=c.add(d.doc),y=c.indexOf(d.doc.key)),{type:cg(d.type),doc:f,oldIndex:m,newIndex:y}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function cg(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return J()}}function lg(r){r=me(r,Qe);const e=me(r.firestore,Ce);return function gf(r,e,t={}){const n=new qe;return r.asyncQueue.enqueueAndForget((0,E.A)(function*(){return function(o,c,d,f,m){const y=new Cc({next:w=>{c.enqueueAndForget(()=>yh(o,T));const O=w.docs.has(d);!O&&w.fromCache?m.reject(new G(F.UNAVAILABLE,"Failed to get document because the client is offline.")):O&&w.fromCache&&f&&"server"===f.source?m.reject(new G(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(w)},error:w=>m.reject(w)}),T=new Eh(Kt(d.path),y,{includeMetadataChanges:!0,ra:!0});return gh(o,T)}(yield Ys(r),r.asyncQueue,e,t,n)})),n.promise}(Be(e),r._key).then(t=>function _d(r,e,t){const n=t.docs.get(e._key),i=new xr(r);return new Zs(r,i,e._key,n,new Si(t.hasPendingWrites,t.fromCache),e.converter)}(e,r,t))}class xr extends Gf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ei(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Qe(this.firestore,null,t)}}function hg(r){r=me(r,st);const e=me(r.firestore,Ce),t=Be(e),n=new xr(e);return function Mf(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new G(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(r._query),function _f(r,e,t={}){const n=new qe;return r.asyncQueue.enqueueAndForget((0,E.A)(function*(){return function(o,c,d,f,m){const y=new Cc({next:w=>{c.enqueueAndForget(()=>yh(o,T)),w.fromCache&&"server"===f.source?m.reject(new G(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(w)},error:w=>m.reject(w)}),T=new Eh(d,y,{includeMetadataChanges:!0,ra:!0});return gh(o,T)}(yield Ys(r),r.asyncQueue,e,t,n)})),n.promise}(t,r._query).then(i=>new eo(e,n,r,i))}function dg(r,e,t){r=me(r,Qe);const n=me(r.firestore,Ce),i=qc(r.converter,e,t);return Sa(n,[Nc(Ri(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,be.none())])}function fg(r){return Sa(me(r.firestore,Ce),[new Fn(r._key,be.none())])}function pg(r,e){const t=me(r.firestore,Ce),n=wf(r),i=qc(r.converter,e);return Sa(t,[Nc(Ri(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,be.exists(!1))]).then(()=>n)}function Sa(r,e){return function(n,i){const o=new qe;return n.asyncQueue.enqueueAndForget((0,E.A)(function*(){return function mm(r,e,t){return xh.apply(this,arguments)}(yield function rd(r){return Vc(r).then(e=>e.syncEngine)}(n),i,o)})),o.promise}(Be(r),e)}function Pg(){return new ud("serverTimestamp")}!function(e,t=!0){_e=oe.SDK_VERSION,(0,oe._registerComponent)(new K.uA("firestore",(n,{instanceIdentifier:i,options:o})=>{const c=n.getProvider("app").getImmediate(),d=new Ce(new Ve(n.getProvider("auth-internal")),new Ft(n.getProvider("app-check-internal")),function(m,y){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new G(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gt(m.options.projectId,y)}(c,i),c);return o=Object.assign({useFetchStreams:t},o),d._setSettings(o),d},"PUBLIC").setMultipleInstances(!0)),(0,oe.registerVersion)(Q,"4.6.3",e),(0,oe.registerVersion)(Q,"4.6.3","esm2017")}()}}]);