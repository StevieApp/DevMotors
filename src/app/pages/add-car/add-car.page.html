<div class="container">
  @if (product) {
    <div class="row pt-5">
      <div class="col-12 col-md-6">
        <h3 class="open-sans-bold mt-1">Details</h3>
        <ion-input class="mb-2" type="text" [(ngModel)]="product.name" required minlength="2" maxlength="150" counter="true" helperText="Name of the Vehicle" label="Vehicle Name" color="success" label-placement="floating" fill="outline" placeholder="Enter Name of Vehicle"></ion-input>
        <ion-input class="mb-2" type="number" [(ngModel)]="product.discount" min="0" max="100" helperText="Discount Offered (%)" label="Discount" color="success" label-placement="floating" fill="outline" placeholder="Enter Discount Offered for the Vehicle"></ion-input>
        <ion-textarea class="mb-2" type="text" [(ngModel)]="product.description" maxlength="1000" counter="true" helperText="Description of the Vehicle" [rows]="4" label="Description" color="success" label-placement="floating" fill="outline" placeholder="Enter Description of Vehicle"></ion-textarea>
        <ion-select class="mb-2" label="Brand" [(ngModel)]="product.brand" required label-placement="floating" fill="outline" helperText="Select Brand of Vehicle">
          @for (brand of brands; track $index) {
            <ion-select-option value="{{brand.name.toUpperCase()}}">{{brand.name.toUpperCase()}}</ion-select-option>
          }
          <ion-item-divider></ion-item-divider>
          <ion-select-option value="OTHER">OTHER</ion-select-option>
        </ion-select>
        <ion-item>
          <ion-label>Gear Shift</ion-label>
        </ion-item>
        <ion-item  mode="ios">
          <ion-radio-group [(ngModel)]="product.gear_shift" class="w-100" value="MANUAL">
            @for (gearshift of gearshifts; track $index) {
              <ion-radio value="{{gearshift}}" color="success" class="w-100">{{gearshift}}</ion-radio><br />
            }
          </ion-radio-group>
        </ion-item>
      </div>
      <div class="col-12 col-md-6">
        <h3 class="open-sans-bold mt-1">Features</h3>
        <!-- <ion-input class="mb-2" type="text" helperText="Name of the Vehicle" label="Vehicle Name" color="success" label-placement="floating" fill="outline" placeholder="Enter Name of Vehicle"></ion-input> -->
        <ion-input class="mb-2" [(ngModel)]="product.engine_capacity" type="number" min="45" max="50000" helperText="Engine Capacity (cc)" label="Engine Capacity" color="success" label-placement="floating" fill="outline" placeholder="Enter Engine Capacity"></ion-input>
        <ion-input class="mb-2" [(ngModel)]="product.horse_power" type="number" min="50" max="2500" helperText="Horse Power (hp)" label="Horse Power" color="success" label-placement="floating" fill="outline" placeholder="Enter Horse Power"></ion-input>
        <ion-input class="mb-2" [(ngModel)]="product.max_speed" type="number" min="10" max="1500" helperText="Max Speed in (kmh)" label="Max Speed" color="success" label-placement="floating" fill="outline" placeholder="Enter Max Speed"></ion-input>
        <ion-input class="mb-2" [(ngModel)]="product.mileage" type="number" min="0" max="6000000" helperText="Enter Mileage (km)" label="Mileage" color="success" label-placement="floating" fill="outline" placeholder="Enter Mileage"></ion-input>
        <ion-select class="mb-2" [(ngModel)]="product.fuel" label="Fuel" required label-placement="floating" fill="outline" helperText="Select Fuel Used by Vehicle" helperText="Enter Fuel eg. Diesel/Petrol">
          @for (fuel of fuels; track $index) {
            <ion-select-option value="{{fuel}}">{{fuel}}</ion-select-option>
          }
        </ion-select>
        <ion-item mode="ios">
          <ion-checkbox color="success" [(ngModel)]="product.hybrid" label-placement="stacked" alignment="center" justify="center" helperText="Check if Vehicle is Hybrid" class="mb-2" mode="ios" value="true">Hybrid</ion-checkbox>
        </ion-item>
      </div>
      <div class="col-12">
        <h3 class="open-sans-bold mt-3">Variations</h3>
        <ion-item>
          <ion-input class="mt-3 mb-2" type="text" helperText="Enter Varying Feature eg. Color/Mods" label="Variation Name" color="success" label-placement="floating" fill="outline" placeholder="Enter Varying Feature eg. Color" [(ngModel)]="newvariation"></ion-input>
          <ion-button color="success" size="small" slot="end" (click)="addVariation()">
            <ion-icon name="add-outline"></ion-icon>
          </ion-button>
        </ion-item>
      </div>
      @if (product && product.variations && product.variations.length>0) {
        <h3 class="open-sans-bold mt-3">Selected Variation: {{product.variations[selected].name}}</h3>
        <div class="col-12 d-flex mona">
          @for (variation of product.variations; track $index) {
            @if (selected==$index) {
              <ion-card mode="md" tappable class="rounded ms-2 me-2 p-2 border border-2 border-secondary" (click)="selected=$index">
                <ion-card-subtitle>
                  <ion-text class="me-2" style="vertical-align: sub;">{{variation.name}}</ion-text>
                  <ion-button size="small" fill="clear" (click)="removeVariation($index)">
                    <ion-icon name="trash-bin" color="danger"></ion-icon>
                  </ion-button>
                </ion-card-subtitle>
              </ion-card>
            }@else {
              <ion-card mode="md" tappable class="rounded ms-2 me-2 p-2" (click)="selected=$index">
                <ion-text style="vertical-align: sub;">
                  {{variation.name}}
                </ion-text>
              </ion-card>
            }
          }
        </div>
      }
      @if (product && product.variations && product.variations.length>0 && product.variations[selected]) {
        <div class="col-12 mb-4">
          <h5 class="open-sans-bold mt-1 mb-2">Edit Variation: {{product.variations[selected].name}}</h5>
          <div class="dropzone rounded-3 pb-2" (dragover)="checkandsave($event, 'drag')" (drop)="checkandsave($event, 'drop')" (dragleave)="checkandsave($event, 'drag')">
            <input tappable type="file" #fileDropRef id="fileDropRef" multiple (change)="checkandsave($event, 'selected')" />
            <h3 class="mt-0">Drag and Drop Images Here</h3>
            <h3>or</h3>
            <label for="fileDropRef" class="pt-3">
              <i class="bi bi-cloud-arrow-up-fill"></i> <ion-text> Browse for Images</ion-text>
            </label>
          </div>
        </div>
        @if (product.variations[selected].images && product.variations[selected].images.length>0) {
          <div class="col-12 overflow-y-hidden scroller" style="width: 100vw; height: 210px;overflow-x: auto; white-space: nowrap;">
            <h5 class="open-sans-bold mt-1 mb-2">Images</h5>
            @for (image of product.variations[selected].images; track $index) {
              <div class="d-inline-block me-2">
                <ion-badge  (click)="deleteImage(image, $index)" tappable slot="start" class="float-start ion-activatable ripple-parent" color="danger" style="margin-right: -310px; margin-left: 278px;">
                  <ion-ripple-effect></ion-ripple-effect>
                  <ion-icon name="trash-outline"></ion-icon>
                </ion-badge>
                <img tappable src="{{image}}" class="object-fit-cover rounded-3 mb-2" style="width: 300px; height: 150px;"/>
              </div>
            }
          </div>
        }
        <div class="col-12 col-md-6 mt-2">
          <ion-input class="mb-2" [(ngModel)]="product.variations[selected].price" type="number" required min="50" max="1000000000" helperText="Price of the Variation" label="Price" color="success" label-placement="floating" fill="outline" placeholder="Enter Price of Variation"></ion-input>
          <ion-input class="mb-2" [(ngModel)]="product.variations[selected].discount" type="number" min="0" max="100" helperText="Discount Offered for Variation (%)" label="Discount" color="success" label-placement="floating" fill="outline" placeholder="Enter Discount Offered for the Variation"></ion-input>
        </div>
        <div class="col-12 col-md-6 mt-2">
          <ion-textarea class="mb-2" [(ngModel)]="product.variations[selected].description" type="text" minlength="10" maxlength="500" helperText="Description of the Variation" [rows]="4" label="Description" color="success" label-placement="floating" fill="outline" placeholder="Enter Description of Variation"></ion-textarea>
        </div>
      }
      <div class="col-12 sticky-bottom mt-4">
        <!-- [ngClass]="{'my_class': step === 'step1'}" -->
        @if (!id) {
          <ion-button expand="block" mode="ios" (click)="saveProduct()">Add</ion-button>
        }@else {
          <ion-button expand="block" mode="ios" color="secondary" (click)="updateProduct()">Edit</ion-button>
          <ion-button expand="block" mode="ios" color="danger" (click)="deleteProduct()">Delete</ion-button>
        }
      </div>
    </div>
  }
</div>